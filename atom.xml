<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hans Chan&#39;s Blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://csbun.github.io/blog/"/>
  <updated>2020-11-03T11:52:46.477Z</updated>
  <id>http://csbun.github.io/blog/</id>
  
  <author>
    <name>å‰èµ·æ¥å°±å¯ä»¥çƒ§</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Workbox å…¥é—¨</title>
    <link href="http://csbun.github.io/blog/2018/02/workbox/"/>
    <id>http://csbun.github.io/blog/2018/02/workbox/</id>
    <published>2018-02-27T09:38:34.000Z</published>
    <updated>2020-11-03T11:52:46.477Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://developers.google.com/web/tools/workbox/" target="_blank" rel="noopener">Workbox</a> Â· JavaScript Libraries for adding offline support to web apps.</p><p>ä¸€ä¸ªä¸ºç½‘é¡µåº”ç”¨æ·»åŠ ç¦»çº¿æ”¯æŒçš„ JavaScript åº“ã€‚</p><blockquote><p>æœ¬æ–‡å†…å®¹åŸºäº <a href="mailto:Workbox@3.0.0" target="_blank" rel="noopener">Workbox@3.0.0</a></p></blockquote><a id="more"></a><h2><span id="å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹</span></h2><p>Workbox ä½œä¸º SW æ¨¡å—ä½¿ç”¨ï¼Œæä¾›äº†ä¸¤ä¸ªæœ€ä¸»è¦çš„æ¥å£ï¼š</p><ul><li><a href="https://developers.google.com/web/tools/workbox/reference-docs/latest/workbox.routing#registerRoute" target="_blank" rel="noopener">ğŸ”—</a> <code>workbox.routing.registerRoute</code>ï¼Œæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•° capture æ˜¯æ­£åˆ™è¡¨è¾¾å¼æˆ– Express é£æ ¼çš„è·¯ç”±å­—ç¬¦ä¸²ï¼Œå£°æ˜éœ€è¦åŒ¹é…é‚£äº›è¯·æ±‚ï¼Œç¬¬äºŒä¸ªå‚æ•°ç”¨äºå‘Šè¯‰ Workbox å¯¹å‰é¢æ‹¦æˆªåˆ°çš„è¯·æ±‚åšä½•å¤„ç†ã€‚</li><li><a href="https://developers.google.com/web/tools/workbox/reference-docs/latest/workbox.strategies" target="_blank" rel="noopener">ğŸ”—</a> <code>workbox.strategies.xxx</code>ï¼Œç”¨åœ¨ registerRoute çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¡¨æ˜ä½¿ç”¨ä½•ç§ç¼“å­˜ç­–ç•¥ã€‚</li></ul><p>æœ€ç®€å•çš„ä¾‹å­ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">importScripts(<span class="string">'https://storage.googleapis.com/workbox-cdn/releases/3.0.0/workbox-sw.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// JS è¯·æ±‚: ç½‘ç»œä¼˜å…ˆ</span></span><br><span class="line">workbox.routing.registerRoute(</span><br><span class="line">  <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'.*\.js'</span>),</span><br><span class="line">  workbox.strategies.networkFirst(&#123;</span><br><span class="line">    cacheName: <span class="string">'workbox:js'</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ·»åŠ å…¶ä»–çš„ä¸€äº›ç¼“å­˜ç­–ç•¥æ¥åº”å¯¹ cssã€å›¾ç‰‡æ–‡ä»¶ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CSS è¯·æ±‚: ç¼“å­˜ä¼˜å…ˆï¼ŒåŒæ—¶åå°æ›´æ–°åä¸‹æ¬¡æ‰“å¼€é¡µé¢æ‰ä¼šè¢«é¡µé¢ä½¿ç”¨</span></span><br><span class="line">workbox.routing.registerRoute(</span><br><span class="line">  <span class="comment">// Cache CSS files</span></span><br><span class="line">  /.*\.css/,</span><br><span class="line">  <span class="comment">// Use cache but update in the background ASAP</span></span><br><span class="line">  workbox.strategies.staleWhileRevalidate(&#123;</span><br><span class="line">    <span class="comment">// Use a custom cache name</span></span><br><span class="line">    cacheName: <span class="string">'workbox:css'</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å›¾ç‰‡è¯·æ±‚: ç¼“å­˜ä¼˜å…ˆ</span></span><br><span class="line">workbox.routing.registerRoute(</span><br><span class="line">  <span class="comment">// Cache image files</span></span><br><span class="line">  /.*\.(?:png|jpg|jpeg|svg|gif)/,</span><br><span class="line">  <span class="comment">// Use the cache if it's available</span></span><br><span class="line">  workbox.strategies.cacheFirst(&#123;</span><br><span class="line">    <span class="comment">// Use a custom cache name</span></span><br><span class="line">    cacheName: <span class="string">'workbox:image'</span>,</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> workbox.expiration.Plugin(&#123;</span><br><span class="line">        <span class="comment">// Cache only 20 images</span></span><br><span class="line">        maxEntries: <span class="number">20</span>,</span><br><span class="line">        <span class="comment">// Cache for a maximum of a week</span></span><br><span class="line">        maxAgeSeconds: <span class="number">7</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">    ],</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>å¯¹äºè¿™æ ·ä¸€ä¸ªç®€å•çš„é¡µé¢ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"./css/style.css"</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/head&gt;</span></span><br><span class="line"><span class="regexp">&lt;body&gt;</span></span><br><span class="line"><span class="regexp">  &lt;h1&gt;Workbox Get Started&lt;/</span>h1&gt;</span><br><span class="line">  &lt;img src=<span class="string">"./images/google.local.png"</span> alt=<span class="string">"åŒåŸŸçš„æ–‡ä»¶"</span>&gt;</span><br><span class="line">  &lt;script src=<span class="string">"./js/index.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure><h3><span id="1">#1</span></h3><p>æˆ‘ä»¬å¯ä»¥çœ‹çœ‹ç¬¬ä¸€æ¬¡è®¿é—®æ—¶çš„æ•ˆæœï¼š<br><img src="/2018/02/workbox/gs1.png" title="Web ç¬¬ä¸€æ¬¡è®¿é—®æ—¶çš„æ•ˆæœ"></p><p>å’Œå¹³å¸¸çš„è®¿é—®æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œåªæ˜¯å¤šäº† sw.js åŠå…¶ä¾èµ–ï¼ˆworkbox ç­‰ï¼‰çš„è¯·æ±‚ï¼Œå¹¶åœ¨ <code>Application &gt; Service Workers</code> ä¸­å¯ä»¥çœ‹åˆ° sw.js å·²ç»è¢«æ³¨å†Œï¼ˆä½†å…¶ä¸­çš„ fetch äº‹ä»¶æ— æ³•åœ¨è¿™æ¬¡è®¿é—®å°±è¢«æ•è·ï¼‰ã€‚</p><h3><span id="2">#2</span></h3><p>äºæ˜¯æˆ‘ä»¬åˆ·æ–°é¡µé¢çœ‹çœ‹æ•ˆæœï¼š<br><img src="/2018/02/workbox/gs2.png" title="Web ç¬¬äºŒæ¬¡è®¿é—®æ—¶çš„æ•ˆæœ"></p><ul><li>å…¨éƒ¨çš„ cssã€pngã€js æ–‡ä»¶å‡è¢« ServiceWorker æ‹¦æˆªï¼ˆå›¾ä¸­ from ServiceWorker å¯ä»¥çœ‹å‡ºï¼‰</li><li>workbox-core åœ¨æ‹¦æˆªåé‡æ–°å‘èµ·äº† fetch è¯·æ±‚å¹¶è¿”å›é¡µé¢ï¼Œfetch åæœåŠ¡ç«¯è¿”å› 304 ä¾ç„¶å¯ä»¥ä½¿ç”¨æµè§ˆå™¨æœ¬åœ°ç¼“å­˜ç­–ç•¥</li><li>ä¸Šè¿°å‘½ä¸­è§„åˆ™çš„è¯·æ±‚éƒ½è¢«ç¼“å­˜åˆ° Cache Storage ä¸­</li></ul><blockquote><p>ä¸ºäº†æ–¹ä¾¿çœ‹åˆ°æ•ˆæœï¼Œæˆ‘è®¾ç½®æœåŠ¡ç«¯ Cache Control å¤±æ•ˆï¼ˆ<code>max-age=0</code>ï¼‰ï¼Œä½¿å¾—æ¯æ¬¡è¯·æ±‚éƒ½èƒ½åˆ°è¾¾æœåŠ¡ç«¯</p></blockquote><img src="/2018/02/workbox/gs3.png" title="Web Cache Storage"><h3><span id="3">#3</span></h3><p>æˆ‘ä»¬æ›´æ–°ä¸€ä¸‹ cssã€ js å’Œ png çš„å†…å®¹ï¼Œç„¶åé‡æ–°è®¿é—®é¡µé¢ï¼š</p><img src="/2018/02/workbox/gs4.png" title="Web ç¬¬ä¸‰æ¬¡è®¿é—®æ—¶çš„æ•ˆæœ"><ul><li>ç”±äº png æ˜¯ Cache Firstï¼Œæ‰€ä»¥ç›´æ¥ä» ServiceWorker çš„ Cache è¿”å›ï¼Œæ²¡æœ‰çœŸæ­£çš„ç½‘ç»œè¯·æ±‚å‘å‡º</li><li>ç”±äº js æ˜¯ Network Firstï¼Œæ‰€ä»¥ä¼šäº§ç”Ÿ fetchï¼Œä¸”è¿è¡ŒæˆåŠŸï¼ˆåº•éƒ¨ Console æœ‰è¾“å‡ºå†…å®¹ï¼‰</li><li>css è™½ç„¶åŒæ · fetch äº†æ–°çš„å†…å®¹ï¼Œä½†é¡µé¢å¹¶æ²¡æœ‰ç”Ÿæ•ˆï¼Œç”¨çš„è¿˜æ˜¯ä¸Šä¸€æ¬¡çš„ Cacheï¼ˆä½†æ–°çš„æ–‡ä»¶å†…å®¹å·²ç»æ”¾åˆ° Cache Storage ä¸­ï¼‰</li></ul><h3><span id="4">#4</span></h3><p>ä¸å†åšä»»ä½•ä¿®æ”¹ï¼Œåˆ·æ–°é¡µé¢ï¼š</p><img src="/2018/02/workbox/gs5.png" title="Web ç¬¬å››æ¬¡è®¿é—®æ—¶çš„æ•ˆæœ"><ul><li>æ–°çš„ css ç”Ÿæ•ˆï¼ˆ<code>staleWhileRevalidate</code>ï¼‰</li><li>cssã€js è¯·æ±‚è¿”å›ä¸º 304ï¼Œä½¿ç”¨æµè§ˆå™¨ç¼“å­˜</li></ul><h2><span id="ç¦»çº¿åº”ç”¨">ç¦»çº¿åº”ç”¨</span></h2><p>è¦åšåˆ°èƒ½å¤Ÿå®Œå…¨ç¦»çº¿ï¼Œæˆ‘ä»¬è¿˜å¿…é¡»è®©ä¸»æ–‡æ¡£ä¹Ÿèƒ½è¢«ç¼“å­˜ä¸‹æ¥ï¼Œä¾‹å¦‚æˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ <code>networkFirst</code> æ¥å¤„ç†ä¸»æ–‡æ¡£ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸»æ–‡æ¡£: ç½‘ç»œä¼˜å…ˆ</span></span><br><span class="line">workbox.routing.registerRoute(</span><br><span class="line">  /index\.html/,</span><br><span class="line">  workbox.strategies.networkFirst(&#123;</span><br><span class="line">    cacheName: <span class="string">'workbox:html'</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ç¼“å­˜æˆåŠŸåï¼Œå³ä¾¿æ–­ç½‘ï¼Œé¡µé¢ä¾æ—§å¯ä»¥è®¿é—®åŠä½¿ç”¨ï¼š</p><img src="/2018/02/workbox/ol1.png" title="Web å®Œå…¨ç¦»çº¿"><p>å…·ä½“ <a href="https://csbun.github.io/workbox-examples/workbox-get-started/index.html">Demo</a> å’Œ <a href="https://github.com/csbun/workbox-examples/tree/master/workbox-get-started" target="_blank" rel="noopener">åŸç </a>ã€‚</p><h2><span id="è·¨åŸŸè¯·æ±‚">è·¨åŸŸè¯·æ±‚</span></h2><p>åœ¨å¤§å¤šæ•°çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå°†é™æ€èµ„æºæ”¾åˆ° CDN ä¸­ï¼Œè¿™å°±æ¶‰åŠåˆ°è·¨åŸŸé—®é¢˜ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>ä¸åŒåŸŸçš„æ–‡ä»¶<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://developers.google.com/web/tools/workbox/images/Workbox-Logo-Grey.svg"</span> <span class="attr">alt</span>=<span class="string">"ä¸åŒåŸŸçš„æ–‡ä»¶"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>ä¸åŒåŸŸçš„æ–‡ä»¶ ä¸” <span class="tag">&lt;<span class="name">code</span>&gt;</span>access-control-allow-origin: *<span class="tag">&lt;/<span class="name">code</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/resize-image@0.0.4/example/google.png"</span> <span class="attr">alt</span>=<span class="string">"ä¸åŒåŸŸçš„æ–‡ä»¶ ä¸” allow cross origin"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ä¸åŒåŸŸçš„js ä¸” access-control-allow-origin: * --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/jquery@3.3.1/dist/jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç»æµ‹è¯•ï¼ŒWorkbox å¯ä»¥ç”¨ <code>networkFirst</code> å’Œ <code>staleWhileRevalidate</code> ä¸¤ç§ç­–ç•¥ Cache è·¨åŸŸèµ„æºï¼Œè€Œ <code>cacheFirst</code> åˆ™å®Œå…¨ä¸è¡Œã€‚æŒ‰ <a href="https://developers.google.com/web/tools/workbox/guides/handle-third-party-requests#workbox_caches_opaque_response_sometimes" target="_blank" rel="noopener">å®˜ç½‘çš„è§£é‡Š</a>ï¼ŒFetch è·¨åŸŸçš„è¯·æ±‚æ˜¯æ— æ³•çŸ¥é“è¯¥è¯·æ±‚æ˜¯å¦æˆåŠŸï¼Œå› æ­¤ <code>cacheFirst</code> åˆ™æœ‰å¯èƒ½ç¼“å­˜ä¸‹äº†å¤±è´¥çš„è¯·æ±‚ï¼Œå¹¶ä»æ­¤ä»¥åéƒ½ä¼šæ¥ç®¡é¡µé¢çš„è¿™ä¸ªè¯·æ±‚å¯¼è‡´é¡µé¢é”™è¯¯ã€‚è€Œ <code>networkFirst</code> å’Œ <code>staleWhileRevalidate</code> æ˜¯æœ‰æ›´æ–°æœºåˆ¶çš„ï¼Œå³ä½¿ä¸€æ¬¡é”™è¯¯ä¸‹æ¬¡ä¹Ÿè®¸å°±ä¿®å¤äº†å‘¢ã€‚</p><blockquote><p><code>cacheFirst</code> ä¾‹å­ä¸­å³ä½¿å¼€å¯ <code>Offline</code> ä¹Ÿèƒ½æµè§ˆåˆ°é¡µé¢æ˜¯å› ä¸º html æ˜¯åŒåŸŸçš„ï¼Œè€Œè·¨åŸŸçš„é™æ€èµ„æºæœ‰æµè§ˆå™¨ç¼“å­˜ã€‚å¦‚æœåŒæ—¶å¼€å¯ <code>Disabel cache</code> å°±æ— æ³•çœ‹åˆ°ç›¸å…³å›¾ç‰‡ç­‰é™æ€èµ„æºäº†ã€‚</p></blockquote><p>å¦‚æœçœŸçš„æ‰§æ„è¦ä½¿ç”¨ <code>cacheFirst</code> ç¼“å­˜è·¨åŸŸèµ„æºï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <a href="https://developers.google.com/web/tools/workbox/reference-docs/latest/workbox.cacheableResponse.Plugin" target="_blank" rel="noopener">cacheableResponse.Plugin</a>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Force Caching of Opaque Responses</span></span><br><span class="line">workbox.routing.registerRoute(</span><br><span class="line">  <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'https://developers\.google\.com/'</span>),</span><br><span class="line">  workbox.strategies.cacheFirst(&#123;</span><br><span class="line">    cacheName: <span class="string">`<span class="subst">$&#123;CACHE_NAME&#125;</span>:cache-first`</span>,</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="comment">// Force Cache</span></span><br><span class="line">      <span class="keyword">new</span> workbox.cacheableResponse.Plugin(&#123;</span><br><span class="line">        statuses: [<span class="number">0</span>, <span class="number">200</span>], <span class="comment">// One or more status codes that a Response can have and be considered cacheable.</span></span><br><span class="line">      &#125;),</span><br><span class="line">    ]</span><br><span class="line">  &#125;),</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶èƒ½çœ‹åˆ° <code>https://developers.google.com/</code> åŸŸåä¸‹çš„èµ„æºä¹Ÿè¢«ç¼“å­˜äº†ï¼š</p><img src="/2018/02/workbox/co1.png" title="å¼ºåˆ¶è·¨åŸŸ CacheFirst"><p>å…·ä½“çš„ <a href="https://csbun.github.io/workbox-examples/workbox-cross-origin/index.html">Demo</a> å’Œ <a href="https://github.com/csbun/workbox-examples/tree/master/workbox-cross-origin" target="_blank" rel="noopener">æºç </a></p><h2><span id="cli-å·¥å…·">CLI å·¥å…·</span></h2><p>ç»†å¿ƒçš„å°æœ‹å‹ä¸€å®šå‘ç°äº†ï¼Œä¸Šé¢çš„ <code>routing</code> éœ€è¦ç¬¬ä¸‰æ¬¡è®¿é—®æ‰èƒ½çœŸæ­£ä» Cache ä¸­å°†ç¼“å­˜è¿”å›ï¼ˆæˆ–è€…æ”¯æŒç¦»çº¿ï¼‰ï¼Œæœ‰æ²¡æœ‰åŠæ³•å°†è¿™ä¸ªæ—¶é—´æå‰åˆ°ç¬¬äºŒæ¬¡å‘¢ï¼Ÿè¿™é‡Œï¼Œæˆ‘ä»¬ç›´æ¥ç”¨ CLI å·¥å…·æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>å½“ä½œä¸ºå‘½ä»¤è¡Œå·¥å…·æ—¶ï¼ŒWorkbox æœ‰ 3 ä¸ªä¸»è¦çš„å‘½ä»¤ï¼š</p><ul><li><code>workbox wizard</code> ç”Ÿæˆé…ç½®æ–‡ä»¶ <em>workbox-config.js</em>ï¼›</li><li><code>workbox generateSW</code> ç”Ÿæˆ prefetch çš„ ServiceWorker JS æ–‡ä»¶ï¼ˆä¾èµ– <em>workbox-config.js</em>ï¼‰ï¼›</li><li><code>workbox injectManifest</code> å°† prefetch ä»£ç æ³¨å…¥åˆ°æŒ‡å®šçš„ JS æ–‡ä»¶ï¼ˆä¾èµ– <em>workbox-config.js</em>ï¼‰ï¼›</li></ul><h3><span id="generatesw">generateSW</span></h3><p>é¦–å…ˆä¿®æ”¹é…ç½®æ–‡ä»¶ <em>workbox-config.js</em> å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="string">"globDirectory"</span>: <span class="string">"./"</span>,        <span class="comment">// åŒ¹é…æ ¹ç›®å½•</span></span><br><span class="line">  <span class="string">"globPatterns"</span>: [             <span class="comment">// åŒ¹é…çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="string">"**/*.&#123;css,png,html,js&#125;"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"globIgnores"</span>: [              <span class="comment">// å¿½ç•¥çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="string">"build/**"</span>,</span><br><span class="line">    <span class="string">"workbox-config.js"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"swDest"</span>: <span class="string">"build.sw.js"</span>       <span class="comment">// ç›®æ ‡è¾“å‡º</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿è¡Œ <code>workbox generateSW</code> æˆ‘ä»¬å³å¯åœ¨ <em>build.sw.js</em> ä¸­çœ‹åˆ°ç±»ä¼¼çš„å†…å®¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">importScripts(<span class="string">"https://storage.googleapis.com/workbox-cdn/releases/3.0.0-beta.1/workbox-sw.js"</span>);</span><br><span class="line"></span><br><span class="line">self.__precacheManifest = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">"url"</span>: <span class="string">"css/style.css"</span>,</span><br><span class="line">    <span class="string">"revision"</span>: <span class="string">"835ba5c376a3f48dba17d3a9dc152fc3"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">"url"</span>: <span class="string">"js/index.js"</span>,</span><br><span class="line">    <span class="string">"revision"</span>: <span class="string">"589daa65882023b238e57abbb6caa643"</span></span><br><span class="line">  &#125;</span><br><span class="line">].concat(self.__precacheManifest || []);</span><br><span class="line">workbox.precaching.suppressWarnings();</span><br><span class="line">workbox.precaching.precacheAndRoute(self.__precacheManifest, &#123;&#125;);</span><br></pre></td></tr></table></figure><p>ä»æ–¹æ³•åæˆ‘ä»¬å¯ä»¥çŒœæµ‹å‡ºï¼Œå°† <code>__precacheManifest</code> åˆ—è¡¨ä¸­çš„æ–‡ä»¶ï¼ˆå³é…ç½®ä¸­ <code>globPatterns</code> åŒ¹é…çš„æ–‡ä»¶ï¼‰é¢„åŠ è½½ä¸‹æ¥ï¼Œä¸‹æ¬¡æ‹¦æˆªåˆ°å³ä» Cache ä¸­è¿”å›ã€‚è¯¦æƒ…å¯ä»¥æŸ¥çœ‹ <a href="https://developers.google.com/web/tools/workbox/reference-docs/v3.0.0-alpha.5/workbox.precaching" target="_blank" rel="noopener">precaching æ¥å£æ–‡æ¡£</a>ã€‚</p><h3><span id="injectmanifest">injectManifest</span></h3><p>ä½†æ˜¯ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å·²ç»æœ‰ä¸€æ®µ ServiceWorker çš„é€»è¾‘ï¼Œå¸Œæœ›æ·»åŠ ç›¸å…³çš„ precaching ä»£ç ä½†ä¸å¸Œæœ›å¢åŠ æ›´å¤šçš„ sw æ–‡ä»¶ã€‚ï¼ˆå¦ä¸€æ–¹é¢ï¼Œå¯èƒ½ä½ çš„ä¸šåŠ¡æ˜¯åœ¨å›½å†…è·‘çš„ï¼Œä½ çš„ç”¨æˆ·æ˜¯è®¿é—®ä¸äº† googleapis.com çš„ CDN æ–‡ä»¶ï¼ŒgenerateSW ç”Ÿæˆçš„ importScripts å°±æ²¡ä»€ä¹ˆç”¨äº†ã€‚ï¼‰äºæ˜¯æˆ‘éœ€è¦åœ¨ <strong>åŸæœ¬çš„ sw æ–‡ä»¶(<em>sw.tpl.js</em>)</strong> ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Workbox injectManifest</span></span><br><span class="line">importScripts(<span class="string">"https://storage.googleapis.com/workbox-cdn/releases/3.0.0-beta.1/workbox-sw.js"</span>);</span><br><span class="line">workbox.precaching.precacheAndRoute([]);</span><br><span class="line"><span class="comment">// Workbox injectManifest End</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¶ä»–è‡ªå®šä¹‰ sw å†…å®¹</span></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>å¹¶ä¿®æ”¹ <em>workbox-config.js</em> (æˆ–é€šè¿‡ <code>workbox wizard --injectManifest</code> ç”Ÿæˆ)ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="string">"globDirectory"</span>: <span class="string">"./"</span>,</span><br><span class="line">  <span class="string">"globPatterns"</span>: [</span><br><span class="line">    <span class="string">"**/*.&#123;css,png,html,js&#125;"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"globIgnores"</span>: [</span><br><span class="line">    <span class="string">"build/**"</span>,</span><br><span class="line">    <span class="string">"workbox-config.js"</span>,</span><br><span class="line">    <span class="string">"js/sw.tpl.js"</span>              <span class="comment">// â€œåŸæœ¬çš„ sw æ–‡ä»¶(sw.tpl.js)â€</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"swDest"</span>: <span class="string">"build.sw.js"</span>,</span><br><span class="line">  <span class="comment">// æ·»åŠ ä¸‹é¢è¿™è¡Œï¼ŒæŒ‡å‘ â€œåŸæœ¬çš„ sw æ–‡ä»¶(sw.tpl.js)â€</span></span><br><span class="line">  <span class="string">"swSrc"</span>: <span class="string">"./js/sw.tpl.js"</span>     <span class="comment">// è¾“å…¥æº</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æœ€åé€šè¿‡è¿è¡Œ <code>workbox injectManifest</code> æˆ‘ä»¬å³å¯åœ¨ <em>build.sw.js</em> ä¸­çœ‹åˆ°ç±»ä¼¼çš„å†…å®¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Workbox injectManifest</span></span><br><span class="line">importScripts(<span class="string">"https://storage.googleapis.com/workbox-cdn/releases/3.0.0-beta.1/workbox-sw.js"</span>);</span><br><span class="line">workbox.precaching.precacheAndRoute([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">"url"</span>: <span class="string">"css/style.css"</span>,</span><br><span class="line">    <span class="string">"revision"</span>: <span class="string">"835ba5c376a3f48dba17d3a9dc152fc3"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">"url"</span>: <span class="string">"js/sw.tpl.js"</span>,</span><br><span class="line">    <span class="string">"revision"</span>: <span class="string">"acc39fc40b04d67b8403e7347d32f43b"</span></span><br><span class="line">  &#125;</span><br><span class="line">]);</span><br><span class="line"><span class="comment">// Workbox injectManifest End</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¶ä»–è‡ªå®šä¹‰ sw å†…å®¹</span></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>å†æ¬¡è¿›å…¥é¡µé¢çœ‹çœ‹æ•ˆæœï¼Œç¬¬ä¸€æ¬¡è®¿é—®ï¼Œå·²ç»å°†å…¨éƒ¨èµ„æº cache ä¸‹æ¥äº†ï¼š</p><img src="/2018/02/workbox/cli1.png" title="ç¬¬ä¸€æ¬¡è®¿é—®å…¨éƒ¨è¿›è¡Œ Cache"><p>ç¬¬äºŒæ¬¡è®¿é—®ï¼Œèµ„æºå·²ç»å…¨éƒ¨ä» Service Worker ä¸­è¿”å›ï¼Œåšåˆ°å®Œå…¨ç¦»çº¿ï¼š</p><img src="/2018/02/workbox/cli2.png" title="ç¬¬äºŒæ¬¡è®¿é—® Web å®Œå…¨ç¦»çº¿"><p>å…·ä½“ <a href="https://csbun.github.io/workbox-examples/workbox-using-cli/index.html">Demo</a> å’Œ <a href="https://github.com/csbun/workbox-examples/tree/master/workbox-using-cli" target="_blank" rel="noopener">åŸç </a>ã€‚</p><h2><span id="é…åˆ-webpack-ä½¿ç”¨">é…åˆ Webpack ä½¿ç”¨</span></h2><p>å¾ˆå¤šæ—¶å€™ï¼Œé¡¹ç›®æ˜¯é€šè¿‡ webpack æ„å»ºçš„ï¼Œäºæ˜¯æˆ‘ä»¬æœŸæœ›åœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å°†æ‰€ç”¨åˆ°çš„é™æ€èµ„æºè¿›è¡Œé¢„åŠ è½½ã€‚å¦‚ä¸‹æœ‰ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><figure class="highlight javascript"><figcaption><span>index.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸šåŠ¡ä»£ç </span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'../css/style.css'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> elImg = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>);</span><br><span class="line">elImg.src = <span class="built_in">require</span>(<span class="string">'../images/icon-48.png'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.body.appendChild(elImg);</span><br></pre></td></tr></table></figure><p>å› æ­¤æˆ‘ä»¬è‡³å°‘æœ‰ 3 ä¸ªé™æ€èµ„æºï¼š</p><ul><li><em>index.js</em> ï¼ˆä¸Šè¿°çš„ js ä¸šåŠ¡ä»£ç ï¼‰</li><li><em>style.css</em>ä½¿ç”¨ ï¼ˆ<code>mini-css-extract-plugin</code>ï¼‰</li><li><em>icon-48.png</em> ï¼ˆä½¿ç”¨ <code>file-loader</code>ï¼‰</li></ul><p>äºæ˜¯æˆ‘ä»¬åœ¨ <em>webpack.config.js</em> ä¸­æ·»åŠ  <code>workbox-webpack-plugin</code>ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸å†éœ€è¦ <em>workbox-config.js</em> äº†ï¼š</p><figure class="highlight javascript"><figcaption><span>webpack.config.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> workboxPlugin = <span class="built_in">require</span>(<span class="string">'workbox-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">new</span> workboxPlugin.GenerateSW(&#123;</span><br><span class="line">      swDest: <span class="string">'build.sw.js'</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åœ¨è¾“å‡ºç›®å½•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é™¤äº†åŸæœ‰çš„é™æ€èµ„æºä¹‹å¤–ï¼Œå¢åŠ äº†ä¸¤ä¸ªæ–‡ä»¶ï¼š</p><ul><li><em>build.sw.js</em>ï¼Œæˆ‘ä»¬æŒ‡å®šçš„ Service Worker æ–‡ä»¶</li></ul><figure class="highlight javascript"><figcaption><span>build.sw.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">importScripts(<span class="string">"https://storage.googleapis.com/workbox-cdn/releases/3.0.0/workbox-sw.js"</span>);</span><br><span class="line"></span><br><span class="line">importScripts(</span><br><span class="line">  <span class="string">"precache-manifest.d82f19f6bd4f26897690a1e0456d5844.js"</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">self.__precacheManifest = [].concat(self.__precacheManifest || []);</span><br><span class="line">workbox.precaching.suppressWarnings();</span><br><span class="line">workbox.precaching.precacheAndRoute(self.__precacheManifest, &#123;&#125;);</span><br></pre></td></tr></table></figure><ul><li><em>precache-manifest.hash.js</em>ï¼Œä¸Šè¿° sw.js å¼•ç”¨çš„èµ„æºåˆ—è¡¨æ–‡ä»¶</li></ul><figure class="highlight javascript"><figcaption><span>precache-manifest.hash.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">self.__precacheManifest = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">"revision"</span>: <span class="string">"1cedcdd1e2143f97cfaf"</span>,</span><br><span class="line">    <span class="string">"url"</span>: <span class="string">"main.1cedc.css"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">"revision"</span>: <span class="string">"17c19a267f8873556a2ae3981095789d"</span>,</span><br><span class="line">    <span class="string">"url"</span>: <span class="string">"index.html"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">"revision"</span>: <span class="string">"1cedcdd1e2143f97cfaf"</span>,</span><br><span class="line">    <span class="string">"url"</span>: <span class="string">"index.1cedc.js"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">"url"</span>: <span class="string">"7186d37d76d392b0e8ad935d7829f6fb.png"</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure><p>å…¶å®è¿™ä¸ªåŠ¨ä½œå…¶å®å’Œ CLI çš„ <code>workbox generateSW</code> éå¸¸ç›¸ä¼¼ï¼Œ<code>workboxPlugin</code> ä¹Ÿæœ‰å¦ä¸€ä¸ª API ä¸º <code>workboxPlugin.InjectManifest({ swSrc, swDest })</code>ï¼Œä¸å‘½ä»¤è¡Œçš„ <code>workbox injectManifest</code> å¯¹åº”ï¼Œè¿™é‡Œä¸å†ç´¯è¿°ï¼Œæ›´å¤šç»†èŠ‚å¯ä»¥çœ‹ <a href="https://developers.google.com/web/tools/workbox/guides/codelabs/webpack" target="_blank" rel="noopener">å®˜æ–¹ä»‹ç»</a>ã€‚</p><h3><span id="ä½¿ç”¨æœ¬åœ°-workbox-swjs">ä½¿ç”¨æœ¬åœ° workbox-sw.js</span></h3><p>å›åˆ°ä¹‹å‰è¯´åˆ°çš„ Google CND çš„é—®é¢˜ï¼Œæˆ‘ä»¬çš„ç¡®æœŸæœ› <em>workbox-sw.js</em> éƒ¨ç½²åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¼šæ›´å¥½ï¼Œçœ‹çœ‹ <a href="https://developers.google.com/web/tools/workbox/modules/workbox-webpack-plugin#configuration" target="_blank" rel="noopener">é…ç½®æ–‡æ¡£</a> è¿˜çœŸèƒ½è¿™ä¹ˆæï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> workboxPlugin.GenerateSW(&#123;</span><br><span class="line">  swDest: <span class="string">'build.sw.js'</span>,</span><br><span class="line">  <span class="comment">// workbox-sw.js éƒ¨ç½²æœ¬åœ°æœåŠ¡å™¨</span></span><br><span class="line">  importWorkboxFrom: <span class="string">'local'</span>,</span><br><span class="line">  <span class="comment">// ï¼ˆé¢„åŠ è½½ï¼‰å¿½ç•¥æŸäº›æ–‡ä»¶</span></span><br><span class="line">  exclude: [</span><br><span class="line">    /index\.html$/,</span><br><span class="line">  ],</span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure><p>ç»“æœä¼šæ˜¯ï¼Œ<code>dist</code> è¾“å‡ºä¼šå˜æˆè¿™æ ·ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dist</span><br><span class="line">â”œâ”€â”€ <span class="number">7186</span>d37d76d392b0e8ad935d7829f6fb.png</span><br><span class="line">â”œâ”€â”€ build<span class="selector-class">.sw</span><span class="selector-class">.js</span></span><br><span class="line">â”œâ”€â”€ index.<span class="number">1</span>cedc.js</span><br><span class="line">â”œâ”€â”€ index.html</span><br><span class="line">â”œâ”€â”€ main.<span class="number">1</span>cedc.css</span><br><span class="line">â”œâ”€â”€ precache-manifest.<span class="number">12198</span>be40483126171d738fb87e6043e.js</span><br><span class="line">â””â”€â”€ workbox-v3.<span class="number">0.0</span></span><br><span class="line">    â”œâ”€â”€ ...</span><br><span class="line">    â”œâ”€â”€ workbox-sw.js</span><br><span class="line">    â””â”€â”€ workbox-sw<span class="selector-class">.js</span><span class="selector-class">.map</span></span><br></pre></td></tr></table></figure><p>ç›®å½•ä¸‹ä¼šå¢åŠ ä¸€ä¸ª <em>workbox-v3.0.0</em> æ–‡ä»¶å¤¹ï¼Œ<em>build.sw.js</em> å°†åº”ç”¨å…¶ä¸­çš„æ–‡ä»¶ã€‚</p><h3><span id="åŠ¨æ€æ›´æ–°">åŠ¨æ€æ›´æ–°</span></h3><p>é…åˆæœ€å¼€å§‹æåŠçš„ç¼“å­˜ç­–ç•¥ï¼Œä¸€åˆ‡éƒ½å¯ä»¥é€šè¿‡æ’ä»¶é…ç½®ç”Ÿæˆï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> workboxPlugin.GenerateSW(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// åŠ¨æ€æ›´æ–°ç¼“å­˜</span></span><br><span class="line">  runtimeCaching: [&#123;</span><br><span class="line">    urlPattern: <span class="regexp">/index\.html/</span>,</span><br><span class="line">    handler: <span class="string">'networkFirst'</span>,</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    urlPattern: <span class="regexp">/\.(js|css|png|jpg|gif)/</span>,</span><br><span class="line">    handler: <span class="string">'staleWhileRevalidate'</span>,</span><br><span class="line">  &#125;],</span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆçš„å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">importScripts(<span class="string">"workbox-v3.0.0/workbox-sw.js"</span>);</span><br><span class="line">workbox.setConfig(&#123;<span class="attr">modulePathPrefix</span>: <span class="string">"workbox-v3.0.0"</span>&#125;);</span><br><span class="line"></span><br><span class="line">importScripts(</span><br><span class="line">  <span class="string">"precache-manifest.12198be40483126171d738fb87e6043e.js"</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">self.__precacheManifest = [].concat(self.__precacheManifest || []);</span><br><span class="line">workbox.precaching.suppressWarnings();</span><br><span class="line">workbox.precaching.precacheAndRoute(self.__precacheManifest, &#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¢åŠ äº†ä»¥ä¸‹å†…å®¹</span></span><br><span class="line">workbox.routing.registerRoute(<span class="regexp">/index\.html/</span>, workbox.strategies.networkFirst(), <span class="string">'GET'</span>);</span><br><span class="line">workbox.routing.registerRoute(<span class="regexp">/\.(js|css|png|jpg|gif)/</span>, workbox.strategies.staleWhileRevalidate(), <span class="string">'GET'</span>);</span><br></pre></td></tr></table></figure><p>è®¿é—®é¡µé¢çœ‹çœ‹æ•ˆæœï¼Œç¬¬ä¸€æ¬¡è®¿é—®ï¼Œèµ„æºå…¨éƒ¨é¢„åŠ è½½å®Œæ¯•ã€‚</p><img src="/2018/02/workbox/wp1.png" title="ç¬¬ä¸€æ¬¡è®¿é—®è¿›è¡Œ Cache"><p>ç¬¬äºŒæ¬¡è®¿é—®ï¼Œè¢«æ ‡è¯†ä¸º <code>exclude</code> çš„ <code>index.html</code> ä¹Ÿè¢«ç¼“å­˜åˆ° <code>workbox-runtime</code> çš„ Cache Storage ä¸‹é¢ï¼ˆè¿™é‡Œè¿™ä¹ˆåšåªæ˜¯ä¸ºäº†åŠŸèƒ½æµ‹è¯•ï¼‰ï¼Œå…¶ä»–èµ„æºæŒ‰ <code>staleWhileRevalidate</code> çš„è§„åˆ™ç›´æ¥ä» Cache è¿”å›ã€‚</p><img src="/2018/02/workbox/wp2.png" title="ç¬¬äºŒæ¬¡è®¿é—®"><p>ä¹‹åç¦»çº¿éƒ½èƒ½è®¿é—®äº†ã€‚å…·ä½“ <a href="https://csbun.github.io/workbox-examples/workbox-using-webpack/dist/index.html">Demo</a> å’Œ <a href="https://github.com/csbun/workbox-examples/tree/master/workbox-using-webpack" target="_blank" rel="noopener">åŸç </a>ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://developers.google.com/web/tools/workbox/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Workbox&lt;/a&gt; Â· JavaScript Libraries for adding offline support to web apps.&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªä¸ºç½‘é¡µåº”ç”¨æ·»åŠ ç¦»çº¿æ”¯æŒçš„ JavaScript åº“ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡å†…å®¹åŸºäº &lt;a href=&quot;mailto:Workbox@3.0.0&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Workbox@3.0.0&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="ServiceWorker" scheme="http://csbun.github.io/blog/tags/ServiceWorker/"/>
    
      <category term="Workbox" scheme="http://csbun.github.io/blog/tags/Workbox/"/>
    
      <category term="PWA" scheme="http://csbun.github.io/blog/tags/PWA/"/>
    
  </entry>
  
  <entry>
    <title>Preact æºç è§£æ â€”â€” h/createElement</title>
    <link href="http://csbun.github.io/blog/2018/01/preact-code-h/"/>
    <id>http://csbun.github.io/blog/2018/01/preact-code-h/</id>
    <published>2018-01-25T12:04:25.000Z</published>
    <updated>2020-11-03T11:52:46.476Z</updated>
    
    <content type="html"><![CDATA[<p>Preact ä¸­çš„ <a href="https://github.com/developit/preact/blob/master/src/h.js" target="_blank" rel="noopener"><code>h</code> æ–¹æ³•</a>ï¼Œç›¸å½“äº React ä¸­çš„ <code>createElement</code>ï¼Œåœ¨ JSX ä¸­ç”¨äºç”Ÿäº§ VNode çš„æ–¹æ³•ã€‚</p><a id="more"></a><h2><span id="tldr">TL;DR;</span></h2><p>è¯·ç›´æ¥çœ‹æœ€åï¼Œ<a href="#å¸¦æ³¨é‡Šçš„æºç ">å¸¦æ³¨é‡Šçš„æºç </a>ã€‚</p><h2><span id="ä»€ä¹ˆæ˜¯-jsx">ä»€ä¹ˆæ˜¯ JSX</span></h2><p>æŒ‰ç…§æºç æŒ‡ç¤ºçš„<a href="https://jasonformat.com/wtf-is-jsx/" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>ï¼Œè¿™æœ‰ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** @jsx h */</span></span><br><span class="line"><span class="keyword">let</span> foo = <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"foo"</span>&gt;</span>Hello!<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure><p>Babel ç­‰å·¥å…·å¯ä»¥å°†å…¶è½¬åŒ–ä¸º</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = h(<span class="string">'div'</span>, &#123;<span class="attr">id</span>:<span class="string">"foo"</span>&#125;, <span class="string">'Hello!'</span>);</span><br></pre></td></tr></table></figure><p>è‡³äºä¸ºä»€ä¹ˆå« <code>h</code>ï¼Œæ˜¯å› ä¸ºè¿™ä¸ª idea æœ€åˆæ¥è‡ª <a href="https://github.com/hyperhype/hyperscript" target="_blank" rel="noopener">hyperscript</a> (â€œhyper<del>text</del>â€œ + â€œ<del>java</del>scriptâ€)ã€‚</p><h2><span id="ä»€ä¹ˆæ˜¯-vnode">ä»€ä¹ˆæ˜¯ VNode</span></h2><p>å­—é¢è§£æï¼ŒVNode = â€œV<del>irtual</del>â€œ + â€œNodeâ€ï¼Œè™šæ‹Ÿ DOM èŠ‚ç‚¹ï¼Œå¤§æ¦‚ä¼šæ˜¯ä»¥ä¸‹è¿™ä¹ˆä¸€ä¸ªç»“æ„ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  nodeName: <span class="string">"div"</span>,</span><br><span class="line">  attributes: &#123;</span><br><span class="line">    <span class="string">"id"</span>: <span class="string">"foo"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  children: [<span class="string">"Hello!"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥å¾ˆç®€å•å˜›ï¼Œ3è¡Œä»£ç å®ç° <code>h</code> æ–¹æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">h</span>(<span class="params">nodeName, attributes, ...args</span>) </span>&#123;  </span><br><span class="line">      <span class="keyword">let</span> children = args.length ? [].concat(...args) : <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">return</span> &#123; nodeName, attributes, children &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œå®æ—¶å½“ç„¶æ²¡æœ‰é‚£ä¹ˆç®€å•ã€‚</p><h2><span id="æºç è§£æ">æºç è§£æ</span></h2><p>å…‰çœ‹ä»£ç æœ‰ç‚¹éš¾è§£é‡Šï¼Œæˆ‘ä»¬å…ˆæ¥ä¸€ä¸ªå°½å¯èƒ½å¤æ‚çš„ç®€å•ä¾‹å­ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** @jsx h */</span></span><br><span class="line"><span class="keyword">import</span> &#123; Component &#125; <span class="keyword">from</span> <span class="string">'preact'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getItem</span>(<span class="params">text, idx</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;</span>`<span class="attr">p</span>$&#123;<span class="attr">idx</span>&#125;`&#125;&gt;</span>&#123;text&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Section</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; children, ...rest &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">section</span> &#123;<span class="attr">...rest</span>&#125;&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">section</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> node = <span class="xml"><span class="tag">&lt;<span class="name">Section</span> <span class="attr">id</span>=<span class="string">"root"</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">color:</span> '<span class="attr">red</span>' &#125;&#125;&gt;</span></span></span><br><span class="line">  &lt;ul id="list"&gt;</span><br><span class="line">    &#123; [ 'Hello', 'World' ].map(getItem) &#125;</span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">  &lt;div id="text"&gt;</span><br><span class="line">    number: &#123;18&#125;;</span><br><span class="line">    string: &#123;'str'&#125;;</span><br><span class="line">    boolean: &#123;true&#125;;</span><br><span class="line">    &#123;/* comment */&#125;</span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">Section</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ Babel å³å¯è½¬æ¢ä¸º js å†…å®¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _preact = <span class="built_in">require</span>(<span class="string">'preact'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getItem</span>(<span class="params">text, idx</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> h(</span><br><span class="line">    <span class="string">'li'</span>,</span><br><span class="line">    &#123; <span class="attr">key</span>: <span class="string">'p'</span> + idx &#125;,</span><br><span class="line">    text</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Section = <span class="function"><span class="keyword">function</span> (<span class="params">_Component</span>) </span>&#123;</span><br><span class="line">  _inherits(Section, _Component);</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Section</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">/* è¿™é‡Œç®€åŒ–äº†éƒ¨åˆ†ä»£ç  */</span></span><br><span class="line">  &#125;</span><br><span class="line">  _createClass(Section, [<span class="comment">/* è¿™é‡Œç®€åŒ–äº†éƒ¨åˆ†ä»£ç  */</span>]);</span><br><span class="line">  <span class="keyword">return</span> Section;</span><br><span class="line">&#125;(_preact.Component);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> node = h(</span><br><span class="line">  Section,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">'root'</span>, <span class="attr">style</span>: &#123; <span class="attr">color</span>: <span class="string">'red'</span> &#125; &#125;,</span><br><span class="line">  h(</span><br><span class="line">    <span class="string">'ul'</span>,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="string">'list'</span> &#125;,</span><br><span class="line">    [<span class="string">'Hello'</span>, <span class="string">'World'</span>].map(getItem)</span><br><span class="line">  ),</span><br><span class="line">  h(</span><br><span class="line">    <span class="string">'div'</span>,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="string">'text'</span> &#125;,</span><br><span class="line">    <span class="string">'number: '</span>,</span><br><span class="line">    <span class="number">18</span>,</span><br><span class="line">    <span class="string">'; string: '</span>,</span><br><span class="line">    <span class="string">'str'</span>,</span><br><span class="line">    <span class="string">'; boolean: '</span>,</span><br><span class="line">    <span class="literal">true</span>,</span><br><span class="line">    <span class="string">';'</span></span><br><span class="line">  )</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ä¸ºäº†æ›´åŠ ç›´è§‚ï¼Œæˆ‘ä»¬å¯ä»¥å°† <code>Section</code> å’Œ <code>.map(getItem)</code> çš„ä»£ç æ‰§è¡Œç»“æœè·å–å‡ºæ¥ï¼Œå¾—åˆ°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Section = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">/* ... */</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> node = h(</span><br><span class="line">  Section,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">'root'</span>, <span class="attr">style</span>: &#123; <span class="attr">color</span>: <span class="string">'red'</span> &#125; &#125;,</span><br><span class="line">  h(</span><br><span class="line">    <span class="string">'ul'</span>,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="string">'list'</span> &#125;,</span><br><span class="line">    [ h(<span class="string">'li'</span>, &#123; <span class="attr">key</span>: <span class="string">'p0'</span> &#125;, <span class="string">'Hello'</span>), h(<span class="string">'li'</span>, &#123; <span class="attr">key</span>: <span class="string">'p1'</span> &#125;, <span class="string">'World'</span>) ]</span><br><span class="line">  ),</span><br><span class="line">  h(</span><br><span class="line">    <span class="string">'div'</span>,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="string">'text'</span> &#125;,</span><br><span class="line">    <span class="string">'number: '</span>,</span><br><span class="line">    <span class="number">18</span>,</span><br><span class="line">    <span class="string">'; string: '</span>,</span><br><span class="line">    <span class="string">'str'</span>,</span><br><span class="line">    <span class="string">'; boolean: '</span>,</span><br><span class="line">    <span class="literal">true</span>,</span><br><span class="line">    <span class="string">';'</span></span><br><span class="line">  )</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä»¬å°†çœ‹çœ‹ï¼Œè¿™é‡Œé¢çš„ 5 ä¸ª <code>h()</code> æˆ–åšäº›ä»€ä¹ˆã€‚ä¸ºäº†é¿å…æºç è§£æä¸­æœ‰ä»»ä½•å·®å¼‚ï¼Œæˆ‘è¿™é‡Œå‚ç…§çš„æ˜¯ <a href="mailto:Preact@8.2.7" target="_blank" rel="noopener">Preact@8.2.7</a> çš„<a href="https://github.com/developit/preact/blob/17cc8deddd3d4e592685dfa42e832f6e8d2cb795/src/h.js" target="_blank" rel="noopener">ä»£ç </a>ï¼š</p><h3><span id="å•ä¸ª-child-çš„ç®€å•-vnode">å•ä¸ª Child çš„ç®€å• VNode</span></h3><p>æˆ‘ä»¬é¦–å…ˆå¤„ç†ä¸¤ä¸ªæœ€ç®€å•çš„ <code>&lt;li&gt;</code>ï¼š <code>h(&#39;li&#39;, { key: &#39;p0&#39; }, &#39;Hello&#39;)</code>ã€‚é¦–å…ˆï¼Œå¯ä»¥çœ‹åˆ° <a href="https://github.com/developit/preact/blob/17cc8deddd3d4e592685dfa42e832f6e8d2cb795/src/h.js#L39" target="_blank" rel="noopener">L39</a> åˆ° <a href="https://github.com/developit/preact/blob/17cc8deddd3d4e592685dfa42e832f6e8d2cb795/src/h.js#L45" target="_blank" rel="noopener">L45</a>ï¼Œå°†ç¬¬ä¸‰ä¸ªåŠä»¥åçš„å‚æ•°éƒ½ä½œä¸º children æ¨å…¥ stackï¼Œå¦‚æœæœ‰ attributes.childrenï¼Œä¹Ÿæ¨å…¥ stackï¼Œå¹¶åˆ é™¤è¿™ä¸ªå±æ€§ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stack = [ <span class="string">'Hello'</span> ];</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å¼€å§‹é€šè¿‡ <code>while (stack.length)</code> éå†è¿™ä¸ªæ•°ç»„ï¼Œä½†å®é™…ä¸Šè‡ªæœ‰ <code>&#39;Hello&#39;</code> è¿™ä¸€ä¸ª <code>child</code>ï¼Œä¸” <a href="https://github.com/developit/preact/blob/17cc8deddd3d4e592685dfa42e832f6e8d2cb795/src/h.js#L53" target="_blank" rel="noopener">L53</a> åˆ° <a href="https://github.com/developit/preact/blob/17cc8deddd3d4e592685dfa42e832f6e8d2cb795/src/h.js#L57" target="_blank" rel="noopener">L57</a> åˆ¤æ–­ <code>simple</code> ä¸º <code>true</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ <a href="https://github.com/developit/preact/blob/17cc8deddd3d4e592685dfa42e832f6e8d2cb795/src/h.js#L63" target="_blank" rel="noopener">L63</a> å¾—åˆ°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">children = [ <span class="string">'Hello'</span> ];</span><br></pre></td></tr></table></figure><p>å› æ­¤ç”± <a href="https://github.com/developit/preact/blob/17cc8deddd3d4e592685dfa42e832f6e8d2cb795/src/h.js#L73" target="_blank" rel="noopener">L73</a> åˆ° <a href="https://github.com/developit/preact/blob/17cc8deddd3d4e592685dfa42e832f6e8d2cb795/src/h.js#L77" target="_blank" rel="noopener">L77</a> å¾—åˆ°è¿™ä¸ª VNodeï¼Œæ›´ç›´è§‚åœ°ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ª JSON æ¥è®°å½•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  nodeName: <span class="string">'li'</span>,</span><br><span class="line">  children: [ <span class="string">'Hello'</span> ],</span><br><span class="line">  attributes: &#123; <span class="attr">key</span>: <span class="string">'p0'</span> &#125;,</span><br><span class="line">  key: <span class="string">'p0'</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="simple-child-ä¼˜åŒ–">Simple Child ä¼˜åŒ–</span></h3><p>å†çœ‹çœ‹ <code>h(&#39;div&#39;, { id: &#39;text&#39; }, ... }</code> è¿™éƒ¨åˆ†ï¼Œå’Œä¸Šé¢çš„ <code>li</code> å·®ä¸å¤šï¼Œ(<code>{/* comment */}</code> éƒ¨åˆ†å·²ç»åœ¨ Babel ä¸­è¢«å»é™¤)ï¼Œæ³¨æ„å…¨éƒ¨å†…å®¹å·²ç»ååºï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">stack = [</span><br><span class="line">  <span class="string">';'</span></span><br><span class="line">  <span class="literal">true</span>,</span><br><span class="line">  <span class="string">'; boolean: '</span>,</span><br><span class="line">  <span class="string">'str'</span>,</span><br><span class="line">  <span class="string">'; string: '</span>,</span><br><span class="line">  <span class="number">18</span>,</span><br><span class="line">  <span class="string">'number: '</span>,</span><br><span class="line">];</span><br></pre></td></tr></table></figure><p>è€Œå› ä¸º <a href="https://github.com/developit/preact/blob/17cc8deddd3d4e592685dfa42e832f6e8d2cb795/src/h.js#L53" target="_blank" rel="noopener">L53</a> åˆ° <a href="https://github.com/developit/preact/blob/17cc8deddd3d4e592685dfa42e832f6e8d2cb795/src/h.js#L57" target="_blank" rel="noopener">L57</a> åˆ¤æ–­ <code>simple</code> ä¸€ç›´ä¸º <code>true</code>ï¼ˆå› ä¸º L51 å’Œ L54ï¼Œboolean åé¢çš„ <code>true</code> è¢«è½¬æ¢æˆäº† â€˜â€™ï¼‰ï¼Œæ‰€ä»¥ child ä¸€ç›´åœ¨ æˆ‘ä»¬åœ¨ <a href="https://github.com/developit/preact/blob/17cc8deddd3d4e592685dfa42e832f6e8d2cb795/src/h.js#L60" target="_blank" rel="noopener">L60</a> è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œæœ€ç»ˆå¾—åˆ°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  nodeName: <span class="string">'div'</span>,</span><br><span class="line">  children: [ <span class="string">'number: 18; string: str; boolean: ;'</span> ],</span><br><span class="line">  attributes: &#123; <span class="attr">id</span>: <span class="string">'text'</span> &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="æ•°ç»„-child-çš„ä¼˜åŒ–">æ•°ç»„ Child çš„ä¼˜åŒ–</span></h3><p>å›åˆ°åˆšåˆšæ„å»ºå¥½çš„ä¸¤ä¸ª <code>&lt;li&gt;</code>ï¼Œç°åœ¨å¯ä»¥çœ‹çœ‹ <code>&lt;ul&gt;</code>ï¼Œä¼ªä»£ç è¡¨ç¤ºï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">h(</span><br><span class="line">  <span class="string">'ul'</span>,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">'list'</span> &#125;,</span><br><span class="line">  [ VNode(<span class="string">'p0'</span>), VNode(<span class="string">'p1'</span>) ] <span class="comment">// è¿™é‡Œæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¸æ˜¯ä¸¤ä¸ªåˆ†å¼€çš„å‚æ•°</span></span><br><span class="line">),</span><br></pre></td></tr></table></figure><p>åœ¨ <code>while</code> ä¹‹å‰å¾—åˆ°çš„æ˜¯ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stack = [ [ VNode(<span class="string">'p0'</span>), VNode(<span class="string">'p1'</span>) ] ];</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿˜æ˜¯åŸæœ¬çš„å¥—è·¯ï¼Œæœ€ç»ˆ children ä¹Ÿå°†ä¼šæ˜¯ä¸€ä¸ªâ€œæ•°ç»„å¥—æ•°ç»„â€çš„ç»“æ„ï¼Œäºæ˜¯å¯ä»¥çœ‹åˆ° <a href="https://github.com/developit/preact/blob/17cc8deddd3d4e592685dfa42e832f6e8d2cb795/src/h.js#L48" target="_blank" rel="noopener">L48</a> å°†æ•°ç»„çš„å†…å®¹å†æ¬¡æ‹†å¼€ push è¿› stackã€‚äºæ˜¯å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ›´å¥½çœ‹çš„ç»“æœï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  nodeName: <span class="string">'ul'</span>,</span><br><span class="line">  children: [ VNode(<span class="string">'p0'</span>), VNode(<span class="string">'p1'</span>) ],</span><br><span class="line">  attributes: &#123; <span class="attr">id</span>: <span class="string">'list'</span> &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="è‡ªå®šä¹‰-component">è‡ªå®šä¹‰ Component</span></h3><p>æœ€åä¸€ä¸ª <code>h</code> æ˜¯æœ€å¤–å±‚çš„ <code>&lt;Section&gt;</code>ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæœ€å¤§çš„å·®å¼‚åœ¨äºï¼Œ <code>nodeName = Section</code> å·²ç»ä¸æ˜¯ä¸€ä¸ªç±»ä¼¼ <code>div</code> ä¸€èˆ¬çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ä¸€ä¸ª <code>Component</code>ï¼Œå³ä¸ºä¸€ä¸ª <code>function</code>ï¼Œåœ¨ <a href="https://github.com/developit/preact/blob/17cc8deddd3d4e592685dfa42e832f6e8d2cb795/src/h.js#L53" target="_blank" rel="noopener">L53</a> ä¸­å¯ä»¥çœ‹åˆ°è¿™ç±»çš„ nodeName æ˜¯ <strong>ä¸ simple</strong> çš„ï¼Œäºæ˜¯ç›´æ¥ä¼šæŠŠè¯´æœ‰ child push è¿› children é‡Œé¢ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  nodeName: Section, <span class="comment">// Section is a function</span></span><br><span class="line">  children: [ VNode(<span class="string">'ul#list'</span>), VNode(<span class="string">'div#text'</span>) ],</span><br><span class="line">  attributes: &#123; <span class="attr">id</span>: <span class="string">'root'</span>, <span class="attr">style</span>: &#123; <span class="attr">color</span>: <span class="string">'red'</span> &#125; &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œå› ä¸º <strong>ä¸ simple</strong>ï¼Œå³ä½¿ stack é‡Œæœ‰è¿ä¸²çš„ string æˆ– numberï¼Œä¹Ÿä¸ä¼šåšæ‹¼æ¥ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">h(</span><br><span class="line">  Section,</span><br><span class="line">  <span class="literal">null</span>,</span><br><span class="line">  <span class="string">'string: '</span>,</span><br><span class="line">  <span class="string">'str'</span>,</span><br><span class="line">  <span class="string">';'</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">// =&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">  nodeName: Section, <span class="comment">// Section is a function</span></span><br><span class="line">  children: [ <span class="string">'string: '</span>, <span class="string">'str'</span>, <span class="string">';'</span> ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="æœ€ç»ˆç»“æœ">æœ€ç»ˆç»“æœ</span></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  nodeName: Section, <span class="comment">// Section is a function</span></span><br><span class="line">  attributes: &#123; <span class="attr">id</span>: <span class="string">'root'</span>, <span class="attr">style</span>: &#123; <span class="attr">color</span>: <span class="string">'red'</span> &#125; &#125;,</span><br><span class="line">  children: [&#123;</span><br><span class="line">    nodeName: <span class="string">'ul'</span>,</span><br><span class="line">    attributes: &#123; <span class="attr">id</span>: <span class="string">'list'</span> &#125;,</span><br><span class="line">    children: [&#123;</span><br><span class="line">      nodeName: <span class="string">'li'</span>,</span><br><span class="line">      key: <span class="string">'p0'</span>,</span><br><span class="line">      attributes: &#123; <span class="attr">key</span>: <span class="string">'p0'</span> &#125;,</span><br><span class="line">      children: [ <span class="string">'Hello'</span> ],</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      nodeName: <span class="string">'li'</span>,</span><br><span class="line">      key: <span class="string">'p1'</span>,</span><br><span class="line">      attributes: &#123; <span class="attr">key</span>: <span class="string">'p1'</span> &#125;,</span><br><span class="line">      children: [ <span class="string">'World'</span> ],</span><br><span class="line">    &#125;],</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    nodeName: <span class="string">'div'</span>,</span><br><span class="line">    children: [ <span class="string">'number: 18; string: str; boolean: ;'</span> ],</span><br><span class="line">    attributes: &#123; <span class="attr">id</span>: <span class="string">'text'</span> &#125;,</span><br><span class="line">  &#125;],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="å¸¦æ³¨é‡Šçš„æºç ">å¸¦æ³¨é‡Šçš„æºç </span></h2><p>æœ€åå°†ä¸Šé¢çš„å…¨éƒ¨å†…å®¹å†™æˆæ³¨é‡Šï¼Œæ”¾åˆ°æºç ä¸­ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; VNode &#125; <span class="keyword">from</span> <span class="string">'./vnode'</span>;</span><br><span class="line"><span class="keyword">import</span> options <span class="keyword">from</span> <span class="string">'./options'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é—®é¢˜ç‚¹ï¼šä¸ºäº†é˜²æ­¢å…¬å…±å˜é‡æ±¡æŸ“ï¼Œæ”¾åˆ° h æ–¹æ³•é‡Œé¢ä¼šä¸ä¼šæ›´å¥½ï¼Ÿè¿˜æ˜¯è¯´æ˜¯æ€§èƒ½è€ƒè™‘ï¼Ÿ</span></span><br><span class="line"><span class="keyword">const</span> stack = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> EMPTY_CHILDREN = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JSX/hyperscript reviver.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">h</span>(<span class="params">nodeName, attributes</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// é—®é¢˜ç‚¹ï¼šchildren=EMPTY_CHILDREN ä¸ºä½•ä¸ç›´æ¥åœ¨è¿™é‡Œç›´æ¥åˆå§‹åŒ– children=[]</span></span><br><span class="line">  <span class="comment">// é‚£ä¸‹é¢ä¹Ÿå¯ä»¥å‡å°‘ä¸€æ¬¡åˆ¤æ–­ `else if (children===EMPTY_CHILDREN)`</span></span><br><span class="line">  <span class="keyword">let</span> children=EMPTY_CHILDREN, lastSimple, child, simple, i;</span><br><span class="line">  <span class="comment">// é¦–å…ˆå°† children ååºæ¨å…¥ stack</span></span><br><span class="line">  <span class="keyword">for</span> (i=<span class="built_in">arguments</span>.length; i-- &gt; <span class="number">2</span>; ) &#123;</span><br><span class="line">    stack.push(<span class="built_in">arguments</span>[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœæœ‰ attributes.childrenï¼Œä¹Ÿæ¨å…¥ stackï¼Œå¹¶åˆ é™¤è¿™ä¸ªå±æ€§</span></span><br><span class="line">  <span class="keyword">if</span> (attributes &amp;&amp; attributes.children!=<span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!stack.length) stack.push(attributes.children);</span><br><span class="line">    <span class="keyword">delete</span> attributes.children;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¾ªç¯éå† stack/children</span></span><br><span class="line">  <span class="keyword">while</span> (stack.length) &#123;</span><br><span class="line">    <span class="keyword">if</span> ((child = stack.pop()) &amp;&amp; child.pop!==<span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœ child æœ¬èº«ä¹Ÿæ˜¯ä¸ªæ•°ç»„ï¼ˆä¹Ÿå¯èƒ½æ¥è‡ªä¸Šé¢çš„ attributes.childrenï¼‰ï¼Œé‚£ä¹Ÿå°†å…¶ååº push åˆ° stack ä¸­ï¼ˆä¹‹ååœ¨ while åˆä¼šè¢« pop å‡ºæ¥ï¼‰</span></span><br><span class="line">      <span class="keyword">for</span> (i=child.length; i--; ) stack.push(child[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// boolean å€¼è½¬ä¸º nullï¼Ÿ</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> child===<span class="string">'boolean'</span>) child = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å½“ nodeName ä¸æ˜¯å‡½æ•°ï¼ˆè‡ªå®šä¹‰çš„ Componentï¼‰ï¼Œä¸” child æ˜¯ nullã€numberã€string æ—¶è§†ä¸º simpleï¼Œä¸”å…¨éƒ¨è½¬ä¸º string</span></span><br><span class="line">      <span class="keyword">if</span> ((simple = <span class="keyword">typeof</span> nodeName!==<span class="string">'function'</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (child==<span class="literal">null</span>) child = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> child===<span class="string">'number'</span>) child = <span class="built_in">String</span>(child);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> child!==<span class="string">'string'</span>) simple = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (simple &amp;&amp; lastSimple) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœè¿ç»­ä¸¤ä¸ª child éƒ½æ˜¯ simple çš„ï¼Œé‚£è‡ªæ¥å°†å½“æœŸ child å­—ç¬¦ä¸²æ‹¼æ¥åˆ°ä¸Šä¸€ä¸ªåé¢</span></span><br><span class="line">        children[children.length<span class="number">-1</span>] += child;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (children===EMPTY_CHILDREN) &#123;</span><br><span class="line">        <span class="comment">// ç¬¬ä¸€ä¸ª child</span></span><br><span class="line">        children = [child];</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å…¶ä»–ä¸ simple çš„ child</span></span><br><span class="line">        children.push(child);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      lastSimple = simple;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ„å»º VNode</span></span><br><span class="line">  <span class="keyword">let</span> p = <span class="keyword">new</span> VNode();</span><br><span class="line">  p.nodeName = nodeName;</span><br><span class="line">  p.children = children;</span><br><span class="line">  p.attributes = attributes==<span class="literal">null</span> ? <span class="literal">undefined</span> : attributes;</span><br><span class="line">  p.key = attributes==<span class="literal">null</span> ? <span class="literal">undefined</span> : attributes.key;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// if a "vnode hook" is defined, pass every created VNode to it</span></span><br><span class="line">  <span class="keyword">if</span> (options.vnode!==<span class="literal">undefined</span>) options.vnode(p);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Preact ä¸­çš„ &lt;a href=&quot;https://github.com/developit/preact/blob/master/src/h.js&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;code&gt;h&lt;/code&gt; æ–¹æ³•&lt;/a&gt;ï¼Œç›¸å½“äº React ä¸­çš„ &lt;code&gt;createElement&lt;/code&gt;ï¼Œåœ¨ JSX ä¸­ç”¨äºç”Ÿäº§ VNode çš„æ–¹æ³•ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Preact" scheme="http://csbun.github.io/blog/tags/Preact/"/>
    
  </entry>
  
  <entry>
    <title>è¯‘æ–‡ï¼šPuppeteer ä¸ Chrome Headless â€”â€” ä»å…¥é—¨åˆ°çˆ¬è™«</title>
    <link href="http://csbun.github.io/blog/2017/09/puppeteer/"/>
    <id>http://csbun.github.io/blog/2017/09/puppeteer/</id>
    <published>2017-08-31T16:14:09.000Z</published>
    <updated>2020-11-03T11:52:46.476Z</updated>
    
    <content type="html"><![CDATA[<p><strong>è¿™é‡Œæ˜¯ <a href="https://github.com/emadehsan/thal" target="_blank" rel="noopener">GitHub è‹±æ–‡åŸæ–‡</a></strong> / <strong><a href="https://medium.com/@e_mad_ehsan/getting-started-with-puppeteer-and-chrome-headless-for-web-scrapping-6bf5979dee3e" target="_blank" rel="noopener">Medium è‹±æ–‡åŸæ–‡</a></strong></p><p><img src="https://github.com/csbun/thal/raw/master/media/desertious.jpg" alt="A Desert in painters perception"></p><p><a href="https://github.com/GoogleChrome/puppeteer" target="_blank" rel="noopener"><code>Puppeteer</code></a> æ˜¯ Google Chrome å›¢é˜Ÿå®˜æ–¹çš„æ— ç•Œé¢ï¼ˆHeadlessï¼‰Chrome å·¥å…·ã€‚æ­£å› ä¸ºè¿™ä¸ªå®˜æ–¹å£°æ˜ï¼Œè®¸å¤šä¸šå†…è‡ªåŠ¨åŒ–æµ‹è¯•åº“éƒ½å·²ç»åœæ­¢ç»´æŠ¤ï¼ŒåŒ…æ‹¬ <strong><a href="http://phantomjs.org/" target="_blank" rel="noopener">PhantomJS</a></strong>ã€‚<strong><a href="https://addons.mozilla.org/en-US/firefox/addon/selenium-ide/" target="_blank" rel="noopener">Selenium IDE for Firefox</a></strong> é¡¹ç›®ä¹Ÿå› ä¸ºç¼ºä¹ç»´æŠ¤è€…è€Œç»ˆæ­¢ã€‚</p><blockquote><p>è¯‘è€…æ³¨ï¼šå…³äº PhantomJS å’Œ Selenium IDE for Firefox åœæ­¢ç»´æŠ¤å¹¶æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„å…¬å‘Šï¼Œä½†è¿™ä¸¤ä¸ªé¡¹ç›®çš„ç¡®å·²ç»éƒ½è¶…è¿‡ 2 å¹´æ²¡æœ‰å‘å¸ƒæ–°ç‰ˆæœ¬äº†ã€‚ä½†å¦ä¸€ä¸ªä»Šå¹´ 5 æœˆæ‰å¼€å¯çš„é¡¹ç›® <a href="https://github.com/graphcool/chromeless" target="_blank" rel="noopener">Chromeless</a> ç›®å‰åœ¨ Github ä¸Šå·²ç»è¶…è¿‡ 1w starï¼Œç›®å‰è¿˜éå¸¸æ´»è·ƒã€‚</p></blockquote><p>Chrome ä½œä¸ºæµè§ˆå™¨å¸‚åœºçš„é¢†å¤´ç¾Šï¼Œ<strong>Chrome Headless</strong> å¿…å°†æˆä¸º web åº”ç”¨ <strong>è‡ªåŠ¨åŒ–æµ‹è¯•</strong> çš„è¡Œä¸šæ ‡æ†ã€‚æ‰€ä»¥æˆ‘æ•´åˆäº†è¿™ä»½å¦‚ä½•åˆ©ç”¨ <strong>Chrome Headless</strong> åš <code>ç½‘é¡µçˆ¬è™«</code> çš„å…¥é—¨æŒ‡å—ã€‚</p><a id="more"></a><h2><span id="tldr">TL;DR</span></h2><p>æœ¬æ–‡æˆ‘ä»¬å°†ä½¿ç”¨ <code>Chrome Headless</code>, <code>Puppeteer</code>, <code>Node</code> å’Œ <code>MongoDB</code>ï¼Œçˆ¬å– GitHubï¼Œç™»å½•å¹¶æå–å’Œä¿å­˜ç”¨æˆ·çš„é‚®ç®±ã€‚ä¸ç”¨æ‹…å¿ƒ GitHub çš„é¢‘ç‡é™åˆ¶ï¼Œæœ¬æ–‡ä¼šåŸºäº Chrome Headless å’Œ Node ç»™ä½ ç›¸åº”çš„ç­–ç•¥ã€‚åŒæ—¶ï¼Œè¯·æ—¶åˆ»å…³æ³¨ <code>Puppeteer</code> çš„<a href="https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md" target="_blank" rel="noopener">æ–‡æ¡£</a>ï¼Œå› ä¸ºè¯¥é¡¹ç›®ä»ç„¶å¤„äºå¼€å‘ä¸­ï¼ŒAPI å¹¶ä¸æ˜¯å¾ˆç¨³å®šã€‚</p><h2><span id="å¼€å§‹">å¼€å§‹</span></h2><p>å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…ä»¥ä¸‹å·¥å…·ã€‚ç‚¹å‡»ä»–ä»¬çš„å®˜ç½‘ç„¶åå®‰è£…å§ã€‚</p><ul><li><a href="https://nodejs.org" target="_blank" rel="noopener">Node 8.+</a></li><li><a href="http://mongodb.com" target="_blank" rel="noopener">MongoDB</a></li></ul><blockquote><p>è¯‘è€…æ³¨ï¼šPuppeteer è¦æ±‚ä½¿ç”¨ Node v6.4.0ï¼Œä½†å› ä¸ºæ–‡ä¸­å¤§é‡ä½¿ç”¨ <code>async/await</code>ï¼Œéœ€è¦ Node v7.6.0 æˆ–ä»¥ä¸Šã€‚</p></blockquote><h2><span id="åˆå§‹åŒ–é¡¹ç›®">åˆå§‹åŒ–é¡¹ç›®</span></h2><p>é¡¹ç›®éƒ½æ˜¯ä»¥åˆ›å»ºæ–‡ä»¶å¤¹å¼€å§‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir thal</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> thal</span></span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ– NPMï¼Œå¡«å…¥ä¸€äº›å¿…è¦çš„ä¿¡æ¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm init</span></span><br></pre></td></tr></table></figure><p>å®‰è£… <code>Puppeteer</code>ã€‚ç”±äº <code>Puppeteer</code> å¹¶ä¸æ˜¯ç¨³å®šçš„ç‰ˆæœ¬è€Œä¸”æ¯å¤©éƒ½åœ¨æ›´æ–°ï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³è¦æœ€æ–°çš„åŠŸèƒ½å¯ä»¥ç›´æ¥é€šè¿‡ GitHub çš„<a href="https://github.com/GoogleChrome/puppeteer" target="_blank" rel="noopener">ä»“åº“</a>å®‰è£…ã€‚<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm i --save puppeteer</span></span><br></pre></td></tr></table></figure></p><p>Puppeteer åŒ…å«äº†è‡ªå·±çš„ chrome / chromium ç”¨ä»¥ç¡®ä¿å¯ä»¥æ— ç•Œé¢åœ°å·¥ä½œã€‚å› æ­¤æ¯å½“ä½ å®‰è£…/æ›´æ–° puppeteer çš„æ—¶å€™ï¼Œä»–éƒ½ä¼šä¸‹è½½æŒ‡å®šçš„ chrome ç‰ˆæœ¬ã€‚</p><h2><span id="ç¼–ç ">ç¼–ç </span></h2><p>æˆ‘ä»¬å°†ä»é¡µé¢æˆªå›¾å¼€å§‹ï¼Œè¿™æ˜¯ä»–ä»¬çš„æ–‡æ¡£ä¸­çš„ä»£ç ã€‚</p><h3><span id="é¡µé¢æˆªå›¾">é¡µé¢æˆªå›¾</span></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">'puppeteer'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.launch();</span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> page.goto(<span class="string">'https://github.com'</span>);</span><br><span class="line">  <span class="keyword">await</span> page.screenshot(&#123;<span class="attr">path</span>: <span class="string">'screenshots/github.png'</span>&#125;);</span><br><span class="line"></span><br><span class="line">  browser.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">run();</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨ç¬¬ä¸€æ¬¡ä½¿ç”¨ <code>Node</code> 7 æˆ– 8ï¼Œé‚£ä½ å¯èƒ½ä¸å¤ªç†Ÿæ‚‰ <code>async</code> å’Œ <code>await</code> å…³é”®å­—ã€‚ç®€å•åœ°è¯´ï¼Œä¸€ä¸ª <code>async</code> å‡½æ•°è¿”å›ä¸€ä¸ª Promiseï¼Œå½“ Promise å®Œæˆæ—¶ä¼šè¿”å›ä½ æ‰€å®šä¹‰çš„å†…å®¹ã€‚å½“ä½ éœ€è¦åƒåŒæ­¥å‡½æ•°é‚£æ ·è°ƒç”¨æ—¶ï¼Œéœ€è¦ä½¿ç”¨ <code>await</code>ã€‚</p><p>ä¿å­˜ä¸Šé¢çš„ä»£ç ä¸º <code>index.js</code> æ–‡ä»¶åˆ°é¡¹ç›®ç›®å½•é‡Œã€‚å¹¶è¿è¡Œ</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">node</span> <span class="title">index</span>.js</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆªå›¾å°±ä¼šè¢«ä¿å­˜åˆ° <code>screenshots/</code> ç›®å½•ä¸‹ã€‚</p><p><img src="https://github.com/csbun/thal/raw/master/screenshots/github.png" alt="GitHub"></p><h3><span id="ç™»å½•-github">ç™»å½• GitHub</span></h3><p>å¦‚æœä½ åœ¨ GitHub ä¸Šæœç´¢ <em>john</em>ï¼Œç„¶åç‚¹å‡» Users æ ‡ç­¾ï¼Œä½ å°†çœ‹åˆ°ä¸€ä¸ªå¸¦æœ‰å§“åä¿¡æ¯çš„ç”¨æˆ·åˆ—è¡¨ã€‚</p><p><img src="https://github.com/csbun/thal/raw/master/media/all-johns.png" alt="Johns"></p><p>æœ‰äº›ç”¨æˆ·è®¾ç½®äº†ä»–ä»¬çš„é‚®ç®±æ˜¯å…¬å¼€å¯è§çš„ï¼Œä½†æœ‰äº›ç”¨æˆ·æ²¡æœ‰ã€‚ä½†ä½ ä¸€ä¸ªé‚®ç®±éƒ½çœ‹ä¸åˆ°çš„åŸå› æ˜¯æ²¡æœ‰ç™»å½•ã€‚ä¸‹é¢ï¼Œè®©æˆ‘ä»¬åˆ©ç”¨ <a href="https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md" target="_blank" rel="noopener">Puppeteer æ–‡æ¡£</a> æ¥ç™»å½•å§~</p><blockquote><p>è¯‘è€…æ³¨ï¼šä¸Šå›¾æ˜¯ç™»å½•åçœ‹åˆ°çš„æ•ˆæœ</p></blockquote><p>åœ¨é¡¹ç›®æ ¹ç›®å½•æ·»åŠ ä¸€ä¸ª <code>creds.js</code> æ–‡ä»¶ã€‚æˆ‘å¼ºçƒˆå»ºè®®ç”¨ä¸€ä¸ªæ²¡ä»€ä¹ˆåµç”¨çš„é‚®ç®±æ¥æ³¨å†Œä¸€ä¸ªæ–° GitHub è´¦å·ï¼Œä¸ç„¶ GitHub å¯èƒ½ä¼šå°æ‰ä½ çš„å¸¸ç”¨è´¦å·ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  username: <span class="string">'&lt;GITHUB_USERNAME&gt;'</span>,</span><br><span class="line">  password: <span class="string">'&lt;GITHUB_PASSWORD&gt;'</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åŒæ—¶æ·»åŠ ä¸€ä¸ª <code>.gitignore</code> æ–‡ä»¶ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node_modules/</span><br><span class="line">creds.js</span><br></pre></td></tr></table></figure><h4><span id="ä»¥éæ— ç•Œé¢non-headlessæ¨¡å¼å¯åŠ¨">ä»¥éæ— ç•Œé¢ï¼ˆnon headlessï¼‰æ¨¡å¼å¯åŠ¨</span></h4><p>åœ¨è°ƒç”¨ Puppeteer çš„ <code>launch</code> æ–¹æ³•çš„æ—¶å€™ä¼ å…¥å‚æ•°å¯¹è±¡ä¸­å¸¦æœ‰ <code>headless: false</code>ï¼Œå³å¯å¯åŠ¨å…¶ GUI ç•Œé¢ï¼Œè¿›è¡Œå¯è§†åŒ–è°ƒè¯•ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.launch(&#123;</span><br><span class="line">  headless: <span class="literal">false</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è·³è½¬åˆ°ç™»å½•é¡µ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> page.goto(<span class="string">'https://github.com/login'</span>);</span><br></pre></td></tr></table></figure><p>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ <a href="https://github.com/login" target="_blank" rel="noopener">https://github.com/login</a>ã€‚å³å‡» <strong>Username or email address</strong> ä¸‹æ–¹çš„è¾“å…¥æ¡†ï¼ˆè¯‘è€…æ³¨ï¼šå¹¶é€‰æ‹© <strong>Inspect</strong>ï¼‰ã€‚åœ¨å¼€å‘è€…å·¥å…·ä¸­ï¼Œå³å‡»è¢«é«˜äº®çš„ä»£ç é€‰æ‹© <code>Copy</code> &gt; <code>Copy selector</code>ã€‚</p><p><img src="https://github.com/csbun/thal/raw/master/media/copy-selector.png" alt="Copy dom element selector"></p><p>æŠŠå¤åˆ¶å‡ºæ¥çš„å€¼æ”¾åˆ°ä»¥ä¸‹å¸¸é‡ä¸­</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> USERNAME_SELECTOR = <span class="string">'#login_field'</span>; <span class="comment">// "#login_field" å°±æ˜¯è¢«å¤åˆ¶å‡ºæ¥çš„å€¼</span></span><br></pre></td></tr></table></figure><p>é‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼Œå§ <strong>Password</strong> è¾“å…¥æ¡†å’Œ <strong>Sign in</strong> æŒ‰é’®çš„å€¼ä¹Ÿå¡«å¥½ï¼Œå°†å¾—åˆ°ä¸‹é¢å†…å®¹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dom element selectors</span></span><br><span class="line"><span class="keyword">const</span> USERNAME_SELECTOR = <span class="string">'#login_field'</span>;</span><br><span class="line"><span class="keyword">const</span> PASSWORD_SELECTOR = <span class="string">'#password'</span>;</span><br><span class="line"><span class="keyword">const</span> BUTTON_SELECTOR = <span class="string">'#login &gt; form &gt; div.auth-form-body.mt-3 &gt; input.btn.btn-primary.btn-block'</span>;</span><br></pre></td></tr></table></figure><h4><span id="ç™»å½•">ç™»å½•</span></h4><p>Puppeteer æä¾›äº† <code>click</code> æ–¹æ³•ç”¨æ¥ç‚¹å‡» DOM å…ƒç´ å’Œ <code>type</code> æ–¹æ³•æ¥è¾“å…¥å†…å®¹ã€‚ä¸‹é¢æˆ‘ä»¬å°†å¡«å†™éªŒè¯ä¿¡æ¯å¹¶ç‚¹å‡»ç™»å½•ç„¶ååç­‰è·³è½¬ã€‚</p><p>é¦–å…ˆï¼Œéœ€è¦å¼•å…¥ <code>creds.js</code> æ–‡ä»¶ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> CREDS = <span class="built_in">require</span>(<span class="string">'./creds'</span>);</span><br></pre></td></tr></table></figure><p>ç„¶å</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> page.click(USERNAME_SELECTOR);</span><br><span class="line"><span class="keyword">await</span> page.type(CREDS.username);</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> page.click(PASSWORD_SELECTOR);</span><br><span class="line"><span class="keyword">await</span> page.type(CREDS.password);</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> page.click(BUTTON_SELECTOR);</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> page.waitForNavigation();</span><br></pre></td></tr></table></figure><h3><span id="æœç´¢-github">æœç´¢ GitHub</span></h3><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»ç™»å½•å•¦ï¼æˆ‘ä»¬å¯ä»¥ç‚¹å‡»æœç´¢æ¡†ï¼Œå¡«å†™å¹¶åœ¨ç»“æœé¡µé¢ç‚¹å‡»ç”¨æˆ·æ ‡ç­¾ã€‚ä½†æœ‰ä¸€ä¸ªç®€å•çš„æ–¹æ³•ï¼šæœç´¢è¯·æ±‚é€šå¸¸æ˜¯ GET è¯·æ±‚ï¼Œæ‰€æœ‰å†…å®¹éƒ½æ˜¯é€šè¿‡ URL å‘é€çš„ã€‚æ‰€ä»¥ï¼Œåœ¨æœç´¢æ¡†å†…æ‰‹åŠ¨è¾“å…¥ <code>john</code>ï¼Œç„¶åç‚¹å‡»ç”¨æˆ·æ ‡ç­¾å¹¶å¤åˆ¶åœ°å€æ ä¸Šçš„ç½‘å€ã€‚è¿™å°†æ˜¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> searchUrl = <span class="string">'https://github.com/search?q=john&amp;type=Users&amp;utf8=%E2%9C%93'</span>;</span><br></pre></td></tr></table></figure><p>åšä¸€ä¸¢ä¸¢è°ƒæ•´</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userToSearch = <span class="string">'john'</span>;</span><br><span class="line"><span class="keyword">const</span> searchUrl = <span class="string">'https://github.com/search?q='</span> + userToSearch + <span class="string">'&amp;type=Users&amp;utf8=%E2%9C%93'</span>;</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬è·³è½¬åˆ°è¿™ä¸ªé¡µé¢ï¼Œçœ‹æ˜¯ä¸æ˜¯çœŸçš„æœç´¢åˆ°äº†ï¼Ÿ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> page.goto(searchUrl);</span><br><span class="line"><span class="keyword">await</span> page.waitFor(<span class="number">2</span>*<span class="number">1000</span>);</span><br></pre></td></tr></table></figure><h3><span id="æå–é‚®ç®±åœ°å€">æå–é‚®ç®±åœ°å€</span></h3><blockquote><p>è¯‘è€…æ³¨ï¼šæœ¬å°èŠ‚æ²¡æœ‰ç›´è¯‘ï¼Œå› ä¸ºè¯‘è€…æ²¡æœ‰ä½¿ç”¨ä½œè€…çš„æ–¹æ¡ˆ</p></blockquote><p>æˆ‘ä»¬çš„ç›®çš„æ˜¯æœåˆ®ç”¨æˆ·çš„ <code>username</code> å’Œ <code>email</code>ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ Chrome çš„å¼€å‘è€…å·¥å…·ä¸­çœ‹åˆ°ï¼Œæ¯ä¸ªå•ç‹¬çš„ç”¨æˆ·ä¿¡æ¯éƒ½æ˜¯åœ¨ä¸€ä¸ª class ä¸º <code>user-list-item</code> çš„ <code>&lt;div&gt;</code> å†…ã€‚</p><p>ä¸€ç§æå–å…ƒç´ å†…å®¹çš„æ–¹æ³•æ˜¯ <code>Page</code> or <code>ElementHandle</code> çš„ <code>evaluate</code> æ–¹æ³•ï¼Œå› ä¸ºå®ƒä½œç”¨äºæµè§ˆå™¨è¿è¡Œçš„ä¸Šä¸‹æ–‡ç¯å¢ƒå†…ã€‚å½“æˆ‘ä»¬è·³è½¬åˆ°æœç´¢ç»“æœé¡µçš„æ—¶å€™ï¼Œä½¿ç”¨ <code>page.evaluate</code> æ–¹æ³•å¯ä»¥å°†æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯çš„ div è·å–å‡ºæ¥ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> USER_LIST_INFO_SELECTOR = <span class="string">'.user-list-item'</span>;</span><br><span class="line"><span class="keyword">const</span> users = <span class="keyword">await</span> page.evaluate(<span class="function">(<span class="params">sel</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> $els = <span class="built_in">document</span>.querySelectorAll(sel);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;, USER_LIST_INFO_SELECTOR);</span><br></pre></td></tr></table></figure><p>éå†ä¸Šé¢çš„ <code>$els</code>ï¼Œç»§ç»­ä½¿ç”¨é€‰æ‹©å™¨æå–å‡ºå…¶ä¸­çš„ä¿¡æ¯ã€‚å½“ç„¶ï¼Œè¿™é‡Œçš„é€‰æ‹©å™¨ç›¸å½“äºç”¨æˆ·ä¿¡æ¯çš„ div çš„ï¼Œä¸æ˜¯åƒä¹‹å‰é‚£æ ·ç›´æ¥å¤åˆ¶å‡ºæ¥çš„ï¼Œç¨å¾®æœ‰ä¸€ç‚¹ css çŸ¥è¯†åº”è¯¥èƒ½å¾ˆå®¹æ˜“è¯»æ‡‚ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> USER_LIST_INFO_SELECTOR = <span class="string">'.user-list-item'</span>;</span><br><span class="line"><span class="keyword">const</span> USER_LIST_USERNAME_SELECTOR = <span class="string">'.user-list-info&gt;a:nth-child(1)'</span>;</span><br><span class="line"><span class="keyword">const</span> USER_LIST_EMAIL_SELECTOR = <span class="string">'.user-list-info&gt;.user-list-meta .muted-link'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> users = <span class="keyword">await</span> page.evaluate(<span class="function">(<span class="params">sInfo, sName, sEmail</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Array</span>.prototype.slice.apply(<span class="built_in">document</span>.querySelectorAll(sInfo))</span><br><span class="line">    .map(<span class="function"><span class="params">$userListItem</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// ç”¨æˆ·å</span></span><br><span class="line">      <span class="keyword">const</span> username = $userListItem.querySelector(sName).innerText;</span><br><span class="line">      <span class="comment">// é‚®ç®±</span></span><br><span class="line">      <span class="keyword">const</span> $email = $userListItem.querySelector(sEmail);</span><br><span class="line">      <span class="keyword">const</span> email = $email ? $email.innerText : <span class="literal">undefined</span>;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        username,</span><br><span class="line">        email,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// ä¸æ˜¯æ‰€æœ‰ç”¨æˆ·éƒ½æ˜¾ç¤ºé‚®ç®±</span></span><br><span class="line">    .filter(<span class="function"><span class="params">u</span> =&gt;</span> !!u.email);</span><br><span class="line">&#125;, USER_LIST_INFO_SELECTOR, USER_LIST_USERNAME_SELECTOR, USER_LIST_EMAIL_SELECTOR);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(users);</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œå½“ä½ è¿è¡Œ <code>node index.js</code>ï¼Œä½ è®²çœ‹åˆ° Chrome è·³å‡ºæ¥è‡ªåŠ¨æ‰§è¡Œä¸Šè¿°æ“ä½œåï¼Œåœ¨å‘½ä»¤è¡Œæ‰“å‡º <code>username</code> ä¸å…¶ç›¸å…³çš„ <code>email</code>ã€‚</p><h3><span id="éå†å…¨éƒ¨é¡µé¢">éå†å…¨éƒ¨é¡µé¢</span></h3><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦è¯„ä¼°æœç´¢ç»“æœæœ€åä¸€é¡µçš„é¡µç ã€‚åœ¨æœç´¢ç»“æœé¡µçš„é¡¶éƒ¨ï¼Œä½ å¯ä»¥çœ‹åˆ°å½“æˆ‘åœ¨ç¿»è¯‘è¿™ç¯‡æ–‡ç« æ—¶æœ‰ <strong>70,134 users</strong>ã€‚</p><p><strong>æœ‰è¶£çš„ç°è±¡: å¦‚æœä½ å¯¹æ¯”ä¸Šé¢çš„æˆªå›¾ï¼Œä½ ä¼šå‘ç°è¿™ä¸¤å¤©å·²ç»æœ‰ 371 ä¸ªæ–°çš„ <em>john</em> åŒå­¦åŠ å…¥ GitHubã€‚</strong></p><p><img src="https://github.com/csbun/thal/raw/master/media/num-results-new.png" alt="Number of search items"></p><p>ä»å¼€å‘è€…å·¥å…·å¤åˆ¶äººæ•°çš„é€‰æ‹©å™¨ã€‚æˆ‘ä»¬å°†åœ¨ <code>run</code> å¤–é¢å†™ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œç”¨æ¥è·å–é¡µé¢æ•°ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getNumPages</span>(<span class="params">page</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> NUM_USER_SELECTOR = <span class="string">'#js-pjax-container &gt; div.container &gt; div &gt; div.column.three-fourths.codesearch-results.pr-6 &gt; div.d-flex.flex-justify-between.border-bottom.pb-3 &gt; h3'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> inner = <span class="keyword">await</span> page.evaluate(<span class="function">(<span class="params">sel</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">document</span>.querySelector(sel).innerHTML;</span><br><span class="line">  &#125;, NUM_USER_SELECTOR);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ ¼å¼æ˜¯: "69,803 users"</span></span><br><span class="line">  inner = inner.replace(<span class="string">','</span>, <span class="string">''</span>).replace(<span class="string">' users'</span>, <span class="string">''</span>);</span><br><span class="line">  <span class="keyword">const</span> numUsers = <span class="built_in">parseInt</span>(inner);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'numUsers: '</span>, numUsers);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * GitHub æ¯é¡µæ˜¾ç¤º 10 ä¸ªç»“æœ</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">const</span> numPages = <span class="built_in">Math</span>.ceil(numUsers / <span class="number">10</span>);</span><br><span class="line">  <span class="keyword">return</span> numPages;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æœç´¢ç»“æœé¡µåº•éƒ¨ï¼Œå¦‚æœä½ æŠŠé¼ æ ‡æ‚¬æµ®åœ¨é¡µç æŒ‰é’®ä¸Šé¢ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€é¡µçš„é“¾æ¥ã€‚å¦‚ï¼šç¬¬äºŒé¡µçš„é“¾æ¥æ˜¯ <code>https://github.com/search?p=2&amp;q=john&amp;type=Users&amp;utf8=%E2%9C%93</code>ã€‚æ³¨æ„åˆ° <code>p=2</code> æ˜¯ä¸€ä¸ª URL çš„ query å‚æ•°ï¼Œè¿™å°†å¸®åŠ©æˆ‘ä»¬è·³è½¬åˆ°æŒ‡å®šçš„é¡µé¢ã€‚</p><p>åœ¨æ·»åŠ äº†éå†é¡µç çš„ä»£ç åœ¨ä¸Šé¢çˆ¬å–å†…å®¹çš„æ–¹æ³•ä¹‹åï¼Œä»£ç å˜æˆäº†è¿™æ ·ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> numPages = <span class="keyword">await</span> getNumPages(page);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Numpages: '</span>, numPages);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> h = <span class="number">1</span>; h &lt;= numPages; h++) &#123;</span><br><span class="line">  <span class="comment">// è·³è½¬åˆ°æŒ‡å®šé¡µç </span></span><br><span class="line">  <span class="keyword">await</span> page.goto(<span class="string">`<span class="subst">$&#123;searchUrl&#125;</span>&amp;p=<span class="subst">$&#123;h&#125;</span>`</span>);</span><br><span class="line">  <span class="comment">// æ‰§è¡Œçˆ¬å–</span></span><br><span class="line">  <span class="keyword">const</span> users = <span class="keyword">await</span> page.evaluate(<span class="function">(<span class="params">sInfo, sName, sEmail</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Array</span>.prototype.slice.apply(<span class="built_in">document</span>.querySelectorAll(sInfo))</span><br><span class="line">      .map(<span class="function"><span class="params">$userListItem</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// ç”¨æˆ·å</span></span><br><span class="line">        <span class="keyword">const</span> username = $userListItem.querySelector(sName).innerText;</span><br><span class="line">        <span class="comment">// é‚®ç®±</span></span><br><span class="line">        <span class="keyword">const</span> $email = $userListItem.querySelector(sEmail);</span><br><span class="line">        <span class="keyword">const</span> email = $email ? $email.innerText : <span class="literal">undefined</span>;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          username,</span><br><span class="line">          email,</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// ä¸æ˜¯æ‰€æœ‰ç”¨æˆ·éƒ½æ˜¾ç¤ºé‚®ç®±</span></span><br><span class="line">      .filter(<span class="function"><span class="params">u</span> =&gt;</span> !!u.email);</span><br><span class="line">  &#125;, USER_LIST_INFO_SELECTOR, USER_LIST_USERNAME_SELECTOR, USER_LIST_EMAIL_SELECTOR);</span><br><span class="line"></span><br><span class="line">  users.map(<span class="function">(<span class="params">&#123;username, email&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> ä¿å­˜ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">    <span class="built_in">console</span>.log(username, <span class="string">'-&gt;'</span>, email);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="ä¿å­˜åˆ°-mongodb">ä¿å­˜åˆ° MongoDB</span></h3><p>åˆ°è¿™é‡Œ <code>Puppeteer</code> çš„éƒ¨åˆ†å·²ç»ç»“æŸäº†ã€‚ä¸‹é¢æˆ‘ä»¬å°†ä½¿ç”¨ <code>mongoose</code> å­˜å‚¨ä¸Šé¢çš„ä¿¡æ¯åˆ° <code>MongoDB</code>ã€‚å®ƒæ˜¯ä¸ª <a href="https://en.wikipedia.org/wiki/Object-relational_mapping" target="_blank" rel="noopener">ORM</a>ï¼Œç¡®åˆ‡è¯´æ˜¯ä¸ªä¾¿äºä»æ•°æ®åº“è¿›è¡Œä¿¡æ¯å­˜å‚¨å’Œæ£€ç´¢çš„åº“ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm i --save mongoose</span></span><br></pre></td></tr></table></figure><p>MongoDB æ˜¯ä¸€ä¸ª Schema-less çš„ NoSQL æ•°æ®åº“ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Mongoose ä½¿å…¶éµå¾ªä¸€äº›åŸåˆ™ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª <code>Model</code>ï¼Œä»–ä»£è¡¨ MongoDB ä¸­çš„ <code>Collection</code>ã€‚åˆ›å»ºä¸€ä¸ª <code>models</code> æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨é‡Œé¢åˆ›å»ºä¸€ä¸ª <code>user.js</code> æ–‡ä»¶ï¼Œå¹¶åŠ å…¥ä»¥ä¸‹ collection çš„æ„é€ å‡½æ•°ä»£ç ã€‚ä¹‹åæ— è®ºæˆ‘ä»¬å¡ä»€ä¹ˆä¸œè¥¿è¿› <code>User</code>ï¼Œä»–éƒ½ä¼šéµå¾ªè¿™ä¸ªç»“æ„ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    username: <span class="built_in">String</span>,</span><br><span class="line">    email: <span class="built_in">String</span>,</span><br><span class="line">    dateCrawled: <span class="built_in">Date</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = mongoose.model(<span class="string">'User'</span>, userSchema);</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹å¾€æ•°æ®åº“å¡æ•°æ®äº†ã€‚ç”±äºæˆ‘ä»¬ä¸å¸Œæœ›æ•°æ®åº“ä¸­å­˜åœ¨é‡å¤çš„ emailï¼Œæ‰€ä»¥æˆ‘ä»¬åªæ–°å¢é‚£äº›ä»¥å‰ä»æ²¡å‡ºç°è¿‡çš„é‚®ç®±ï¼Œå¦åˆ™æˆ‘ä»¬åªæ›´æ–°æ•°æ®ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ mongoose çš„ <code>Model.findOneAndUpdate</code> æ–¹æ³•ã€‚</p><p>å›åˆ° <code>index.js</code>ï¼Œå¼•ç”¨æ‰€éœ€çš„ä¾èµ–ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"><span class="keyword">const</span> User = <span class="built_in">require</span>(<span class="string">'./models/user'</span>);</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªæ–°çš„æ–¹æ³•ï¼Œç”¨äº <strong>upsert</strong> (æ›´æ–° update æˆ– æ–°å¢ insert) ç”¨æˆ·å®ä¾‹ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upsertUser</span>(<span class="params">userObj</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> DB_URL = <span class="string">'mongodb://localhost/thal'</span>;</span><br><span class="line">  <span class="keyword">if</span> (mongoose.connection.readyState == <span class="number">0</span>) &#123;</span><br><span class="line">    mongoose.connect(DB_URL);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// if this email exists, update the entry, don't insert</span></span><br><span class="line">  <span class="comment">// å¦‚æœé‚®ç®±å­˜åœ¨ï¼Œå°±æ›´æ–°å®ä¾‹ï¼Œä¸æ–°å¢</span></span><br><span class="line">  <span class="keyword">const</span> conditions = &#123;</span><br><span class="line">    email: userObj.email</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> options = &#123;</span><br><span class="line">    upsert: <span class="literal">true</span>,</span><br><span class="line">    <span class="keyword">new</span>: <span class="literal">true</span>,</span><br><span class="line">    setDefaultsOnInsert: <span class="literal">true</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  User.findOneAndUpdate(conditions, userObj, options, (err, result) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">throw</span> err;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ MongoDB æœåŠ¡ã€‚ç”¨ä¸‹é¢çš„ä»£ç æ›¿æ¢æ‰ä¹‹å‰çš„æ³¨é‡Šå†…å®¹ <code>// TODO: ä¿å­˜ç”¨æˆ·ä¿¡æ¯</code>ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upsertUser(&#123;</span><br><span class="line">  username: username,</span><br><span class="line">  email: email,</span><br><span class="line">  dateCrawled: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æƒ³è¦æ£€æŸ¥æ˜¯å¦çœŸçš„ä¿å­˜äº†è¿™äº›ç”¨æˆ·ï¼Œå¯ä»¥åˆ° mongo é‡Œé¢æ‰§è¡Œä¸‹åˆ—è„šæœ¬ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mongo</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> use thal</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.users.find().pretty()</span></span><br></pre></td></tr></table></figure><p>ä½ ä¼šçœ‹åˆ°æœ‰å¤šä¸ªç”¨æˆ·åœ¨å·²ç»æ·»åŠ åœ¨é‡Œé¢ï¼Œé‚£ä½ å°±æˆåŠŸäº†å“¦~</p><blockquote><p>è¯‘è€…æ³¨ï¼šä½¿ç”¨ <code>db.users.find().pretty().length()</code> å¯ä»¥æŸ¥çœ‹çˆ¬å–äº†å¤šå°‘æ¡</p></blockquote><h2><span id="æœ€å">æœ€å</span></h2><p>Chrome Headless å’Œ Puppeteer å¼€å¯äº†ç½‘é¡µçˆ¬è™«å’Œè‡ªåŠ¨åŒ–æµ‹è¯•çš„æ–°çºªå…ƒï¼Œè€Œä¸” Chrome Headless è¿˜æ”¯æŒ WebGLï¼ä½ å¯ä»¥æŠŠä½ çš„çˆ¬è™«è„šæœ¬å‘å¸ƒåˆ°äº‘ç«¯ï¼Œç„¶åå°±å¯ä»¥åäº«å…¶æˆã€‚å½“ç„¶ï¼Œå‘å¸ƒåˆ°æœåŠ¡å™¨ä¹‹å‰è¯·è®°å¾—å»æ‰ <code>headless: false</code> é…ç½®ã€‚</p><ul><li>åœ¨çˆ¬å–çš„æ—¶å€™ï¼Œä½ å¯èƒ½ä¼šè¢« GitHub çš„é¢‘ç‡æ§åˆ¶é˜»æ­¢ã€‚</li></ul><p><img src="https://github.com/csbun/thal/raw/master/media/whoa.png" alt="Whoa"></p><ul><li>å¦å¤–ï¼Œæˆ‘å‘ç°ä½ æ— æ³•è·³åˆ° 100 é¡µä¹‹åã€‚</li></ul><blockquote><p>è¯‘è€…æ³¨ï¼šæˆ‘çˆ¬äº†100é¡µå¹¶æ²¡æœ‰è¢«é˜»æ­¢ã€‚ä» 101 é¡µå¼€å§‹å°±å˜æˆäº† 404 é¡µé¢ï¼Œæˆ–è®¸é€šè¿‡é¡µé¢ä¸‹æ–¹çš„é¡µç è¿›è¡Œéå†ä¼šæ›´åˆç†</p></blockquote><h2><span id="ç»“è¯­">ç»“è¯­</span></h2><p>å¹¿é˜”æ— å çš„æ²™æ¼ è§è¯ç€ <code>ç©¿è¶Š</code> è¿™äº›å·¨å¤§çš„æ²™æ»©çš„äººä»¬çš„æ–—äº‰å’Œç‰ºç‰²ã€‚ <a href="https://en.wikipedia.org/wiki/Thal_Desert" target="_blank" rel="noopener"><strong>Thal</strong></a> æ˜¯å·´åŸºæ–¯å¦çš„ä¸€ä¸ªè·¨è¶Šå¤šä¸ªåœ°åŒºçš„æ²™æ¼ ï¼ŒåŒ…æ‹¬æˆ‘çš„å®¶ä¹¡ Bhakkarã€‚ä¸ä»Šå¤©åœ¨ <code>äº’è”ç½‘</code> ä¸Šæœç´¢æ•°æ®çš„æƒ…å†µç±»ä¼¼ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘å°†è¿™ä¸ª repo å‘½åä¸º <code>Thal</code>ã€‚å¦‚æœä½ å–œæ¬¢å®ƒï¼Œé‚£è¯·ä¸ä»–äººåˆ†äº«ã€‚å¦‚æœæ‚¨æœ‰ä»»ä½•å»ºè®®ï¼Œè¯·åœ¨è¿™é‡Œå‘è¡¨è¯„è®ºæˆ–ç›´æ¥ä¸åŸä½œè€…è”ç»œ[@e_mad_ehsan]ï¼ˆ<a href="https://twitter.com/e_mad_ehsanï¼‰ã€‚ä»–å¾ˆä¹æ„å¬åˆ°ä½ çš„æ¶ˆæ¯ã€‚" target="_blank" rel="noopener">https://twitter.com/e_mad_ehsanï¼‰ã€‚ä»–å¾ˆä¹æ„å¬åˆ°ä½ çš„æ¶ˆæ¯ã€‚</a></p><blockquote><p>è¯‘è€…æ³¨ï¼šä¸­æ–‡ç‰ˆä¹Ÿæ¬¢è¿ç›´æ¥æ <a href="https://github.com/csbun/thal/issues" target="_blank" rel="noopener">issue</a> è®¨è®º æˆ– PR</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;è¿™é‡Œæ˜¯ &lt;a href=&quot;https://github.com/emadehsan/thal&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;GitHub è‹±æ–‡åŸæ–‡&lt;/a&gt;&lt;/strong&gt; / &lt;strong&gt;&lt;a href=&quot;https://medium.com/@e_mad_ehsan/getting-started-with-puppeteer-and-chrome-headless-for-web-scrapping-6bf5979dee3e&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Medium è‹±æ–‡åŸæ–‡&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://github.com/csbun/thal/raw/master/media/desertious.jpg&quot; alt=&quot;A Desert in painters perception&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/GoogleChrome/puppeteer&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;code&gt;Puppeteer&lt;/code&gt;&lt;/a&gt; æ˜¯ Google Chrome å›¢é˜Ÿå®˜æ–¹çš„æ— ç•Œé¢ï¼ˆHeadlessï¼‰Chrome å·¥å…·ã€‚æ­£å› ä¸ºè¿™ä¸ªå®˜æ–¹å£°æ˜ï¼Œè®¸å¤šä¸šå†…è‡ªåŠ¨åŒ–æµ‹è¯•åº“éƒ½å·²ç»åœæ­¢ç»´æŠ¤ï¼ŒåŒ…æ‹¬ &lt;strong&gt;&lt;a href=&quot;http://phantomjs.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;PhantomJS&lt;/a&gt;&lt;/strong&gt;ã€‚&lt;strong&gt;&lt;a href=&quot;https://addons.mozilla.org/en-US/firefox/addon/selenium-ide/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Selenium IDE for Firefox&lt;/a&gt;&lt;/strong&gt; é¡¹ç›®ä¹Ÿå› ä¸ºç¼ºä¹ç»´æŠ¤è€…è€Œç»ˆæ­¢ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¯‘è€…æ³¨ï¼šå…³äº PhantomJS å’Œ Selenium IDE for Firefox åœæ­¢ç»´æŠ¤å¹¶æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„å…¬å‘Šï¼Œä½†è¿™ä¸¤ä¸ªé¡¹ç›®çš„ç¡®å·²ç»éƒ½è¶…è¿‡ 2 å¹´æ²¡æœ‰å‘å¸ƒæ–°ç‰ˆæœ¬äº†ã€‚ä½†å¦ä¸€ä¸ªä»Šå¹´ 5 æœˆæ‰å¼€å¯çš„é¡¹ç›® &lt;a href=&quot;https://github.com/graphcool/chromeless&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Chromeless&lt;/a&gt; ç›®å‰åœ¨ Github ä¸Šå·²ç»è¶…è¿‡ 1w starï¼Œç›®å‰è¿˜éå¸¸æ´»è·ƒã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Chrome ä½œä¸ºæµè§ˆå™¨å¸‚åœºçš„é¢†å¤´ç¾Šï¼Œ&lt;strong&gt;Chrome Headless&lt;/strong&gt; å¿…å°†æˆä¸º web åº”ç”¨ &lt;strong&gt;è‡ªåŠ¨åŒ–æµ‹è¯•&lt;/strong&gt; çš„è¡Œä¸šæ ‡æ†ã€‚æ‰€ä»¥æˆ‘æ•´åˆäº†è¿™ä»½å¦‚ä½•åˆ©ç”¨ &lt;strong&gt;Chrome Headless&lt;/strong&gt; åš &lt;code&gt;ç½‘é¡µçˆ¬è™«&lt;/code&gt; çš„å…¥é—¨æŒ‡å—ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Puppeteer" scheme="http://csbun.github.io/blog/tags/Puppeteer/"/>
    
      <category term="Chrome" scheme="http://csbun.github.io/blog/tags/Chrome/"/>
    
      <category term="Headless" scheme="http://csbun.github.io/blog/tags/Headless/"/>
    
  </entry>
  
  <entry>
    <title>npm scripts ä¹‹ publish å’Œ install</title>
    <link href="http://csbun.github.io/blog/2017/08/npm-scripts/"/>
    <id>http://csbun.github.io/blog/2017/08/npm-scripts/</id>
    <published>2017-08-24T10:18:32.000Z</published>
    <updated>2020-11-03T11:52:46.474Z</updated>
    
    <content type="html"><![CDATA[<p>npm <a href="https://docs.npmjs.com/misc/scripts" target="_blank" rel="noopener">è‡ªèº«æä¾›</a>äº†ä¸€äº› scriptï¼Œå¹¶ä¸”æœ‰ä¸€äº›ç‰¹å®šçš„è§„åˆ™ï¼Œæœ€è¿‘ç”¨åˆ°äº†å‡ ä¸ªï¼Œåœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹ï¼Œä¸‹æ–‡æåˆ°çš„ä»£ç ä»“åº“åœ¨ <a href="https://github.com/csbun/npm-scripts-example" target="_blank" rel="noopener">è¿™é‡Œ</a> å¯ä»¥çœ‹åˆ°ã€‚</p><a id="more"></a><h2><span id="publish">publish</span></h2><p>é€šå¸¸ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>npm publish</code> ä¼šæŠŠæ‰€åœ¨ package çš„å½“å‰ç‰ˆæœ¬å‘å¸ƒåˆ° npm ä¸Šã€‚ä½†å¦‚æœæˆ‘ä»¬è¿˜å¸Œæœ›æœ‰æ›´å¤šçš„æ“ä½œï¼Œå°±å¯èƒ½éœ€è¦ç”¨åˆ°ä¸‹é¢è¿™äº›ï¼š</p><ul><li>prepublish: åœ¨æ‰“åŒ…å’Œå‘å¸ƒ <strong>ä¹‹å‰</strong> æ‰§è¡Œï¼ŒåŒæ—¶åœ¨æœ¬åœ°è¿è¡Œä¸å«ä»»ä½•å‚æ•°çš„ <code>npm install</code> æ—¶æ‰§è¡Œï¼ˆè§ä¸‹æ–‡ï¼‰ã€‚</li><li>prepare: åŒæ ·åœ¨æ‰“åŒ…å’Œå‘å¸ƒ <strong>ä¹‹å‰</strong> æ‰§è¡Œï¼ŒåŒæ—¶åœ¨æœ¬åœ°è¿è¡Œä¸å«ä»»ä½•å‚æ•°çš„ <code>npm install</code> æ—¶æ‰§è¡Œï¼ˆè§ä¸‹æ–‡ï¼‰ã€‚å®ƒçš„æ‰§è¡Œæ—¶æœºåœ¨ <code>prepublish</code> ä¹‹åï¼Œåœ¨ <code>prepublishOnly</code> ä¹‹å‰ã€‚</li><li>prepublishOnly: åœ¨æ‰“åŒ…å’Œå‘å¸ƒ <strong>ä¹‹å‰</strong> æ‰§è¡Œã€‚ <strong>ä»…</strong> åœ¨è¿è¡Œ <code>npm publish</code> å‰æ‰§è¡Œã€‚</li><li>prepack: åœ¨ tar æ–‡ä»¶è¢«æ‰“åŒ…å¥½ <strong>ä¹‹å‰</strong> æ‰§è¡Œï¼ˆåœ¨è¿è¡Œ <code>npm pack</code>ï¼Œ<code>npm publish</code> å’Œå®‰è£… git ä¾èµ–æ—¶ï¼‰ã€‚</li><li>postpack: åœ¨ tar æ–‡ä»¶è¢«æ‰“åŒ…å¥½å¹¶ç§»åŠ¨åˆ°æœ€ç»ˆç›®å½• <strong>ä¹‹å</strong> æ‰§è¡Œã€‚</li><li>publishã€postpublish: åœ¨ package å‘å¸ƒ <strong>ä¹‹å</strong>ã€‚</li></ul><p>è¯´æ˜¯è¿™ä¹ˆè¯´ï¼Œä½†çœŸæ­£ä½¿ç”¨ <code>npm publish</code> çš„æ—¶å€™ï¼Œåˆ°åº•ä¼šæ‰§è¡Œé‚£äº› scriptï¼Ÿæˆ‘ä»¬æ‹¿ä¸€ä¸ªå« <code>npm-scripts-example</code> çš„ä¾‹å­æ¥è¯•ä¸€ä¸‹</p><figure class="highlight"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"npm-scripts-example"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"prepublish"</span>: <span class="string">"# Run BEFORE the package is packed and published, as well as on local npm install without any arguments."</span>,</span><br><span class="line">    <span class="attr">"prepare"</span>: <span class="string">"# Run both BEFORE the package is packed and published, and on local npm install without any arguments (See below). This is run AFTER prepublish, but BEFORE prepublishOnly."</span>,</span><br><span class="line">    <span class="attr">"prepublishOnly"</span>: <span class="string">"# Run BEFORE the package is prepared and packed, ONLY on npm publish."</span>,</span><br><span class="line">    <span class="attr">"prepack"</span>: <span class="string">"# Run BEFORE a tarball is packed (on npm pack, npm publish, and when installing git dependencies)."</span>,</span><br><span class="line">    <span class="attr">"postpack"</span>: <span class="string">"# Run AFTER the tarball has been generated and moved to its final destination."</span>,</span><br><span class="line">    <span class="attr">"publish"</span>: <span class="string">"# Run AFTER the package is published."</span>,</span><br><span class="line">    <span class="attr">"postpublish"</span>: <span class="string">"# Run AFTER the package is published."</span>,</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ npm@3ï¼ˆ3.10.8ï¼‰ç¯å¢ƒè¿è¡Œ <code>npm publish</code> ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; npm-scripts-example@0.0.4 prepublish /path/to/npm-scripts-example</span><br><span class="line">&gt; <span class="comment"># Run BEFORE the package is packed and published, as well as on local npm install without any arguments.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸Šä¼ åˆ° npm çš„è¿›åº¦æ¡å‡ºç°åœ¨è¿™é‡Œ</span></span><br><span class="line"></span><br><span class="line">+ npm-scripts-example@0.0.4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; npm-scripts-example@0.0.4 publish .</span><br><span class="line">&gt; <span class="comment"># Run AFTER the package is published.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; npm-scripts-example@0.0.4 postpublish .</span><br><span class="line">&gt; <span class="comment"># Run AFTER the package is published.</span></span><br></pre></td></tr></table></figure><p>å³</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># npm@3</span><br><span class="line">prepublish -&gt; [ä¸Šä¼ è‡³ npm] -&gt; publish -&gt; postpublish</span><br></pre></td></tr></table></figure><p>åœ¨ npm@5ï¼ˆ5.3.0ï¼‰ç¯å¢ƒè¿è¡Œ <code>npm publish</code> ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">npm WARN prepublish-on-install As of npm@5, `prepublish` scripts are deprecated.</span><br><span class="line">npm WARN prepublish-on-install Use `prepare` <span class="keyword">for</span> build steps and `prepublishOnly` <span class="keyword">for</span> upload-only.</span><br><span class="line">npm WARN prepublish-on-install See the deprecation note <span class="keyword">in</span> `npm <span class="built_in">help</span> scripts` <span class="keyword">for</span> more information.</span><br><span class="line"></span><br><span class="line">&gt; npm-scripts-example@0.0.5 prepublish .</span><br><span class="line">&gt; <span class="comment"># Run BEFORE the package is packed and published, as well as on local npm install without any arguments.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; npm-scripts-example@0.0.5 prepare .</span><br><span class="line">&gt; <span class="comment"># Run both BEFORE the package is packed and published, and on local npm install without any arguments (See below). This is run AFTER prepublish, but BEFORE prepublishOnly.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; npm-scripts-example@0.0.5 prepublishOnly .</span><br><span class="line">&gt; <span class="comment"># Run BEFORE the package is prepared and packed, ONLY on npm publish.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; npm-scripts-example@0.0.5 prepack .</span><br><span class="line">&gt; <span class="comment"># Run BEFORE a tarball is packed (on npm pack, npm publish, and when installing git dependencies).</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; npm-scripts-example@0.0.5 postpack .</span><br><span class="line">&gt; <span class="comment"># Run AFTER the tarball has been generated and moved to its final destination.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸Šä¼ åˆ° npm çš„è¿›åº¦æ¡å‡ºç°åœ¨è¿™é‡Œ</span></span><br><span class="line"></span><br><span class="line">&gt; npm-scripts-example@0.0.5 publish .</span><br><span class="line">&gt; <span class="comment"># Run AFTER the package is published.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; npm-scripts-example@0.0.5 postpublish .</span><br><span class="line">&gt; <span class="comment"># Run AFTER the package is published.</span></span><br><span class="line"></span><br><span class="line">+ npm-scripts-example@0.0.5</span><br></pre></td></tr></table></figure><p>å³</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># npm@5</span><br><span class="line">prepublish -&gt; prepare -&gt; prepublishOnly -&gt; prepack -&gt; postpack -&gt; [ä¸Šä¼ è‡³ npm] -&gt; publish -&gt; postpublish</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æƒ³åœ¨ npm@3 ç¯å¢ƒä¸‹ publish ä¹‹å‰å¹²ç‚¹ä»€ä¹ˆï¼ˆä¾‹å¦‚åšä¸ªè‡ªåŠ¨å‹ç¼©ä¹‹ç±»çš„ï¼‰ï¼Œåªèƒ½ç”¨ <code>prepublish</code>ï¼Œç„¶è€Œåœ¨ npm@5 å°±è¦è¢«èˆå¼ƒäº†å–ã€‚å¦‚æœå¯ä»¥é™åˆ¶è¯¥ package çš„å¼€å‘è€…éƒ½æ˜¯ npm@5 ç¯å¢ƒï¼Œé‚£ä¹ˆï¼Œç›´æ¥æ”¹æˆ <code>prepare</code> æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œè€Œæ˜¯å¦èƒ½æ”¹æˆ <code>prepublishOnly</code>ï¼Œ<strong>è¿˜</strong> å–å†³äºè¿™ä¸ªè„šæœ¬ï¼Œæ˜¯ä¸æ˜¯è¦åœ¨ package å¼€å‘è€…æœ¬åœ°è¿è¡Œ <code>install</code> ä¹‹åæ‰§è¡Œã€‚</p><h2><span id="install">install</span></h2><p>å‰é¢æåˆ° <code>prepublish</code> å’Œ <code>prepare</code> ä¼š â€œåŒæ—¶åœ¨æœ¬åœ°è¿è¡Œä¸å«ä»»ä½•å‚æ•°çš„ <code>npm install</code> æ—¶æ‰§è¡Œâ€ã€‚äºæ˜¯æˆ‘ä»¬å†æ”¹åŠ¨ä¸€ä¸‹ä¸Šé¢çš„ä¾‹å­ï¼ŒåŠ ä¸Š install ç›¸å…³çš„ scriptsï¼š</p><figure class="highlight"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    "preinstall": "# Run BEFORE the package is installed.",</span><br><span class="line">    "install": "# Run AFTER the package is installed.",</span><br><span class="line">    "postinstall": "# Run AFTER the package is installed.",</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">  &#125;,</span><br><span class="line">  "dependencies": &#123;</span><br><span class="line">    "lodash": "^4.17.4"</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="local-npm-install-without-any-arguments">Local npm install without any arguments</span></h3><p>åœ¨å½“å‰ package ä¸­è¿è¡Œ <code>npm install</code>ï¼Œ npm@3 ç¯å¢ƒç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># fetch node modules çš„è¿›åº¦æ¡å‡ºç°åœ¨è¿™é‡Œ</span></span><br><span class="line"></span><br><span class="line">&gt; npm-scripts-example@0.0.5 preinstall /path/to/npm-scripts-example</span><br><span class="line">&gt; <span class="comment"># Run BEFORE the package is installed.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># extract node modules çš„è¿›åº¦æ¡å‡ºç°åœ¨è¿™é‡Œ</span></span><br><span class="line"></span><br><span class="line">&gt; npm-scripts-example@0.0.5 install /path/to/npm-scripts-example</span><br><span class="line">&gt; <span class="comment"># Run AFTER the package is installed.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; npm-scripts-example@0.0.5 postinstall /path/to/npm-scripts-example</span><br><span class="line">&gt; <span class="comment"># Run AFTER the package is installed.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; npm-scripts-example@0.0.5 prepublish /path/to/npm-scripts-example</span><br><span class="line">&gt; <span class="comment"># Run BEFORE the package is packed and published, as well as on local npm install without any arguments.</span></span><br><span class="line"></span><br><span class="line">npm-scripts-example@0.0.5 /path/to/npm-scripts-example</span><br><span class="line">â””â”€â”€ lodash@4.17.4</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°ï¼Œé™¤äº†é¢„æ–™ä¸­çš„ <code>preinstall</code>ï¼Œ<code>install</code> å’Œ <code>postinstall</code>ï¼Œåœ¨æœ€åè¿˜æ‰§è¡Œäº† <code>prepublish</code>ã€‚</p><p>å³</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># npm@3</span><br><span class="line">[fetch] -&gt; preinstall -&gt; [extract] -&gt; install -&gt; postinstall -&gt; prepublish</span><br></pre></td></tr></table></figure><p>æŒ‰æƒ¯ä¾‹æˆ‘ä»¬ç»§ç»­è¯•è¯• npm@5 çš„ç»“æœï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># fetch node modules çš„è¿›åº¦æ¡å‡ºç°åœ¨è¿™é‡Œ</span></span><br><span class="line"></span><br><span class="line">&gt; npm-scripts-example@0.0.5 preinstall /path/to/npm-scripts-example</span><br><span class="line">&gt; <span class="comment"># Run BEFORE the package is installed.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># extract node modules çš„è¿›åº¦æ¡å‡ºç°åœ¨è¿™é‡Œ</span></span><br><span class="line"></span><br><span class="line">&gt; npm-scripts-example@0.0.5 install /path/to/npm-scripts-example</span><br><span class="line">&gt; <span class="comment"># Run AFTER the package is installed.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; npm-scripts-example@0.0.5 postinstall /path/to/npm-scripts-example</span><br><span class="line">&gt; <span class="comment"># Run AFTER the package is installed.</span></span><br><span class="line"></span><br><span class="line">npm WARN prepublish-on-install As of npm@5, `prepublish` scripts are deprecated.</span><br><span class="line">npm WARN prepublish-on-install Use `prepare` <span class="keyword">for</span> build steps and `prepublishOnly` <span class="keyword">for</span> upload-only.</span><br><span class="line">npm WARN prepublish-on-install See the deprecation note <span class="keyword">in</span> `npm <span class="built_in">help</span> scripts` <span class="keyword">for</span> more information.</span><br><span class="line"></span><br><span class="line">&gt; npm-scripts-example@0.0.5 prepublish /path/to/npm-scripts-example</span><br><span class="line">&gt; <span class="comment"># Run BEFORE the package is packed and published, as well as on local npm install without any arguments.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; npm-scripts-example@0.0.5 prepare /path/to/npm-scripts-example</span><br><span class="line">&gt; <span class="comment"># Run both BEFORE the package is packed and published, and on local npm install without any arguments (See below). This is run AFTER prepublish, but BEFORE prepublishOnly.</span></span><br><span class="line"></span><br><span class="line">added 1 package <span class="keyword">in</span> 2.348s</span><br></pre></td></tr></table></figure><p>å³</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># npm@3</span><br><span class="line">[fetch] -&gt; preinstall -&gt; [extract] -&gt; install -&gt; postinstall -&gt; prepublish -&gt; prepare</span><br></pre></td></tr></table></figure><p>å‡ ä¹æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œåªæ˜¯å’Œ publish ä¸€æ ·è­¦å‘Šäº†ä¸€ä¸‹ä»¥åä¸è¦ç”¨ prepublish äº†ã€‚</p><h3><span id="local-npm-install-with-arguments">Local npm install with arguments</span></h3><p>é‚£ä¹ˆï¼Œå¦‚æœæ˜¯å¸¦æœ‰å‚æ•°çš„ <code>npm install</code> å‘¢ï¼Ÿæˆ‘ä»¬è¯•è¯• <code>npm install lodash</code> çœ‹çœ‹ï¼Ÿ</p><p>ç»“æœä¾¿æ˜¯ï¼Œæ— è®º npm@3 è¿˜æ˜¯ npm@5 éƒ½åªæ˜¯é»˜é»˜å§ lodash å®‰è£…ä¸‹æ¥ï¼Œå¹¶ä¸ä¼šæ‰§è¡Œä»»ä½• scriptã€‚</p><h3><span id="install-package">Install package</span></h3><p>æœ€åï¼Œæˆ‘ä»¬è¯•è¯•åœ¨å…¶ä»–åœ°æ–¹å®‰è£…è¿™ä¸ª package çš„æƒ…å†µï¼š</p><p>åœ¨ npm@3 å’Œ npm@5 ç¯å¢ƒä¸‹ï¼Œè‹¥ npm-scripts-example è¢«é¦–æ¬¡å®‰è£…ï¼Œåˆ™æ— è®ºæ˜¯å¦ <code>npm install</code> æ˜¯å¦å¸¦å‚æ•°ï¼ˆå³ä½¿ç”¨ <code>npm install</code> æˆ– <code>npm install npm-scripts-example</code>ï¼‰ï¼Œç»“æœå‡æ˜¯ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; npm-scripts-example@0.0.5 preinstall /path/to/project/node_modules/.staging/npm-scripts-example-62ae822f</span><br><span class="line">&gt; <span class="comment"># Run BEFORE the package is installed.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; npm-scripts-example@0.0.5 install /path/to/project/node_modules/npm-scripts-example</span><br><span class="line">&gt; <span class="comment"># Run AFTER the package is installed.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; npm-scripts-example@0.0.5 postinstall /path/to/project/node_modules/npm-scripts-example</span><br><span class="line">&gt; <span class="comment"># Run AFTER the package is installed.</span></span><br><span class="line"></span><br><span class="line">npm-scripts-example-main@0.0.1 /path/to/project</span><br><span class="line">â””â”€â”€ npm-scripts-example@0.0.5</span><br></pre></td></tr></table></figure><p>å³</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[fetch] -&gt; preinstall -&gt; [extract] -&gt; install -&gt; postinstall</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;npm &lt;a href=&quot;https://docs.npmjs.com/misc/scripts&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;è‡ªèº«æä¾›&lt;/a&gt;äº†ä¸€äº› scriptï¼Œå¹¶ä¸”æœ‰ä¸€äº›ç‰¹å®šçš„è§„åˆ™ï¼Œæœ€è¿‘ç”¨åˆ°äº†å‡ ä¸ªï¼Œåœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹ï¼Œä¸‹æ–‡æåˆ°çš„ä»£ç ä»“åº“åœ¨ &lt;a href=&quot;https://github.com/csbun/npm-scripts-example&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;è¿™é‡Œ&lt;/a&gt; å¯ä»¥çœ‹åˆ°ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="npm" scheme="http://csbun.github.io/blog/tags/npm/"/>
    
      <category term="publish" scheme="http://csbun.github.io/blog/tags/publish/"/>
    
      <category term="install" scheme="http://csbun.github.io/blog/tags/install/"/>
    
  </entry>
  
  <entry>
    <title>æˆ‘è¯•äº†ä¸€ä¸‹ weex</title>
    <link href="http://csbun.github.io/blog/2017/06/weex-challenger/"/>
    <id>http://csbun.github.io/blog/2017/06/weex-challenger/</id>
    <published>2017-06-15T12:03:59.000Z</published>
    <updated>2020-11-03T11:52:46.472Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="è‡´è¯»è€…">è‡´è¯»è€…</span></h2><p>weex æœ‰é£é™©ï¼Œå…¥é—¨éœ€è°¨æ…ã€‚</p><a id="more"></a><h2><span id="å…¥é—¨">å…¥é—¨</span></h2><h3><span id="hello-world">Hello World</span></h3><p>ä»€ä¹ˆéƒ½ä¸è£…ï¼Œå…ˆåˆ° <a href="http://dotwe.org/vue" target="_blank" rel="noopener">dotWe</a> ä¸­çœ‹çœ‹æ•ˆæœï¼š</p><img src="/2017/06/weex-challenger/dotWe.png" title="dotWe"><p>è¿™æ˜¯ä¸€æ®µ vue çš„ä»£ç ï¼Œä¸€ä¸ªå›¾æ ‡å’Œä¸€è¡Œæ–‡å­—ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;wrapper&quot;&gt;</span><br><span class="line">    &lt;image :src=&quot;logoUrl&quot; class=&quot;logo&quot;&gt;&lt;/image&gt;</span><br><span class="line">    &lt;text class=&quot;title&quot;&gt;Hello &#123;&#123;target&#125;&#125;&lt;/text&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">  .wrapper &#123; align-items: center; margin-top: 120px; &#125;</span><br><span class="line">  .title &#123; font-size: 48px; &#125;</span><br><span class="line">  .logo &#123; width: 360px; height: 82px; &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">      logoUrl: &apos;https://alibaba.github.io/weex/img/weex_logo_blue@3x.png&apos;,</span><br><span class="line">      target: &apos;World&apos;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>å°†å…¶è´´åœ¨å·¦ä¾§ä»£ç åŒºï¼Œç‚¹å‡» <code>RUN</code> å³å¯åœ¨ preview åŒºçœ‹åˆ° Web å®ç°çš„æ•ˆæœã€‚å¦‚æœè¦çœ‹ Native ç‰ˆï¼Œåˆ™å¯ä»¥ä¸‹è½½ <a href="https://weex.incubator.apache.org/cn/playground.html" target="_blank" rel="noopener">Weex Playground</a>ï¼Œå®‰è£…åˆ°æ‰‹æœºä¸­åæ‰«æå³ä¾§çš„ QRCode å³å¯ã€‚</p><p>dotWe åªèƒ½è¿è¡Œä¸€ä¸ª vue æ–‡ä»¶ï¼Œåšå•ä¸ªç»„ä»¶çš„æµ‹è¯•è¿˜æ˜¯å¯ä»¥çš„ï¼Œåœ¨å®é™…ä¸šåŠ¡åº”ç”¨çš„æ—¶å€™æ˜æ˜¾æ˜¯ä¸å¤Ÿï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå®Œæ•´çš„å·¥ç¨‹é¡¹ç›®ã€‚</p><h3><span id="åˆå§‹åŒ–">åˆå§‹åŒ–</span></h3><p>åœ¨å·²ç»æœ‰ Node çš„å‰æä¸‹ï¼Œå®‰è£…é…å¥—å·¥å…·å¹¶åˆå§‹åŒ–é¡¹ç›®ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install -g weex-toolkit</span><br><span class="line">weex init weex-challenger</span><br><span class="line"><span class="built_in">cd</span> weex-challenger</span><br><span class="line">npm i</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šæˆ‘è¿™é‡Œä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ weex-toolkit(1.0.5)</p><h3><span id="è¿è¡Œ">è¿è¡Œ</span></h3><h4><span id="web">Web</span></h4><p>å¼€ä¸¤ä¸ªå‘½ä»¤è¡Œåˆ†åˆ«è¿è¡Œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run serve</span><br></pre></td></tr></table></figure><p>çœ‹åˆ° <code>serving /Users/hans/workspace/weex-challenger on port 8080</code> å³å¯æ‰“å¼€ <a href="http://127.0.0.1:8080/" target="_blank" rel="noopener">http://127.0.0.1:8080/</a>ã€‚ç„¶è€Œå¾ˆä¸å¹¸é¡µé¢æ˜¯ç©ºç™½çš„ï¼Œå› ä¸ºè¿˜æœ‰ä¸€ä¸ª <a href="https://github.com/weexteam/weex-toolkit/commit/5793aa32d120ff2b8b629f7b860862d7a31dfc6a" target="_blank" rel="noopener">commit</a> æ²¡æœ‰å‘å¸ƒã€‚æ‰€ä»¥æˆ‘ä»¬åªè¦åŒæ ·æ”¹ä¸€ä¸‹ <em>weex.html</em> çš„ 15 è¡Œ <code>weex-vue-render</code> çš„è·¯å¾„å³å¯ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./node_modules/weex-vue-render/dist/index.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ğŸ‘ˆ å·¦è¾¹çš„é¢„è§ˆçª—å£å°±ä¼šå‡ºç° weex çš„ LOGOã€‚å®Œæ•´ä»£ç è¯·çœ‹ <a href="https://github.com/csbun/weex-challenger/tree/v0.1.0" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚</p><img src="/2017/06/weex-challenger/preview.png" title="Web é¢„è§ˆæ•ˆæœ"><h4><span id="native">Native</span></h4><p>åŒæ ·ä½¿ç”¨ <a href="https://weex.incubator.apache.org/cn/playground.html" target="_blank" rel="noopener">Weex Playground</a> æ‰«æä¸Šé¢ <a href="http://127.0.0.1:8080/" target="_blank" rel="noopener">http://127.0.0.1:8080/</a> ä¸­çš„çš„äºŒç»´ç ï¼Œå³ä¼šåœ¨ Native App ä¸­æ‰“å¼€ä¸€ä¸ªæ–°çš„ Page æ˜¾ç¤ºä¸Šé¢ç›¸åŒçš„ç•Œé¢ã€‚</p><h3><span id="å•é¡µé¢åº”ç”¨">å•é¡µé¢åº”ç”¨</span></h3><p>SPA çš„åº”è¯¥æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„éœ€æ±‚ï¼Œæˆ‘ä»¬ç°åœ¨å°±åœ¨é»˜è®¤çš„åˆå§‹åŒ–é¡¹ç›®ä¸Šä½¿ç”¨ Vue å…¨å®¶æ¡¶å®ç°ä¸€ä¸ªç®€å•çš„å•é¡µé¢åº”ç”¨ã€‚</p><h4><span id="vue-router">vue-router</span></h4><p>å‡è®¾æˆ‘ä»¬çš„åœºæ™¯æ˜¯æœ‰ Fooï¼ŒBar ä¸¤ä¸ª Tabï¼Œç‚¹å‡»åˆ†åˆ«è¿›å…¥ä¸¤ä¸ªä¸åŒçš„é¡µé¢ã€‚é¦–å…ˆæˆ‘ä»¬è¦æœ‰ä¸€ä¸ªå…¥å£ç»„ä»¶æ‰¿è½½ <em>app.vue</em>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div @androidback=&quot;back&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;nav&quot;&gt;</span><br><span class="line">      &lt;text class=&quot;nav-i&quot; @click=&quot;jumpFoo&quot;&gt;Foo&lt;/text&gt;</span><br><span class="line">      &lt;text class=&quot;nav-i&quot; @click=&quot;jumpBar&quot;&gt;Bar&lt;/text&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;router-view style=&quot;flex:1&quot;&gt;&lt;/router-view&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    methods: &#123;</span><br><span class="line">      back: function() &#123;</span><br><span class="line">        this.$router.back();</span><br><span class="line">      &#125;,</span><br><span class="line">      jumpFoo: function() &#123;</span><br><span class="line">        this.$router.push(&apos;/foo&apos;);</span><br><span class="line">      &#125;,</span><br><span class="line">      jumpBar: function() &#123;</span><br><span class="line">        this.$router.push(&apos;/bar/0&apos;);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>jumpFoo</code> å’Œ <code>jumpBar</code> æ˜¯ä½¿ç”¨ <a href="https://weex.incubator.apache.org/cn/references/vue/difference-of-vuex.html#ç¼–ç¨‹å¼å¯¼èˆª" target="_blank" rel="noopener">Weex å®˜æ–¹é™åˆ¶</a> çš„ <a href="https://router.vuejs.org/zh-cn/essentials/navigation.html" target="_blank" rel="noopener">ç¼–ç¨‹å¼å¯¼èˆª</a> çš„æ–¹å¼æ¥å®ç°é¡µé¢è·³è½¬ã€‚</p><p>åœ¨ <em>router.js</em> æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬ç»™ <code>FooView</code> å’Œ <code>BarView</code> ç»‘å®šå¯¹åº”çš„è·¯å¾„ <code>/foo</code> å’Œ <code>/bar</code>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">'vue-router'</span>;</span><br><span class="line"><span class="keyword">import</span> FooView <span class="keyword">from</span> <span class="string">'./foo.vue'</span>;</span><br><span class="line"><span class="keyword">import</span> BarView <span class="keyword">from</span> <span class="string">'./bar.vue'</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(Router);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">'/foo'</span>, <span class="attr">component</span>: FooView &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">'/bar/:id'</span>, <span class="attr">component</span>: BarView &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æœ€ååœ¨å…¥å£æ–‡ä»¶ <em>app.js</em> ä¸­ç»‘å®š <code>App</code> å’Œ <code>router</code>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./src/app.vue'</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">'./src/router'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vue(Vue.util.extend(&#123; <span class="attr">el</span>: <span class="string">'#root'</span>, router &#125;, App));</span><br><span class="line"></span><br><span class="line">router.push(<span class="string">'/foo'</span>);</span><br></pre></td></tr></table></figure><p>å®Œæ•´çš„ä»£ç ç¤ºä¾‹è¯·çœ‹ <a href="https://github.com/csbun/weex-challenger/tree/v0.2.0" target="_blank" rel="noopener">è¿™é‡Œ</a>ï¼Œæ›´æ–°çš„å†…å®¹çœ‹è¿™ä¸ª <a href="https://github.com/csbun/weex-challenger/commit/8e7f0443a0336f30cdc33ee9fc3bc4ae1b079a1b" target="_blank" rel="noopener">commit</a>ã€‚</p><h2><span id="å‘å¸ƒ">å‘å¸ƒ</span></h2><p>å› ä¸ºç©è¿‡ <a href="https://facebook.github.io/react-native/" target="_blank" rel="noopener">React Native</a>ï¼Œæ‰“åŒ…æˆä¸€ä¸ªåº”ç”¨æœ¬æ˜¯ä¸€ä»¶ä¸å¤æ‚çš„äº‹æƒ…ï¼Œç„¶è€Œåœ¨ weex ä¸­å°±æ²¡é‚£ä¹ˆè§„èŒƒäº†ã€‚</p><p><a href="https://www.npmjs.com/package/weex-toolkit" target="_blank" rel="noopener">weex-toolkit</a> è™½ç„¶å·²ç»é›†æˆäº† <a href="https://www.npmjs.com/package/weexpack" target="_blank" rel="noopener">weexpack</a> çš„åŠŸèƒ½ï¼Œä½†äºŒè€…åˆå§‹åŒ–å‡ºæ¥çš„é¡¹ç›®å®Œå…¨ä¸åŒã€‚ä¹Ÿå°±æ˜¯ <code>weex-toolkit init</code> != <code>weexpack create</code>ï¼Œä»¥è‡´äºåé¢çš„ <code>weexpack platform</code> ä¹Ÿæ— æ³•ç»§ç»­ã€‚æš‚æ—¶æ²¡ç©ºæŠ˜è…¾äº†ã€‚ã€‚ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;è‡´è¯»è€…&quot;&gt;&lt;a href=&quot;#è‡´è¯»è€…&quot; class=&quot;headerlink&quot; title=&quot;è‡´è¯»è€…&quot;&gt;&lt;/a&gt;è‡´è¯»è€…&lt;/h2&gt;&lt;p&gt;weex æœ‰é£é™©ï¼Œå…¥é—¨éœ€è°¨æ…ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="weex" scheme="http://csbun.github.io/blog/tags/weex/"/>
    
      <category term="vue" scheme="http://csbun.github.io/blog/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>Using Storybook with Preact</title>
    <link href="http://csbun.github.io/blog/2017/03/preact-storybook/"/>
    <id>http://csbun.github.io/blog/2017/03/preact-storybook/</id>
    <published>2017-03-16T10:07:04.000Z</published>
    <updated>2020-11-03T11:52:46.472Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="tldr">TL;DR;</span></h2><p>Clone this <a href="https://github.com/csbun/preact-storybook-example" target="_blank" rel="noopener">repo</a> and startï¼</p><p>å…‹éš†è¿™ä¸ª <a href="https://github.com/csbun/preact-storybook-example" target="_blank" rel="noopener">é¡¹ç›®</a> ç„¶åå¯åŠ¨å³å¯ï¼</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone git@github<span class="selector-class">.com</span>:csbun/preact-storybook-example.git</span><br><span class="line">cd preact-storybook-example</span><br><span class="line"></span><br><span class="line">npm i</span><br><span class="line">npm run storybook</span><br></pre></td></tr></table></figure><a id="more"></a><h2><span id="install-dependences-å®‰è£…ä¾èµ–">Install Dependences å®‰è£…ä¾èµ–</span></h2><p><a href="https://getstorybook.io/" target="_blank" rel="noopener">Storybook</a> is aim for <a href="https://github.com/storybooks/react-storybook" target="_blank" rel="noopener">React</a> and <a href="https://github.com/storybooks/react-native-storybook" target="_blank" rel="noopener">React Native</a>. <a href="https://github.com/storybooks/getstorybook" target="_blank" rel="noopener">getstorybook</a> is unable to use in a Preact project. With <a href="https://github.com/developit/preact-compat" target="_blank" rel="noopener">preact-compat</a>, we can do this manually.</p><p><a href="https://getstorybook.io/" target="_blank" rel="noopener">Storybook</a> ç›®å‰æ˜¯ä¸º <a href="https://github.com/storybooks/react-storybook" target="_blank" rel="noopener">React</a> å’Œ <a href="https://github.com/storybooks/react-native-storybook" target="_blank" rel="noopener">React Native</a> è€Œè®¾è®¡çš„ã€‚<a href="https://github.com/storybooks/getstorybook" target="_blank" rel="noopener">getstorybook</a> ç›®å‰æ— æ³•åœ¨ Preact é¡¹ç›®ä¸­ä½¿ç”¨ã€‚ä½†æœ‰äº† <a href="https://github.com/developit/preact-compat" target="_blank" rel="noopener">preact-compat</a>ï¼Œç†è®ºä¸Šæˆ‘ä»¬åº”è¯¥æ˜¯å¯ä»¥æ‰‹åŠ¨å®Œæˆè¿™ä¸ªä»»åŠ¡çš„ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -D @kadira/storybook preact-compat</span><br></pre></td></tr></table></figure><p>Some peerDependences warning about react may blow up here, ignore it.</p><blockquote><p>You may have preact installed before.</p></blockquote><p>è¿™é‡Œå¯èƒ½ä¼šå‡ºç°ä¸€äº›å…³äº react çš„ peerDependences è­¦å‘Šï¼Œå¿½ç•¥ä¹‹ã€‚</p><h2><span id="config-é…ç½®">Config é…ç½®</span></h2><h3><span id="storybook-configuration">Storybook Configuration</span></h3><p>Using CLI <code>getstorybook</code> will create config file <em>.storybook/config.js</em>, so we have to do it by ourself.</p><p>æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨åˆ›å»ºæœ¬åº”è¯¥æ˜¯ä½¿ç”¨å‘½ä»¤è¡Œ <code>getstorybook</code> åˆ›å»ºçš„é…ç½®æ–‡ä»¶ <em>.storybook/config.js</em>ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir .storybook</span><br><span class="line">touch .storybook/config.js</span><br></pre></td></tr></table></figure><p>Fill it with the following code:</p><p>å¹¶å¡«å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; configure &#125; <span class="keyword">from</span> <span class="string">'@kadira/storybook'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadStories</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">'../stories'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">configure(loadStories, <span class="built_in">module</span>);</span><br></pre></td></tr></table></figure><h3><span id="webpack-configuration-for-preact">Webpack Configuration (for Preact)</span></h3><p>Storybook use webpack for bundling, what make us easy to use preact-compat. Create another file <em>.storybook/webpack.config.js</em>:</p><p>Storybook ä½¿ç”¨ webpack æ‰“åŒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“æ·»åŠ  preact-compat çš„é…ç½®è¿›å»ã€‚ åˆ›å»ºä¸€ä¸ª <em>.storybook/webpack.config.js</em> æ–‡ä»¶ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  name: <span class="string">'client'</span>,</span><br><span class="line">  target: <span class="string">'web'</span>,</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    extensions: [<span class="string">''</span>, <span class="string">'.js'</span>, <span class="string">'jsx'</span>],</span><br><span class="line">    alias: &#123;</span><br><span class="line">      <span class="string">'react'</span>: <span class="string">'preact-compat'</span>,</span><br><span class="line">      <span class="string">'react-dom'</span>: <span class="string">'preact-compat'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  devtool: <span class="string">'source-map'</span>,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    loaders: [&#123;</span><br><span class="line">      test: <span class="regexp">/\.jsx?$/</span>,</span><br><span class="line">      loader: <span class="string">'babel'</span>,</span><br><span class="line">      exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">    &#125;],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>And we need <em>.babelrc</em> for preact jsx file.</p><blockquote><p>You may have babel and plugins installed.<br><code>npm i -D babel babel-preset-es2015 babel-plugin-transform-react-jsx</code></p></blockquote><p>åŒæ—¶æˆ‘ä»¬éœ€è¦ä¸ºæˆ‘ä»¬çš„ preact jsx æ–‡ä»¶å‡†å¤‡ä¸€ä¸ª <em>.babelrc</em> é…ç½®æ–‡ä»¶ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [ <span class="string">"es2015"</span> ],</span><br><span class="line">  <span class="attr">"plugins"</span>: [</span><br><span class="line">    [ <span class="string">"transform-react-jsx"</span>, &#123; <span class="attr">"pragma"</span>: <span class="string">"h"</span> &#125;]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="writing-stories-ç¼–å†™-stories">Writing Stories ç¼–å†™ Stories</span></h2><p>Letâ€™s see <code>require(&#39;../stories&#39;)</code> in <em>.storybook/config.js</em>, line 4. Thatâ€™s where we write our â€œstoriesâ€. Create a <em>stories/index.js</em> file as an entry, just like CLI <code>getstorybook</code> do:</p><p>æˆ‘ä»¬å¯ä»¥åœ¨ <em>.storybook/config.js</em> ç¬¬4è¡Œçœ‹åˆ° <code>require(&#39;../stories&#39;)</code> å¼•å…¥äº† storiesã€‚å› æ­¤æˆ‘ä»¬éœ€è¦åˆ›å»ºå…¥å£æ–‡ä»¶ <em>stories/index.js</em> ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">'preact'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; storiesOf, action &#125; <span class="keyword">from</span> <span class="string">'@kadira/storybook'</span>;</span><br><span class="line"><span class="keyword">import</span> Button <span class="keyword">from</span> <span class="string">'./Button'</span>; <span class="comment">// preact component</span></span><br><span class="line"></span><br><span class="line">storiesOf(<span class="string">'Button'</span>, <span class="built_in">module</span>)</span><br><span class="line">  .add(<span class="string">'case 1'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">text</span>=<span class="string">"CASE-1"</span> <span class="attr">onPress</span>=<span class="string">&#123;action(</span>'<span class="attr">case-1</span>')&#125; /&gt;</span>);</span></span><br><span class="line"><span class="xml">  &#125;)</span></span><br><span class="line"><span class="xml">  .add('case 2', () =&gt; &#123;</span></span><br><span class="line">    return (&lt;Button text="CASE-2" onPress=&#123;action('case-2')&#125; /&gt;);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><h2><span id="launch-å¯åŠ¨">Launch å¯åŠ¨</span></h2><p>Add storybook script into <em>package.json</em>:<br>åœ¨ <em>package.json</em> ä¸­æ·»åŠ  storybook çš„å¯åŠ¨è„šæœ¬ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"preact-storybook-example"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"storybook"</span>: <span class="string">"start-storybook -p 6006"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Then we can run <code>npm run storybook</code> to start using storybook by visiting <a href="http://localhost:6006/" target="_blank" rel="noopener">http://localhost:6006/</a>.</p><p>ç„¶åè¿è¡Œ <code>npm run storybook</code> å°±å¯ä»¥å¯åŠ¨ storybookï¼Œç„¶åè®¿é—® <a href="http://localhost:6006/" target="_blank" rel="noopener">http://localhost:6006/</a> å¼€å‘ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;TL-DR&quot;&gt;&lt;a href=&quot;#TL-DR&quot; class=&quot;headerlink&quot; title=&quot;TL;DR;&quot;&gt;&lt;/a&gt;TL;DR;&lt;/h2&gt;&lt;p&gt;Clone this &lt;a href=&quot;https://github.com/csbun/preact-storybook-example&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;repo&lt;/a&gt; and startï¼&lt;/p&gt;
&lt;p&gt;å…‹éš†è¿™ä¸ª &lt;a href=&quot;https://github.com/csbun/preact-storybook-example&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;é¡¹ç›®&lt;/a&gt; ç„¶åå¯åŠ¨å³å¯ï¼&lt;/p&gt;
&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;git clone git@github&lt;span class=&quot;selector-class&quot;&gt;.com&lt;/span&gt;:csbun/preact-storybook-example.git&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd preact-storybook-example&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;npm i&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;npm run storybook&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Storybook" scheme="http://csbun.github.io/blog/tags/Storybook/"/>
    
      <category term="Preact" scheme="http://csbun.github.io/blog/tags/Preact/"/>
    
  </entry>
  
  <entry>
    <title>Java ä¸­ä½¿ç”¨ Gson ååºåˆ—åŒ– JSON æ•°æ®</title>
    <link href="http://csbun.github.io/blog/2016/11/gson-deserialization/"/>
    <id>http://csbun.github.io/blog/2016/11/gson-deserialization/</id>
    <published>2016-11-27T10:52:14.000Z</published>
    <updated>2020-11-03T11:52:46.472Z</updated>
    
    <content type="html"><![CDATA[<p>å¥½é•¿æ—¶é—´æ²¡å†™ Javaï¼Œå‘ç°åºåˆ—åŒ–ã€ååºåˆ—åŒ–ä¸€ä¸ª JSON æ•°æ®çœŸä¸æ˜¯ä¸ªå®¹æ˜“çš„äº‹æƒ…ï¼ˆä¸»è¦è¿˜æ˜¯å¹´çºªå¤§äº†ï¼Œè®°ä¸ä½ï¼‰ã€‚äºæ˜¯è®°å½•ä¸€ä¸‹ä½¿ç”¨ <a href="https://github.com/google/gson" target="_blank" rel="noopener">Gson</a> ååºåˆ—åŒ–çš„æ–¹æ³•ã€‚æ–‡ä¸­æ¶‰åŠçš„ä»£ç éƒ½å¯ä»¥åœ¨è¿™ä¸ª <a href="https://github.com/csbun/gson-deserialization-example" target="_blank" rel="noopener">gson-deserialization-example</a> ä¸­æ‰¾åˆ°ã€‚</p><blockquote><p>ä½œè€…æœ¬èº«ä¸æ‡‚ Javaï¼Œæœ¬ç€ä¸è´Ÿè´£çš„æ€åº¦å†™ä¸‹è¿™äº›å†…å®¹ï¼Œå¤§ç‰›å‹¿å–·ï¼Œæƒ³æŠ„ä»£ç çš„èœé¸Ÿè¯·çé‡ã€‚<br>æœ¬æ–‡åŸºäºè½¬æ¢æœŸé—´æ²¡æœ‰å¼‚å¸¸æƒ…å†µè®¨è®ºï¼Œå®é™…æƒ…å†µè¯·çé‡ã€‚</p></blockquote><h2><span id="åˆå§‹åŒ–">åˆå§‹åŒ–</span></h2><p>æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªç®€å•çš„ <em>TestMain.java</em> æ–‡ä»¶ï¼Œç”¨æ¥è¿è¡Œæˆ‘ä»¬åç»­çš„æµ‹è¯•æ–¹æ³•ã€‚</p><figure class="highlight java"><figcaption><span>TestMain.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestMain</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123;</span><br><span class="line">    <span class="comment">// è¿è¡Œæµ‹è¯•æ–¹æ³•</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p>é€šè¿‡ <code>javac TestMain.java</code> ä¼šç”Ÿæˆ <em>TestMain.class</em> æ–‡ä»¶ï¼Œä¹‹åå°±èƒ½é€šè¿‡ <code>java TestMain</code> è¿è¡Œ <em>class</em> æ–‡ä»¶ã€‚</p><p>åœ¨å½“å‰çš„ä¾‹å­ä¸­æˆ‘ä»¬ google çš„ <a href="https://github.com/google/gson" target="_blank" rel="noopener">Gson</a>( <a href="http://search.maven.org/#artifactdetails%7Ccom.google.code.gson%7Cgson%7C2.8.0%7C" target="_blank" rel="noopener">maven åœ°å€</a>) åº“æ¥åšåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ç›´æ¥ä¸‹è½½ jar åŒ…ï¼Œæ”¾åˆ° <em>lib</em> ç›®å½•ä¸‹ã€‚</p><blockquote><p>å› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº† gson.jar æ‰€ä»¥å‘½ä»¤ä¼šå˜æˆè¿™æ ·ï¼š<br><code>javac -classpath lib/gson-2.8.0.jar TestMain.java</code><br><code>java -classpath .:lib/gson-2.8.0.jar TestMain</code></p></blockquote><h2><span id="jsonparser">JsonParser</span></h2><h3><span id="object">Object</span></h3><p>å‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªç®€å•çš„ JSON æ•°æ®ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/* Sample JSON */</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"Hans Chan"</span>,</span><br><span class="line">  <span class="attr">"age"</span>: <span class="number">18</span>,</span><br><span class="line">  <span class="attr">"tags"</span>: [&#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"text"</span>: <span class="string">"JavaScript"</span></span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">"text"</span>: <span class="string">"Java"</span></span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>JsonParser</code> è¶³å¤Ÿçš„ç®€å•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">JsonParser jsonParser = <span class="keyword">new</span> JsonParser();</span><br><span class="line">JsonElement userJsonElement = jsonParser.parse(json);</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯ <strong>æŠ½è±¡</strong> çš„ <code>JsonElement</code>(<a href="https://static.javadoc.io/com.google.code.gson/gson/2.6.2/com/google/gson/JsonElement.html" target="_blank" rel="noopener">api</a>)ï¼Œå¦‚æœè¦è·å–å…·ä½“çš„å†…å®¹ï¼Œå°±å¾—è½¬æ¢æˆ <code>JsonObject</code> æˆ– <code>JsonArray</code> ç­‰ç±»å‹ï¼Œè·å–æ–¹å¼ä¹Ÿéå¸¸ç›´è§‚ <code>.get(&quot;key&quot;)</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">JsonObject userJsonObject = userJsonElement.getAsJsonObject();</span><br><span class="line">String name = userJsonObject.get(<span class="string">"name"</span>).getAsString();</span><br><span class="line"><span class="keyword">int</span> age = userJsonObject.get(<span class="string">"age"</span>).getAsInt();</span><br><span class="line">JsonArray userTagsJsonArray = userJsonObject.get(<span class="string">"tags"</span>).getAsJsonArray();</span><br></pre></td></tr></table></figure><h3><span id="array">Array</span></h3><p>åŒæ ·çš„åœºæ™¯ï¼Œå¦‚æœè¾“å…¥çš„ <code>json</code> å­—ç¬¦ä¸²ä¸æ˜¯ <code>{}</code> è€Œæ˜¯ <code>[]</code>ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸Šè¿°æ–¹æ³•è·å–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String json = <span class="string">"[&#123;&#125;,&#123;&#125;]"</span>; <span class="comment">// æ¯ä¸ª &#123;&#125; éƒ½æ˜¯ä¸€ä¸ª Sample JSON</span></span><br><span class="line">JsonArray userJsonArray = jsonParser.parse(json).getAsJsonArray(); <span class="comment">// ä¸æ˜¯ getAsJsonObject</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; userJsonArray.size(); i++) &#123;</span><br><span class="line">    JsonObject userJsonObject = userJsonArray.get(i).getAsJsonObject();</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="serialization">Serialization</span></h3><p><code>JsonElement</code> çš„åºåˆ—åŒ–å¾ˆç®€å•ï¼Œç›´æ¥ <code>.toString()</code> å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String json = userJsonObject.toString(); <span class="comment">// JsonObject</span></span><br></pre></td></tr></table></figure><h2><span id="oo">OO</span></h2><p>è¿™ä¸‹å­ï¼Œå†™ Java çš„å“¥ä»¬å°±è‚¯å®šä¼šè·³å‡ºæ¥è¯´ â€œè¿™æ˜¯ä»€ä¹ˆé¬¼ï¼Œä¸€ç‚¹éƒ½ä¸ OOâ€ã€‚çš„ç¡®ä¸Šé¢çš„æ–¹å¼å¾ˆ jsï¼Œäºæ˜¯æˆ‘ä»¬å°±è¦å†™å¾—åƒ Java ä¸€ç‚¹ï¼Œå…ˆæ¥ä¸¤ä¸ª class ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Tag</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String text;</span><br><span class="line">    <span class="comment">// æ­¤å¤„çœç•¥ Getter and Setter</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Tag&gt; tags;</span><br><span class="line">    <span class="comment">// æ­¤å¤„çœç•¥ Getter and Setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="object">Object</span></h3><p>å¤§å®¶æ³¨æ„äº†ï¼Œæˆ‘è¦å˜å½¢äº†ï¼ï¼ˆæ•²é»‘æ¿ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">User user = gson.fromJson(json, User.class);</span><br></pre></td></tr></table></figure><p>é€šè¿‡ Gsonï¼Œ<code>String</code> è¢«è½¬æ¢æˆæŒ‡å®šçš„ <code>User.class</code>ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«åœ°æ“ä½œè¿™ä¸ªå®ä¾‹äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Tag&gt; tags = user.getTags();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tags.size(); i++) &#123;</span><br><span class="line">    Tag tag = tags.get(i);</span><br><span class="line">    System.out.println(<span class="string">"tag "</span> + tag.getId() + <span class="string">": "</span> + tag.getText());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="array">Array</span></h3><p>è¿˜æ˜¯åŒæ ·çš„ä¾‹å­ï¼Œå¦‚æœæ˜¯ <code>[]</code> æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬å½“ç„¶æœŸæœ›æ˜¯è·å¾—ä¸€ä¸ª <code>List&lt;User&gt;</code> å•¦ï¼Œä½†æ²¡æœ‰ <code>List&lt;User&gt;.class</code> è¿™ä¸ªä¸œè¥¿ï¼Œæ€ä¹ˆç ´ï¼Ÿæ²¡å…³ç³»ï¼ŒGson é‡Œé¢è¿˜æœ‰ä¸ª <code>TypeToken</code> æ˜¯å¯ä»¥è·Ÿä½ å¹²è¿™äº‹çš„ï¼Œæˆ‘ä»¬åªéœ€è¦è¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// import com.google.common.reflect.TypeToken;</span></span><br><span class="line">TypeToken typeToken = <span class="keyword">new</span> TypeToken&lt;List&lt;User&gt;&gt;() &#123;&#125;;</span><br><span class="line"><span class="comment">// import java.lang.reflect.Type;</span></span><br><span class="line">Type type = typeToken.getType();</span><br><span class="line"></span><br><span class="line">List&lt;User&gt; users = gson.fromJson(json, type);</span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯å¯ä»¥æ„‰å¿«åœ°ç©è€çš„ï¼Œä¸æ˜¯éº½ ğŸ˜‚</p><h3><span id="serialization">Serialization</span></h3><p>Class è¦ååºåˆ—åŒ–å°±è¿˜æ˜¯è¦ä¾èµ–å› Gson æä¾›çš„ <code>toJson</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String json = gson.toJson(user); <span class="comment">// User</span></span><br></pre></td></tr></table></figure><h2><span id="gsonbuilder">GsonBuilder</span></h2><p>å¾ˆå¤šæ—¶å€™ï¼Œè¾“å…¥çš„ json æ€»æœ‰é‚£ä¹ˆä¸€ç‚¹ä¸å°½äººæ„ï¼Œä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"id"</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"Hans Chan"</span>,</span><br><span class="line">  <span class="attr">"registrationTime"</span>: <span class="string">"1999-09-19 18:10:22"</span>,</span><br><span class="line">  <span class="attr">"data"</span>: &#123;</span><br><span class="line">    <span class="attr">"some"</span>: <span class="string">"complex data"</span>,</span><br><span class="line">    <span class="attr">"we"</span>: &#123;</span><br><span class="line">      <span class="attr">"do-NOT"</span>: [<span class="string">"care"</span>, <span class="string">"about"</span>, <span class="string">"what"</span>, <span class="string">"inside"</span>],</span><br><span class="line">      <span class="attr">"BUT"</span>: <span class="string">"needed!"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>id</code> æ˜¯æˆ‘ä»¬éœ€è¦çš„æ•°æ®ï¼Œä½†åºåˆ—åŒ–å‡ºå»çš„æ—¶å€™ä¸æƒ³æ˜¾ç¤º</li><li><code>registrationTime</code> å¯èƒ½ä¸æ˜¯ä¸€ä¸ªæˆ‘ä»¬æƒ³è¦çš„æ ¼å¼</li><li><code>data</code> å¯èƒ½æ˜¯æˆ‘ä»¬ä¸æ˜¯å¾ˆå…³å¿ƒç»“æ„ï¼Œä½†åˆéœ€è¦ä¿å­˜é‡Œé¢çš„å†…å®¹</li></ul><p>åˆ©ç”¨ GsonBuilder å’Œ Annotation æˆ‘ä»¬å°±å¯ä»¥å®ç°ä¸Šé¢ä¸¤ä¸ªåŠŸèƒ½ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseUser</span> </span>&#123;</span><br><span class="line">    <span class="comment">// import com.google.gson.annotations.Expose;</span></span><br><span class="line">    <span class="meta">@Expose</span>(serialize = <span class="keyword">false</span>, deserialize = <span class="keyword">true</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Expose</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// import com.google.gson.annotations.SerializedName;</span></span><br><span class="line">    <span class="meta">@SerializedName</span>(<span class="string">"registrationTime"</span>)</span><br><span class="line">    <span class="meta">@Expose</span></span><br><span class="line">    <span class="keyword">private</span> Date registration;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getRegistration</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> registration;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomBUser</span> <span class="keyword">extends</span> <span class="title">BaseUser</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Expose</span></span><br><span class="line">    <span class="keyword">private</span> JsonElement data;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JsonElement <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>registrationTime</code> çš„æ ¼å¼æˆ‘ä»¬ç”¨ <code>GsonBuilder</code> å£°æ˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Gson deserializationGson = <span class="keyword">new</span> GsonBuilder()</span><br><span class="line">        <span class="comment">// ä¸å¯¼å‡ºå®ä½“ä¸­æ²¡æœ‰ç”¨ @Expose æ³¨è§£çš„å±æ€§</span></span><br><span class="line">        .excludeFieldsWithoutExposeAnnotation()</span><br><span class="line">        <span class="comment">// æ—¶é—´æ ¼å¼</span></span><br><span class="line">        .setDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>)</span><br><span class="line">        .create();</span><br></pre></td></tr></table></figure><p>æ„‰å¿«åœ°ç©è€å§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CustomBUser cbu = deserializationGson.fromJson(json, CustomBUser.class);</span><br><span class="line">System.out.println(<span class="string">"id: "</span> + cbu.getId());</span><br><span class="line">System.out.println(cau.getData());</span><br></pre></td></tr></table></figure><h3><span id="è‡ªå®šä¹‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–">è‡ªå®šä¹‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–</span></h3><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>data</code> æ˜¯ç›´æ¥ç”¨ä¸€ä¸ª <code>JsonElement</code> æ¥å¤„ç†çš„ï¼Œå¦‚æœæœ‰æ›´åŠ ä¸ªæ€§åŒ–çš„è¦æ±‚ï¼Œé‚£å°±éœ€è¦è‡ªå·±å†™åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ–¹æ³•äº†ã€‚è¿™é‡Œæˆ‘ä»¬è‡ªå·±å®ç°ä¸€ä¸ª <code>CustomUserData</code> ç±»ï¼Œç”¨æ¥å¤„ç† <code>data</code> æ•°æ®ï¼Œç›´æ¥å®ç°ä¸Šé¢ç›¸åŒçš„åŠŸèƒ½ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomUserData</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> JsonElement ctx;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomUserData</span><span class="params">(JsonElement ctx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.ctx = ctx;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.ctx.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomAUser</span> <span class="keyword">extends</span> <span class="title">BaseUser</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Expose</span></span><br><span class="line">    <span class="keyword">private</span> CustomUserData data;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CustomUserData <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰ååºåˆ—åŒ–æ–¹æ³•</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomUserDataDeserializeAdapter</span> <span class="keyword">implements</span> <span class="title">JsonDeserializer</span>&lt;<span class="title">CustomUserData</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CustomUserData <span class="title">deserialize</span><span class="params">(JsonElement json, Type typeOfT, JsonDeserializationContext context)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> JsonParseException </span>&#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œå®ç°å¤æ‚çš„åŠŸèƒ½</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CustomUserData(json);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰åºåˆ—åŒ–æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomUserDataSerializeAdapter</span> <span class="keyword">implements</span> <span class="title">JsonSerializer</span>&lt;<span class="title">CustomUserData</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JsonElement <span class="title">serialize</span><span class="params">(CustomUserData src, Type typeOfSrc, JsonSerializationContext context)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œå®ç°å¤æ‚çš„åŠŸèƒ½</span></span><br><span class="line">        <span class="keyword">return</span> src.ctx;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ <code>registerTypeAdapter</code> ç»™ GsonBuilder æ³¨å†Œä¸Šé¢çš„è‡ªå®šä¹‰åºåˆ—åŒ–æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Gson deserializationGson = <span class="keyword">new</span> GsonBuilder()</span><br><span class="line">        .excludeFieldsWithoutExposeAnnotation()</span><br><span class="line">        .setDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>)</span><br><span class="line">        .registerTypeAdapter(CustomUserData.class, <span class="keyword">new</span> CustomUserDataDeserializeAdapter())</span><br><span class="line">        .create();</span><br><span class="line">Gson serializationGson = <span class="keyword">new</span> GsonBuilder()</span><br><span class="line">        .excludeFieldsWithoutExposeAnnotation()</span><br><span class="line">        .setDateFormat(<span class="string">"yyyy/MM/dd HH:mm:ss"</span>)</span><br><span class="line">        .registerTypeAdapter(CustomUserData.class, <span class="keyword">new</span> CustomUserDataSerializeAdapter())</span><br><span class="line">        .setPrettyPrinting()</span><br><span class="line">        .create();</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"---------- CustomAUser ----------"</span>);</span><br><span class="line">CustomAUser cau = deserializationGson.fromJson(json, CustomAUser.class);</span><br><span class="line">System.out.println(<span class="string">"id: "</span> + cau.getId());</span><br><span class="line"><span class="comment">// System.out.println(cau.getRegistration());</span></span><br><span class="line"><span class="comment">// System.out.println(cau.getData()); // .toString()</span></span><br><span class="line">System.out.println(serializationGson.toJson(cau));</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¥½é•¿æ—¶é—´æ²¡å†™ Javaï¼Œå‘ç°åºåˆ—åŒ–ã€ååºåˆ—åŒ–ä¸€ä¸ª JSON æ•°æ®çœŸä¸æ˜¯ä¸ªå®¹æ˜“çš„äº‹æƒ…ï¼ˆä¸»è¦è¿˜æ˜¯å¹´çºªå¤§äº†ï¼Œè®°ä¸ä½ï¼‰ã€‚äºæ˜¯è®°å½•ä¸€ä¸‹ä½¿ç”¨ &lt;a href=&quot;https://github.com/google/gson&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Gson&lt;/a&gt; ååºåˆ—åŒ–çš„æ–¹æ³•ã€‚æ–‡ä¸­æ¶‰åŠçš„ä»£ç éƒ½å¯ä»¥åœ¨è¿™ä¸ª &lt;a href=&quot;https://github.com/csbun/gson-deserialization-example&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;gson-deserialization-example&lt;/a&gt; ä¸­æ‰¾åˆ°ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä½œè€…æœ¬èº«ä¸æ‡‚ Javaï¼Œæœ¬ç€ä¸è´Ÿè´£çš„æ€åº¦å†™ä¸‹è¿™äº›å†…å®¹ï¼Œå¤§ç‰›å‹¿å–·ï¼Œæƒ³æŠ„ä»£ç çš„èœé¸Ÿè¯·çé‡ã€‚&lt;br&gt;æœ¬æ–‡åŸºäºè½¬æ¢æœŸé—´æ²¡æœ‰å¼‚å¸¸æƒ…å†µè®¨è®ºï¼Œå®é™…æƒ…å†µè¯·çé‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;åˆå§‹åŒ–&quot;&gt;&lt;a href=&quot;#åˆå§‹åŒ–&quot; class=&quot;headerlink&quot; title=&quot;åˆå§‹åŒ–&quot;&gt;&lt;/a&gt;åˆå§‹åŒ–&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªç®€å•çš„ &lt;em&gt;TestMain.java&lt;/em&gt; æ–‡ä»¶ï¼Œç”¨æ¥è¿è¡Œæˆ‘ä»¬åç»­çš„æµ‹è¯•æ–¹æ³•ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;figcaption&gt;&lt;span&gt;TestMain.java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;TestMain&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String args[])&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// è¿è¡Œæµ‹è¯•æ–¹æ³•&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://csbun.github.io/blog/tags/Java/"/>
    
      <category term="JSON" scheme="http://csbun.github.io/blog/tags/JSON/"/>
    
      <category term="serialization" scheme="http://csbun.github.io/blog/tags/serialization/"/>
    
      <category term="deserialization" scheme="http://csbun.github.io/blog/tags/deserialization/"/>
    
  </entry>
  
  <entry>
    <title>æˆ‘çœ¼ä¸­çš„ä¸–ç•Œï¼šé¦™æ¸¯</title>
    <link href="http://csbun.github.io/blog/2016/11/HK-in-my-eyes/"/>
    <id>http://csbun.github.io/blog/2016/11/HK-in-my-eyes/</id>
    <published>2016-11-22T09:56:30.000Z</published>
    <updated>2020-11-03T11:52:46.335Z</updated>
    
    <content type="html"><![CDATA[<p>ä»”ç´°æƒ³æƒ³ï¼Œå¾æ—…è¡Œçš„å®šç¾©ä¾†è¬›ï¼Œå»å¾—æœ€å¤šçš„åœ°æ–¹ï¼Œå±…ç„¶æ˜¯é¦™æ¸¯ğŸ‡­ğŸ‡°ï¼Œé€™å€‹èµ·åˆæˆ‘å¾ˆä¸å–œæ­¡çš„åœ°æ–¹ã€‚èªªåˆ°é¦™æ¸¯ï¼Œå¾ˆå¤šäººçš„ç¬¬å£¹å°è±¡å¤§å¤šæœƒæ˜¯é€™æ¨£ï¼š</p><img src="/2016/11/HK-in-my-eyes/HongKongIsland/DSC01355.jpg" title="å¤ªå¹³å±±é ‚"><a id="more"></a><p>æˆ–è€…æ˜¯åƒéº¥å…œè£é¢æç¹ªçš„é€™æ¨£ï¼š</p><img src="/2016/11/HK-in-my-eyes/other/McDull.jpeg" title="ä¾†æº: http://www.wxrw123.com/bg/20160911/2792375.html"><p>æˆ–è€…ï¼Œè‡³å°‘æ˜¯é€™æ¨£ï¼š</p><img src="/2016/11/HK-in-my-eyes/other/noodle.jpg" title="å¦³é¤“å””é¤“ï¼Œæˆ‘è½å€‹éººå¦³é£Ÿå•Š"><p>è€Œæˆ‘å°è±¡æœ€æ·±åˆ»çš„ï¼Œå»æ˜¯é€™æ¨£çš„ï¼š</p><img src="/2016/11/HK-in-my-eyes/LammaIsland/DSC03487.JPG" title="å—ä¸«å³¶ï¼Œç´¢è‹¦ç£ æˆ– æ¦•æ¨¹ç£ï¼Œä¸è¨˜å¾—äº†"><p>æ—©ä¸Šè¶æ²’äººçš„æ™‚å€™èµ°èµ°è±‰æ²¹è¡—ã€é€šèœè¡—ã€æ´—è¡£è¡—ã€ç¼½è˜­è¡—ï¼Œå°‡æœƒéå¸¸æ„œæ„~</p><img src="/2016/11/HK-in-my-eyes/Kowloon/DSC01221.jpg" title="æ²¹å°–æ—ºå¸‚é›†"><p>ç„¶å¾Œæ‰¾å£¹å®¶èŒ¶é¤å»³åä¸‹ï¼š</p><img src="/2016/11/HK-in-my-eyes/food/DSC01370.jpg" title="å¥¶èŒ¶ã€è è˜¿æ²¹"><h2><span id="ç›®çš„åœ°">ç›®çš„åœ°</span></h2><p>å»é¦™æ¸¯ä¸å£¹å®šçœŸçš„åªæ˜¯è²·è²·è²·ï¼Œå…¶å¯¦é›¢å³¶å€æˆ–è€…è¥¿è²¢ç­‰éƒŠé‡å…¬åœ’éƒ½æœ‰å¾ˆå¤šé¢¨æ™¯ç§€éº—çš„åœ°æ–¹ã€‚ä¸‹é¢ç°¡å–®ä»‹ç´¹æˆ‘å»éçš„å¹¾å€‹åœ°æ–¹ï¼Œç…§ç‰‡æ‡‰è©²æ˜¯æœ€å¥½çš„è¡¨é”æ–¹å¼ã€‚</p><h3><span id="å¤§æ¾³-tai-o">å¤§æ¾³ (Tai O)</span></h3><p>å¤§å¶¼å±±è…³ä¸‹çš„å°æ¼æ‘ï¼Œä½†ä¹Ÿå› æ—…éŠæ¥­çš„ç™¼å±•è€Œè®Šå¾—ç•¥å¸¶å•†æ¥­åŒ–ã€‚</p><div style="width:66%;margin:0 17%"><br>  <img src="/2016/11/HK-in-my-eyes/TaiO/DSC01404.JPG" title="è¡—é“"><br></div><p>ä¸è¦åªåœç•™åœ¨æ‘å£çš„é‚£å…©æ¢ä¸»è·¯ï¼Œåœ¨ä¿è­‰ä¸å½±éŸ¿åŸä½æ°‘çš„å‰æä¸‹ï¼Œé‚é–‹ç‹—è…¿å¾€å‰èµ°ï¼Œ</p><img src="/2016/11/HK-in-my-eyes/TaiO/DSC01438.JPG" title="è´éå…©åº§çæ¯çš„é¾èˆŸ"><p>é é›¢æ—…è¡Œåœ˜ï¼Œä¸åœåœ°èµ°ï¼Œ</p><img src="/2016/11/HK-in-my-eyes/TaiO/DSC01408.jpg" title="åŠè…³æ¨“ï¼Œæœ‰å¾ˆå¤šé›»å½±éƒ½æ˜¯åœ¨é€™è£æ‹æ”çš„"><p>ç›´åˆ°çœŸçš„æ²’æ³•ç¹¼çºŒå¾€å‰ç‚ºæ­¢ï¼</p><img src="/2016/11/HK-in-my-eyes/TaiO/DSC01447.jpg" title="æµ·é‚Šï¼Œæµ·æ°´éå¸¸å¹¹å‡ˆï¼Œæœ‰æ¼æ°‘æ•é­š"><h3><span id="å—ä¸«å³¶-lamma-island">å—ä¸«å³¶ (Lamma Island)</span></h3><p>åˆå£¹å€‹é›¢å³¶ï¼Œæ¸¡è¼ªç™»å³¶ä¹‹å¾Œï¼Œæœ‰å¹¾å®¶èŒ¶é¤å»³å’Œå£«å¤šåº—ï¼Œç‰©åƒ¹å’Œå¸‚å€å·®ä¸å¤šï¼ˆé¦™æ¸¯çš„æ™®é€šé¤å»³ç‰©åƒ¹é‚„æ˜¯æ¯”è¼ƒç†æ€§çš„ï¼Œå³ä¾¿æ˜¯é›¢å³¶ï¼Œåé çš„åœ°æ–¹ä¹Ÿä¸æœƒç¿»å€çš„æ¼²åƒ¹ï¼Œé€™å£¹é»åœ¨éº¥ç¶“æ„Ÿè§¸æœ€æ·±ï¼‰ï¼Œç•¶ç„¶ä¹Ÿæœ‰åƒæµ·é®®çš„é«˜ç´šè²¨ï¼š</p><img src="/2016/11/HK-in-my-eyes/LammaIsland/DSC03513.JPG" title="å¤©è™¹ï¼Œå¾ˆå¤šæ˜æ˜Ÿéƒ½ä¾†åƒé"><p>å¾€å³¶çš„æ·±è™•èµ°ï¼Œçˆ¬ä¸Šå±±å¯ä»¥çœ‹åˆ°å£¹å€‹â€œé’å¹´ç¤¾æœƒå¯¦è¸åŸºåœ°â€ï¼š</p><img src="/2016/11/HK-in-my-eyes/LammaIsland/DSC03429.JPG" title="åªæ‹äº†è·¯ç‰Œï¼Œæ²’æœ‰èµ°é€²å»"><p>é‚„èƒ½çœ‹åˆ°åƒé€™æ¨£çš„æµ·ç£ï¼š</p><img src="/2016/11/HK-in-my-eyes/LammaIsland/DSC03439.jpg" title="å±±ä¸Šçœ‹åˆ°çš„æµ·ç£å…¨æ™¯"><p>å³¶ä¸Šæœ‰é‚„æœ‰å¥½å¹¾å€‹æµ·ç˜ï¼Œä¸å¤§ï¼Œäººä¹Ÿä¸å¤šã€‚æµ·æ°´éå¸¸å¹¹å‡ˆï¼Œé…å¥—æ´—æµ´è¨­æ–½ã€æ•‘ç”Ÿå“¡ã€æ•‘ç”Ÿè¨­å‚™éƒ½éå¸¸å®Œå–„ï¼Œé‡é»æ˜¯ï¼Œå…è²»çš„ï¼</p><div style="width:66%;margin:0 17%"><br>  <img src="/2016/11/HK-in-my-eyes/LammaIsland/DSC03425.jpg" title="é›¢ç¢¼é ­æœ€è¿‘çš„æµ·ç˜ï¼Œ"><br></div><img src="/2016/11/HK-in-my-eyes/LammaIsland/DSC03448.jpg" title="è˜†é ˆåŸæµ·ç˜"><h3><span id="éº¥ç†æµ©å¾‘-maclehose-trail">éº¥ç†æµ©å¾‘ (MacLehose Trail)</span></h3><p>å£¹ã€äºŒæ®µæ˜¯éº¥ç†æµ©å¾‘çš„ç²¾è¯æ®µï¼Œæ˜¯é¦™æ¸¯é è¶³çš„é¦–é¸ç·šè·¯ï¼š</p><img src="/2016/11/HK-in-my-eyes/MacLehoseTrail/map1-2.png" title="å£¹ã€äºŒæ®µåœ°åœ–"><p>ç¬¬å£¹æ®µå¤§å£©çš„å·¦é‚Šæ˜¯æ°´åº«ï¼Œå³é‚Šæ˜¯å¤§æµ·ï¼Œé‚„æœ‰åœ°è³ªå…¬åœ’ï¼ˆæŠ±æ­‰æˆ‘æ²’æœ‰æ‹ç…§ï¼‰ã€‚</p><img src="/2016/11/HK-in-my-eyes/MacLehoseTrail/2016-10-02_154724.jpg" title="è¬å®œæ°´åº«ï¼Œé è™•æ˜¯å¤§å£©ï¼Œå¤§å£©é‚£é‚Šæ˜¯æµ·"><p>å³ä½¿æ˜¯åœ‹æ…¶å‡æœŸï¼Œå› ç‚ºé¦™æ¸¯ä¸æ”¾å‡ï¼Œåªæœ‰å¤§é™¸åœ˜ï¼Œäººä¸¦ä¸å¤šï¼š</p><img src="/2016/11/HK-in-my-eyes/MacLehoseTrail/2016-10-02_170433.jpg" title="å£¹æ®µçµ‚é»ï¼šæµªèŒ„ç£"><img src="/2016/11/HK-in-my-eyes/MacLehoseTrail/2016-10-03_172225.jpg" title="å¤§æµªç£ï¼Œè¦å¾é¹¹ç”°ç£ç¿»éæœ›é­šè§’æ‰èƒ½åˆ°é”çš„å¤§ç£"><p>ä½†é è¶³ä¸¦ä¸æ˜¯å£¹ä»¶ç°¡å–®çš„äº‹æƒ…ï¼Œå£¹å®šè¦æœ‰æ‰€æº–å‚™ï¼Œè¨»æ„å®‰å…¨ï¼</p><div><div style="width:50%;float:left;"><img src="/2016/11/HK-in-my-eyes/MacLehoseTrail/2016-10-03_121312.jpg" title="è² é‡å‰è¡Œ"></div><div style="width:50%;float:left;"><img src="/2016/11/HK-in-my-eyes/MacLehoseTrail/2016-10-03_095448.jpg" title="æˆ‘ç•¶æ—¥çš„è£å‚™"></div><div style="clear:both;"></div></div><h3><span id="å¡”é–€å³¶-grass-island">å¡”é–€å³¶ (Grass Island)</span></h3><p>é¦™æ¸¯çš„æ±æ¥µå³¶ï¼Œè¦ªè¿‘å¤§æµ·ï¼Œè¦ªè¿‘ç‰›ï¼š</p><img src="/2016/11/HK-in-my-eyes/GrassIsland/2016-10-04_155331.jpg" title="æ±é‚Šçš„æµ·"><img src="/2016/11/HK-in-my-eyes/GrassIsland/2016-10-05_061456.jpg" title="æœ€ä½³æ—¥å‡ºç‡Ÿåœ°"><h2><span id="ç¾é£Ÿ">ç¾é£Ÿ</span></h2><p>é‚„å¯ä»¥åƒåƒåƒå•Šï¼</p><h3><span id="æˆ‘è½å€‹éººå¦³é£Ÿå•Š">æˆ‘è½å€‹éººå¦³é£Ÿå•Š</span></h3><p>é¦™æ¸¯çœŸçš„æœ‰å¾ˆå¤šéººï¼šæ’ˆä¸ï¼Œè…¸è›‹éººï¼Œé¤è›‹éººï¼Œé­šè›‹ç²—éººâ€¦â€¦</p><img src="/2016/11/HK-in-my-eyes/food/2016-10-04_101506.jpg" title="è…¸è›‹éººã€‚é›–ç„¶è³£ç›¸ä¸å¥½ï¼Œä½†æ˜¯é è¶³é‚£å¹¾å¤©åƒæœ€å¤šå°±æ˜¯é€™è²¨äº†"><img src="/2016/11/HK-in-my-eyes/food/DSC01238.jpg" title="æ’ˆä¸ï¼Œè˜­èŠ³åœ’"><img src="/2016/11/HK-in-my-eyes/food/DSC01497.JPG" title="ç‰›é›œç²‰"><h3><span id="å¥¶èŒ¶-è è˜¿æ²¹">å¥¶èŒ¶ã€è è˜¿æ²¹</span></h3><img src="/2016/11/HK-in-my-eyes/food/DSC01235.jpg" title="å¥¶èŒ¶ã€ç‰›æ‰’åŒ…ï¼Ÿï¼Œè˜­èŠ³åœ’"><h3><span id="ç‡’å‘³">ç‡’å‘³</span></h3><p>å‰ç‡’ã€ç‡’éµã€ç‡’é´¨ã€ç‡’é›ã€æ²¹é›ï¼ŒèŒ¶é¤å»³å¿…å‚™ï¼å¾å¤ªå¹³å±±é ‚ä¸‹ä¾†å°±ç›´å¥” <em>å†èˆˆç‡’è‡˜</em> äº†ã€‚</p><img src="/2016/11/HK-in-my-eyes/food/DSC01360.jpg" title="å†èˆˆç‡’è‡˜ï¼Œç£ä»”è»’å°¼è©©é“265è™Ÿåœ°ä¸‹">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»”ç´°æƒ³æƒ³ï¼Œå¾æ—…è¡Œçš„å®šç¾©ä¾†è¬›ï¼Œå»å¾—æœ€å¤šçš„åœ°æ–¹ï¼Œå±…ç„¶æ˜¯é¦™æ¸¯ğŸ‡­ğŸ‡°ï¼Œé€™å€‹èµ·åˆæˆ‘å¾ˆä¸å–œæ­¡çš„åœ°æ–¹ã€‚èªªåˆ°é¦™æ¸¯ï¼Œå¾ˆå¤šäººçš„ç¬¬å£¹å°è±¡å¤§å¤šæœƒæ˜¯é€™æ¨£ï¼š&lt;/p&gt;
&lt;img src=&quot;/2016/11/HK-in-my-eyes/HongKongIsland/DSC01355.jpg&quot; title=&quot;å¤ªå¹³å±±é ‚&quot;&gt;
    
    </summary>
    
      <category term="æ—…è¡Œ" scheme="http://csbun.github.io/blog/categories/%E6%97%85%E8%A1%8C/"/>
    
    
      <category term="ç¾é£Ÿ" scheme="http://csbun.github.io/blog/tags/%E7%BE%8E%E9%A3%9F/"/>
    
      <category term="é£æ™¯" scheme="http://csbun.github.io/blog/tags/%E9%A3%8E%E6%99%AF/"/>
    
  </entry>
  
  <entry>
    <title>åˆ é™¤æœ¬åœ° Docker é•œåƒ</title>
    <link href="http://csbun.github.io/blog/2016/09/docker-remove-image/"/>
    <id>http://csbun.github.io/blog/2016/09/docker-remove-image/</id>
    <published>2016-09-28T02:42:21.000Z</published>
    <updated>2020-11-03T11:52:46.335Z</updated>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨ Docker ä¼šé—ç•™ä¸€å¤§å †ä¸çŸ¥é“ä»€ä¹ˆé¬¼çš„é•œåƒï¼Œä¸‹é¢æˆ‘ä»¬æƒ³åŠæ³•å¹²æ‰ä»–ä»¬ã€‚</p><h2><span id="tldr">TL;DR</span></h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a | grep <span class="string">'Exited'</span> | awk <span class="string">'&#123;print $1&#125;'</span> | xargs docker stop | xargs docker rm</span><br><span class="line">docker images | grep <span class="string">'&lt;none&gt;'</span> | awk <span class="string">'&#123;print $3&#125;'</span> | xargs docker rmi</span><br></pre></td></tr></table></figure><a id="more"></a><h2><span id="ç›´æ¥åˆ é™¤">ç›´æ¥åˆ é™¤</span></h2><p>å¯åŠ¨ Dockerï¼ˆå¦‚æœæ²¡æœ‰å¯åŠ¨çš„è¯ï¼‰ï¼Œmac ä¸‹è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">boot2docker start</span><br></pre></td></tr></table></figure></p><p>ç„¶åå¯ä»¥æŸ¥çœ‹ç°æœ‰çš„æœ¬åœ°é•œåƒ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p>ä»å¦‚ä¸‹çš„è¾“å‡ºç»“æœå¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šæ²¡æœ‰ä½†å æ®ç¡¬ç›˜ç©ºé—´çš„é•œåƒï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">REPOSITORY                         TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</span><br><span class="line">csbun/docker-centos6.6-java7-git   1.0                 4daba39c348a        3 weeks ago         1.183 GB</span><br><span class="line">csbun/docker-centos6.6-java7-git   latest              4daba39c348a        3 weeks ago         1.183 GB</span><br><span class="line">&lt;none&gt;                             &lt;none&gt;              e146cf64f30e        3 weeks ago         1.181 GB</span><br><span class="line">&lt;none&gt;                             &lt;none&gt;              139e0f6180fb        4 weeks ago         534 MB</span><br><span class="line">...</span><br><span class="line">centos                             6.6                 8668efb40032        12 weeks ago        202.6 MB</span><br><span class="line">hello-world                        latest              91c95931e552        17 months ago       910 B</span><br></pre></td></tr></table></figure><p>äºæ˜¯æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ä¸Šé¢çš„ <code>IMAGE ID</code> åˆ é™¤è¿™ä¸ªé•œåƒ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi &lt;image-id&gt;</span><br></pre></td></tr></table></figure><p>å¦‚æ— æ„å¤–ï¼Œè¿™ä¸ªé•œåƒå˜Ÿå˜Ÿå˜Ÿå°±ä¼šè¢«å¹²æ‰ã€‚ç„¶è€Œå¾ˆä¸å¹¸å¤§å¤šæ•°æ—¶å€™éƒ½ä¼šæç¤ºä¸‹æ¥é”™è¯¯ï¼Œè¡¨ç¤ºé•œåƒæ­£åœ¨è¢«æŸä¸ªå®¹å™¨ <code>container</code> ä½¿ç”¨ï¼š</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Error </span>response from daemon: Conflict, cannot delete 91c95931e552 because the container 429166761c13 is using it, use -f to force</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šï¼Œ<code>container id</code> ä¸º <code>429166761c13</code>ï¼ŒçŸ¥é“è¿™ä¸ª id æˆ‘ä»¬å°±èƒ½åœæ­¢å®¹å™¨ï¼Œç„¶åé‡æ–°åˆ é™¤é•œåƒï¼š</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">ps</span> -<span class="keyword">a</span> | <span class="keyword">grep</span> <span class="symbol">&lt;container-id&gt;</span></span><br><span class="line">docker <span class="keyword">stop</span> <span class="symbol">&lt;container-id&gt;</span></span><br><span class="line">docker rm <span class="symbol">&lt;container-id&gt;</span></span><br><span class="line">docker rmi <span class="symbol">&lt;image-id&gt;</span></span><br></pre></td></tr></table></figure><h2><span id="æ‰¹é‡åˆ é™¤">æ‰¹é‡åˆ é™¤</span></h2><p>ä½†æ˜¯é•œåƒå¥½å¤šæ€ä¹ˆåŠï¼Ÿå®¹å™¨æ›´å¤šæ€ä¹ˆåŠï¼Ÿåªèƒ½å†™è„šæœ¬æ‰¹é‡åˆ é™¤äº†ï¼š</p><p>é¦–å…ˆæˆ‘ä»¬é€šè¿‡ <code>docker ps -a</code> æ‰¾å‡ºæ‰€æœ‰å·²ç»é€€å‡ºçš„å®¹å™¨å¹¶ç”¨ <code>docker stop</code> å’Œ <code>docker rm</code> å°†å…¶å¹²æ‰ï¼Œä¿è¯é•œåƒæ²¡æœ‰è¢«å ç”¨ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a | grep <span class="string">'Exited'</span> | awk <span class="string">'&#123;print $1&#125;'</span> | xargs docker stop | xargs docker rm</span><br></pre></td></tr></table></figure><p>ç„¶åå†å°è¯•åˆ é™¤é•œåƒï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images | grep <span class="string">'&lt;none&gt;'</span> | awk <span class="string">'&#123;print $3&#125;'</span> | xargs docker rmi</span><br></pre></td></tr></table></figure><p>OKï¼Œä¸€åˆ‡éƒ½å¹²å‡€äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä½¿ç”¨ Docker ä¼šé—ç•™ä¸€å¤§å †ä¸çŸ¥é“ä»€ä¹ˆé¬¼çš„é•œåƒï¼Œä¸‹é¢æˆ‘ä»¬æƒ³åŠæ³•å¹²æ‰ä»–ä»¬ã€‚&lt;/p&gt;
&lt;h2 id=&quot;TL-DR&quot;&gt;&lt;a href=&quot;#TL-DR&quot; class=&quot;headerlink&quot; title=&quot;TL;DR&quot;&gt;&lt;/a&gt;TL;DR&lt;/h2&gt;&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;docker ps -a | grep &lt;span class=&quot;string&quot;&gt;&#39;Exited&#39;&lt;/span&gt; | awk &lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;print $1&amp;#125;&#39;&lt;/span&gt; | xargs docker stop | xargs docker rm&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;docker images | grep &lt;span class=&quot;string&quot;&gt;&#39;&amp;lt;none&amp;gt;&#39;&lt;/span&gt; | awk &lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;print $3&amp;#125;&#39;&lt;/span&gt; | xargs docker rmi&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Docker" scheme="http://csbun.github.io/blog/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>GitLab CI Runner with Docker</title>
    <link href="http://csbun.github.io/blog/2016/09/gitlab-ci-runner-with-docker/"/>
    <id>http://csbun.github.io/blog/2016/09/gitlab-ci-runner-with-docker/</id>
    <published>2016-09-04T10:32:07.000Z</published>
    <updated>2020-11-03T11:52:46.335Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="install-ci-runner">Install CI Runner:</span></h2><p>Install a <a href="https://about.gitlab.com/gitlab-ci/" target="_blank" rel="noopener">CI Runner</a> on a machine is quite <a href="https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/#installation" target="_blank" rel="noopener">easy</a>, here is the <a href="https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/blob/master/docs/install/linux-repository.md" target="_blank" rel="noopener">linux-repository</a>:<br>åœ¨ä¸€å°æ™®é€šæœºå™¨ä¸Šå®‰è£… <a href="https://about.gitlab.com/gitlab-ci/" target="_blank" rel="noopener">CI Runner</a> åº”è¯¥æ˜¯ä¸€ä»¶<a href="https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/#installation" target="_blank" rel="noopener">å¾ˆç®€å•çš„äº‹æƒ…</a>ï¼Œä¸‹é¢æ˜¯ <a href="https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/blob/master/docs/install/linux-repository.md" target="_blank" rel="noopener">Linux çš„å®‰è£…æ–¹æ³•</a>ï¼š</p><p>Add GitLabâ€™s official repository via apt-get or yum:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># For Debian/Ubuntu</span></span><br><span class="line">curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-ci-multi-runner/script.deb.sh | sudo bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># For CentOS</span></span><br><span class="line">curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-ci-multi-runner/script.rpm.sh | sudo bash</span><br></pre></td></tr></table></figure><a id="more"></a><p>Install <code>gitlab-ci-multi-runner</code>:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># For Debian/Ubuntu</span></span><br><span class="line">sudo apt-get install gitlab-ci-multi-runner</span><br><span class="line"></span><br><span class="line"><span class="comment"># For CentOS</span></span><br><span class="line">sudo yum install gitlab-ci-multi-runner</span><br></pre></td></tr></table></figure><h2><span id="register-a-specific-runner">Register a Specific Runner</span></h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gitlab-ci-multi-runner register</span><br></pre></td></tr></table></figure><p>Answer the following questions after this command:<br>è¿è¡Œä¸Šé¢è¿™æ®µè„šæœ¬å°†éœ€è¦ä½ å›ç­”å‡ ä¸ªé—®é¢˜ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/ci ):</span><br><span class="line">https://gitlab.com/ci</span><br><span class="line">Please enter the gitlab-ci token for this runner:</span><br><span class="line">xxx</span><br><span class="line">Please enter the gitlab-ci description for this runner:</span><br><span class="line">my-runner</span><br><span class="line">Please enter the gitlab-ci tags for this runner (comma separated):</span><br><span class="line">ci,runner</span><br><span class="line">INFO[0034] fcf5c619 Registering runner... succeeded</span><br><span class="line">Please enter the executor: docker-ssh+machine, docker, docker-ssh, parallels, shell, ssh, virtualbox, docker+machine:</span><br><span class="line">shell</span><br></pre></td></tr></table></figure><p>You can find the answer of the first 2 questions in the <code>Specific runners</code> section, <strong>Runners Page</strong> of your gitlab repo(<strong>Settings</strong> -&gt; <strong>Runners</strong>). We choose <code>shell</code> executor for the first time. Refresh the <strong>Runners Page</strong> you will see <code>my-runner</code> in the <code>Specific runners</code> list.<br>å¤´ä¸¤ä¸ªé—®é¢˜çš„ç­”æ¡ˆå°±åœ¨é¡¹ç›®çš„ <strong>Runners é¡µé¢</strong>ï¼ˆ<strong>Settings</strong> -&gt; <strong>Runners</strong>ï¼‰<code>Specific runners</code> åŒºåŸŸã€‚æ–¹ä¾¿éªŒè¯èµ·è§ï¼Œæˆ‘ä»¬å…ˆé€‰æ‹© <code>shell</code> executorã€‚åˆ·æ–°é¡µé¢å°±èƒ½çœ‹çš„åˆšåˆšæ³¨å†Œçš„ <code>my-runner</code> å‡ºç°åœ¨åˆ—è¡¨ä¸­ã€‚</p><p><img src="https://gitlab.com/help/ci/quick_start/img/runners_activated.png" alt="image from https://gitlab.com/help/ci/quick_start/README.md#configuring-a-runner"></p><h2><span id="running-the-specific-runner">Running the Specific Runner</span></h2><p>Click the <code>Disable Shared runners</code> button on the <strong>Runners Page</strong> so we can just use our runner register just now on each build. After commiting <em>.gitlab-ci.yml</em> (the file that is used by GitLab Runner to <a href="http://docs.gitlab.com/ce/ci/yaml/README.html" target="_blank" rel="noopener">manage your projectâ€™s build</a>), we will see jobs running in the <strong>Builds Page</strong> (or <strong>Pipelines Page</strong>) on each push.<br>ä¸ºäº†æ¯æ¬¡éƒ½è¿è¡Œæˆ‘ä»¬åˆšåˆšæ³¨å†Œçš„ runnerï¼Œéœ€è¦ç‚¹å‡» <strong>Runners é¡µ</strong> çš„ <code>Disable Shared runners</code> æŒ‰é’®ï¼Œæ”¾å¼ƒ Gitlab æä¾›çš„å…±äº« runnerã€‚æäº¤äº† <em>.gitlab-ci.yml</em> <a href="http://docs.gitlab.com/ce/ci/yaml/README.html" target="_blank" rel="noopener">æ„å»ºæ–‡ä»¶</a> æ–‡ä»¶çš„é¡¹ç›®ï¼Œæ¯æ¬¡ push éƒ½å¯ä»¥åœ¨ <strong>Builds é¡µé¢</strong> (or <strong>Pipelines é¡µé¢</strong>) çœ‹åˆ°è¿›åº¦ã€‚</p><h2><span id="docker-executor">Docker Executor</span></h2><p>If you want to use Docker runner, <a href="https://docs.docker.com/engine/installation/" target="_blank" rel="noopener">install</a> and start it before using the multi runner:<br><a href="https://docs.docker.com/engine/installation/" target="_blank" rel="noopener">å®‰è£…</a> Dockerï¼Œç”¨ä½œ runnerã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install</span></span><br><span class="line">curl -sSL https://get.docker.com/ | sh</span><br><span class="line"><span class="comment"># UPDATE: 2017-07-25: install docker for CentOS6ï¼š</span></span><br><span class="line"><span class="comment"># rpm -iUvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</span></span><br><span class="line"><span class="comment"># yum update -y</span></span><br><span class="line"><span class="comment"># yum -y install docker-io</span></span><br><span class="line"><span class="comment"># UPDATE: END</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># start the Docker daemon on CentOS</span></span><br><span class="line">sudo service docker start</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># start the Docker daemon on Mac</span></span><br><span class="line">boot2docker start</span><br></pre></td></tr></table></figure><p>Now we can register a specific docker runner:<br>ç°åœ¨å°±èƒ½æ³¨å†Œä¸€ä¸ª docker runnerï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gitlab-ci-multi-runner register</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">Please enter the executor: docker-ssh+machine, docker, docker-ssh, parallels, shell, ssh, virtualbox, docker+machine:</span><br><span class="line">docker</span><br><span class="line">Please enter the default Docker image (eg. ruby:2.1):</span><br><span class="line">centos:7</span><br></pre></td></tr></table></figure><p>Here we use a simple <a href="https://hub.docker.com/_/centos/" target="_blank" rel="noopener">centos7 docker image</a>. Now we have a pure environment at each build.<br>è¿™é‡Œæˆ‘ä»¬é€‰äº†ä¸€ä¸ª <a href="https://hub.docker.com/_/centos/" target="_blank" rel="noopener">centos7 çš„ Docker é•œåƒ</a>ï¼Œè¿™æ ·æˆ‘ä»¬æ¯æ¬¡æ„å»ºéƒ½æœ‰ä¸€ä¸ªâ€œçº¯å‡€â€çš„ç¯å¢ƒã€‚</p><h3><span id="create-docker-image">Create Docker Image</span></h3><p>Centos7 might too simple to do complex build with special requirements. We can <a href="https://docs.docker.com/engine/getstarted/step_four/" target="_blank" rel="noopener">build our own image</a> by <a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noopener">creating</a> a <em>Dockerfile</em>, Base <code>FROM</code> centos and installed with java7 using <code>RUN</code> command.<br>å½“æˆ‘ä»¬éœ€è¦å¤æ‚çš„æ„å»ºç¯å¢ƒæ—¶ï¼ŒCentos7 æ˜æ˜¾æ˜¯ä¸å¤Ÿç”¨çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥<a href="https://docs.docker.com/engine/getstarted/step_four/" target="_blank" rel="noopener">è‡ªå·±åšä¸€ä¸ªé•œåƒ</a>ï¼Œåªéœ€<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noopener">åˆ›å»º</a>ä¸€ä¸ª <em>Dockerfile</em> æ–‡ä»¶ï¼Œå£°æ˜åŸºäºï¼ˆ<code>FROM</code>ï¼‰centosï¼Œä¸”é€šè¿‡ <code>RUN</code> å‘½ä»¤å®‰è£… java7ã€‚</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> Hans Chan &lt;icsbun@gmail.com&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># yum install dependences</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install -y java-1.7.0-openjdk \</span></span><br><span class="line"><span class="bash">                   java-1.7.0-openjdk-devel</span></span><br></pre></td></tr></table></figure><p><a href="http://csbun.github.io/blog/2015/06/docker-with-node/#build-and-push">Build</a> it on your machine:<br>åœ¨ä½ çš„æœºå™¨ä¸Š<a href="http://csbun.github.io/blog/2015/06/docker-with-node/#build-and-push">æ„å»º</a>è¿™ä¸ªé•œåƒï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t &lt;docker-user-name&gt;/&lt;docker-image-name&gt; .</span><br></pre></td></tr></table></figure><p>Run it on your machine:<br>åœ¨ä½ çš„æœºå™¨ä¸Šè¿è¡Œè¿™ä¸ªé•œåƒï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># login bash</span></span><br><span class="line">docker run -i -t &lt;docker-user-name&gt;/&lt;docker-image-name&gt; /bin/bash</span><br><span class="line"><span class="comment"># check the java version</span></span><br><span class="line">java -version</span><br></pre></td></tr></table></figure><p>Push it to <a href="https://hub.docker.com/" target="_blank" rel="noopener">Docker Hub</a> if you <a href="https://docs.docker.com/engine/getstarted/step_five/" target="_blank" rel="noopener">have an account</a>:<br>å¦‚æœä½ æœ‰ä¸€ä¸ª <a href="https://hub.docker.com/" target="_blank" rel="noopener">Docker Hub</a> <a href="https://docs.docker.com/engine/getstarted/step_five/" target="_blank" rel="noopener">è´¦æˆ·</a>ï¼Œä½ å°±èƒ½æŠŠä½ çš„é•œåƒæ¨é€åˆ°å…¬ç½‘ä¸Šäº†ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push &lt;docker-user-name&gt;/&lt;docker-image-name&gt;</span><br></pre></td></tr></table></figure><p>Here is a <a href="https://hub.docker.com/r/csbun/docker-centos6.6-java7-git/" target="_blank" rel="noopener">full example</a> base on Centos6.6, which contains java7 and git CLI.<br>è¿™é‡Œæˆ‘å†™äº†ä¸€ä¸ª<a href="https://hub.docker.com/r/csbun/docker-centos6.6-java7-git/" target="_blank" rel="noopener">ç›¸å¯¹å®Œæ•´çš„ç¤ºä¾‹</a>ï¼ŒåŒ…å«äº† java7 å’Œ git å‘½ä»¤è¡Œç­‰ã€‚</p><h3><span id="config-specific-runner">Config Specific Runner</span></h3><p><a href="https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/blob/master/docs/configuration/advanced-configuration.md" target="_blank" rel="noopener">GitLab Runner configuration</a> uses the TOML format.<br>The file to be edited can be found in: <em>/etc/gitlab-runner/config.toml</em> (on *nix systems as root). Change the <code>image</code> parameter in [runners.docker] section to <code>&lt;docker-user-name&gt;/&lt;docker-image-name&gt;</code> created by yourself, restart runner an have fun!<br><a href="https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/blob/master/docs/configuration/advanced-configuration.md" target="_blank" rel="noopener">GitLab Runner é…ç½®</a> ä½¿ç”¨ TOML æ ¼å¼çš„æ–‡ä»¶ï¼Œæ”¾åœ¨ <em>/etc/gitlab-runner/config.toml</em> ï¼ˆroot æƒé™è¿è¡Œçš„ *nix ç³»ç»Ÿï¼‰ã€‚æŠŠ [runners.docker] æ®µè½ä¸­çš„ <code>image</code> å‚æ•°æ”¹æˆåˆšåˆšåˆ›å»ºçš„ <code>&lt;docker-user-name&gt;/&lt;docker-image-name&gt;</code> é•œåƒï¼Œé‡å¯ runner å³å¯ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gitlab-ci-multi-runner restart</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Install-CI-Runner&quot;&gt;&lt;a href=&quot;#Install-CI-Runner&quot; class=&quot;headerlink&quot; title=&quot;Install CI Runner:&quot;&gt;&lt;/a&gt;Install CI Runner:&lt;/h2&gt;&lt;p&gt;Install a &lt;a href=&quot;https://about.gitlab.com/gitlab-ci/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CI Runner&lt;/a&gt; on a machine is quite &lt;a href=&quot;https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/#installation&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;easy&lt;/a&gt;, here is the &lt;a href=&quot;https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/blob/master/docs/install/linux-repository.md&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;linux-repository&lt;/a&gt;:&lt;br&gt;åœ¨ä¸€å°æ™®é€šæœºå™¨ä¸Šå®‰è£… &lt;a href=&quot;https://about.gitlab.com/gitlab-ci/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CI Runner&lt;/a&gt; åº”è¯¥æ˜¯ä¸€ä»¶&lt;a href=&quot;https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/#installation&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å¾ˆç®€å•çš„äº‹æƒ…&lt;/a&gt;ï¼Œä¸‹é¢æ˜¯ &lt;a href=&quot;https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/blob/master/docs/install/linux-repository.md&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Linux çš„å®‰è£…æ–¹æ³•&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;p&gt;Add GitLabâ€™s official repository via apt-get or yum:&lt;/p&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# For Debian/Ubuntu&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-ci-multi-runner/script.deb.sh | sudo bash&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# For CentOS&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-ci-multi-runner/script.rpm.sh | sudo bash&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Docker" scheme="http://csbun.github.io/blog/tags/Docker/"/>
    
      <category term="ci" scheme="http://csbun.github.io/blog/tags/ci/"/>
    
  </entry>
  
  <entry>
    <title>Vue 2.0 Server-Side Rendering</title>
    <link href="http://csbun.github.io/blog/2016/08/vue-2-0-server-side-rendering/"/>
    <id>http://csbun.github.io/blog/2016/08/vue-2-0-server-side-rendering/</id>
    <published>2016-08-03T08:52:04.000Z</published>
    <updated>2020-11-03T11:52:46.334Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/vuejs/vue/issues/2873" target="_blank" rel="noopener">Vue 2.0</a> is now in beta6. What I am going to do is checkout how to use <a href="https://www.npmjs.com/package/vue-server-renderer" target="_blank" rel="noopener">SSR (server-side rendering)</a>.</p><a id="more"></a><h2><span id="simple-example">Simple Example</span></h2><p>Letâ€™s make a project first and install some dependencies:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir vue-ssr</span><br><span class="line"><span class="built_in">cd</span> vue-ssr</span><br><span class="line">npm init</span><br><span class="line">npm i vue@next vue-server-renderer --save</span><br></pre></td></tr></table></figure><p>Here is what we get in <em>package.json</em>:</p><figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"vue-ssr"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"vue"</span>: <span class="string">"^2.0.0-beta.6"</span>,</span><br><span class="line">    <span class="attr">"vue-server-renderer"</span>: <span class="string">"^2.0.0-beta.6"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now we can render a Vue instance to string:</p><figure class="highlight javascript"><figcaption><span>ssr.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Vue = <span class="built_in">require</span>(<span class="string">'vue'</span>);</span><br><span class="line"><span class="keyword">const</span> renderer = <span class="built_in">require</span>(<span class="string">'vue-server-renderer'</span>).createRenderer();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Cmp = Vue.component(<span class="string">'my-cmp'</span>, &#123;</span><br><span class="line">  template: <span class="string">`&lt;p&gt;this is a component&lt;/p&gt;`</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = Vue.component(<span class="string">'my-app'</span>, &#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    MyCmp,</span><br><span class="line">  &#125;,</span><br><span class="line">  template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div class="server-uptime"&gt;</span></span><br><span class="line"><span class="string">      &lt;h1&gt;&#123;&#123;name&#125;&#125;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">      &lt;h2&gt;age &#123;&#123;age&#125;&#125;&lt;/h2&gt;</span></span><br><span class="line"><span class="string">      &lt;my-cmp&gt;&lt;/my-cmp&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vm = <span class="keyword">new</span> App(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    name: <span class="string">'Hans'</span>,</span><br><span class="line">    age: <span class="number">18</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">renderer.renderToString(vm, (err, html) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err)&#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err.message);</span><br><span class="line">    <span class="built_in">console</span>.error(err.stack);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(html);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Run <code>node ssr.js</code> comes out the html string:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">server-rendered</span>=<span class="string">"true"</span> <span class="attr">class</span>=<span class="string">"server-uptime"</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hans<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> <span class="tag">&lt;<span class="name">h2</span>&gt;</span>age 18<span class="tag">&lt;/<span class="name">h2</span>&gt;</span> <span class="tag">&lt;<span class="name">p</span>&gt;</span>this is a component<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p> The root element has a <code>server-rendered=&quot;true&quot;</code> attribute. Weâ€™ll talk about it <a href="#client-side-hydration">later</a>.</p><h2><span id="bundle-renderer">Bundle Renderer</span></h2><p>In most cases, we use numerous <em>.vue</em> files. As we have:</p><figure class="highlight html"><figcaption><span>src/App.vue</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"my-app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>age: &#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">my-cmp</span> <span class="attr">:name</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">my-cmp</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> MyCmp <span class="keyword">from</span> <span class="string">'./MyCmp.vue'</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">randNum</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">return</span> <span class="built_in">Math</span>.round(<span class="built_in">Math</span>.random() * <span class="number">100</span>);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="undefined">  components: &#123;</span></span><br><span class="line"><span class="undefined">    MyCmp,</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  data() &#123;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      name: <span class="string">`Hans-<span class="subst">$&#123;randNum()&#125;</span>`</span>,</span></span><br><span class="line"><span class="undefined">      age: randNum(),</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-class">.my-app</span> &#123;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">background</span>: <span class="selector-id">#eee</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><figcaption><span>src/MyCmp.vue</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello &#123;&#123; name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Welcome to China!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">  props: [ <span class="string">'name'</span> ],</span></span><br><span class="line"><span class="actionscript">  replace: <span class="literal">false</span>,</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>In our server-side entry point, export a function. The function will receive the render context object (passed to bundleRenderer.renderToString or bundleRenderer.renderToStream), and should return a Promise, which should eventually resolve to the appâ€™s root Vue instance:</p><figure class="highlight javascript"><figcaption><span>server.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server-entry.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span>;</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Vue(App);</span><br><span class="line"></span><br><span class="line"><span class="comment">// the default export should be a function</span></span><br><span class="line"><span class="comment">// which will receive the context of the render call</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(app);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>We can easily use <a href="https://webpack.github.io/" target="_blank" rel="noopener">webpack</a> + <a href="https://www.npmjs.com/package/vue-loader" target="_blank" rel="noopener">vue-loader</a> with the bundleRenderer.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack vue-loader@next babel-loader babel-preset-es2015 --save-dev</span><br></pre></td></tr></table></figure><p> We do need to use a slightly different <em>webpack.config.js</em> and entry point for our server-side bundle.</p><figure class="highlight javascript"><figcaption><span>webpack/webpack.server.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> projectRoot = path.resolve(__dirname, <span class="string">'..'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  target: <span class="string">'node'</span>, <span class="comment">// !different</span></span><br><span class="line">  entry: path.join(projectRoot, <span class="string">'src/server.js'</span>),</span><br><span class="line">  output: &#123;</span><br><span class="line">    libraryTarget: <span class="string">'commonjs2'</span>, <span class="comment">// !different</span></span><br><span class="line">    path: path.join(projectRoot, <span class="string">'dist'</span>),</span><br><span class="line">    filename: <span class="string">'bundle.server.js'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    loaders: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.vue$/</span>,</span><br><span class="line">        loader: <span class="string">'vue'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        loader: <span class="string">'babel'</span>,</span><br><span class="line">        include: projectRoot,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>And <em>.babelrc</em> is needed:</p><figure class="highlight json"><figcaption><span>.babelrc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [ <span class="string">"es2015"</span> ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Run <code>webpack --config webpack/webpack.server.js</code> weâ€™ll get a <em>dist/bundle.server.js</em> file as the server-side bundle which can be read in server-side.</p><figure class="highlight javascript"><figcaption><span>ssr-bundle.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> vueServerRenderer = <span class="built_in">require</span>(<span class="string">'vue-server-renderer'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> filePath = path.join(__dirname, <span class="string">'./dist/bundle.server.js'</span>)</span><br><span class="line"><span class="keyword">const</span> code = fs.readFileSync(filePath, <span class="string">'utf8'</span>);</span><br><span class="line"><span class="keyword">const</span> bundleRenderer = vueServerRenderer.createBundleRenderer(code);</span><br><span class="line"></span><br><span class="line">bundleRenderer.renderToString(<span class="function">(<span class="params">err, html</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err.message);</span><br><span class="line">    <span class="built_in">console</span>.log(err.stack);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(html);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Run <code>node ssr-bundle.js</code> comes out a similar html string:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">server-rendered</span>=<span class="string">"true"</span> <span class="attr">class</span>=<span class="string">"my-app"</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hans-97<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> <span class="tag">&lt;<span class="name">h2</span>&gt;</span>age&amp;colon; 20<span class="tag">&lt;/<span class="name">h2</span>&gt;</span> <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello Hans-97<span class="tag">&lt;/<span class="name">p</span>&gt;</span> <span class="tag">&lt;<span class="name">p</span>&gt;</span>Welcome to China&amp;excl;<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2><span id="client-side-hydration">Client Side Hydration</span></h2><p>First of all, we have to create another bundle file for client-side. A <em>webpack.client.js</em> is needed. It is almost the same with <em>webpack.server.js</em> except <strong>NOT</strong> having <code>target: &#39;node&#39;</code> and <code>output.libraryTarget: &#39;commonjs2&#39;</code>, which bundle the client-side entry file:</p><figure class="highlight javascript"><figcaption><span>src/client.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> VueApp = Vue.extend(App);</span><br><span class="line"><span class="keyword">new</span> VueApp(&#123;</span><br><span class="line">  el: <span class="string">'.my-app'</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Then we will improve the above <em>ssr-bundle.js</em> example to an express server:</p><figure class="highlight javascript"><figcaption><span>server/index.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> vueServerRenderer = <span class="built_in">require</span>(<span class="string">'vue-server-renderer'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Server-Side Bundle File</span></span><br><span class="line"><span class="keyword">const</span> serverBundleFilePath = path.join(__dirname, <span class="string">'../dist/bundle.server.js'</span>)</span><br><span class="line"><span class="keyword">const</span> serverBundleFileCode = fs.readFileSync(serverBundleFilePath, <span class="string">'utf8'</span>);</span><br><span class="line"><span class="keyword">const</span> bundleRenderer = vueServerRenderer.createBundleRenderer(serverBundleFileCode);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Client-Side Bundle File</span></span><br><span class="line"><span class="keyword">const</span> clientBundleFilePath = path.join(__dirname, <span class="string">'../dist/bundle.client.js'</span>);</span><br><span class="line"><span class="keyword">const</span> clientBundleFileUrl = <span class="string">'/bundle.client.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Server-Side Rendering</span></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  bundleRenderer.renderToString(<span class="function">(<span class="params">err, html</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err)&#123;</span><br><span class="line">      res.status(<span class="number">500</span>).send(<span class="string">`</span></span><br><span class="line"><span class="string">        &lt;h1&gt;Error: <span class="subst">$&#123;err.message&#125;</span>&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;pre&gt;<span class="subst">$&#123;err.stack&#125;</span>&lt;/pre&gt;</span></span><br><span class="line"><span class="string">      `</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      res.send(<span class="string">`</span></span><br><span class="line"><span class="string">        &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">        &lt;html&gt;</span></span><br><span class="line"><span class="string">          &lt;head&gt;</span></span><br><span class="line"><span class="string">            &lt;meta charset="utf-8"&gt;</span></span><br><span class="line"><span class="string">            &lt;title&gt;Vue 2.0 SSR&lt;/title&gt;</span></span><br><span class="line"><span class="string">          &lt;/head&gt;</span></span><br><span class="line"><span class="string">          &lt;body&gt;</span></span><br><span class="line"><span class="string">            <span class="subst">$&#123;html&#125;</span></span></span><br><span class="line"><span class="string">            &lt;script src="<span class="subst">$&#123;clientBundleFileUrl&#125;</span>"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">          &lt;/body&gt;</span></span><br><span class="line"><span class="string">        &lt;/html&gt;`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Client-Side Bundle File</span></span><br><span class="line">app.get(clientBundleFileUrl, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> clientBundleFileCode = fs.readFileSync(clientBundleFilePath, <span class="string">'utf8'</span>);</span><br><span class="line">  res.send(clientBundleFileCode);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Start server</span></span><br><span class="line"><span class="keyword">const</span> PORT = process.env.PORT || <span class="number">3000</span>;</span><br><span class="line">app.listen(PORT, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Example app listening on port <span class="subst">$&#123;PORT&#125;</span>!`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p> For each render call, the code will be re-run in a new context using Node.jsâ€™ vm module. This ensures your application state is discrete between requests, and you donâ€™t need to worry about structuring your application in a limiting pattern just for the sake of SSR.</p></blockquote><p>Now, start the server and hit <a href="http://127.0.0.1:3000/" target="_blank" rel="noopener">http://127.0.0.1:3000/</a> on your favorite browser. But we get a warning message in the DevTool:</p><p><code>[Vue warn]: The client-side rendered virtual DOM tree is not matching server-rendered content. Bailing hydration and performing full client-side render.</code></p><p>Cause we have the <code>data()</code> function returning a random value in <em>src/App.vue</em>, so we got different html string form server and client via virtual-DOM.</p><blockquote><p>In server-rendered output, the root element will have the server-rendered=â€trueâ€ attribute. On the client, when you mount a Vue instance to an element with this attribute, it will attempt to â€œhydrateâ€ the existing DOM instead of creating new DOM nodes.</p></blockquote><p>Letâ€™s make some change:</p><figure class="highlight html"><figcaption><span>src/App.vue</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"my-app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>age: &#123;&#123;age&#125;&#125; <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"plus"</span>&gt;</span>+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">my-cmp</span> <span class="attr">:name</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">my-cmp</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> MyCmp <span class="keyword">from</span> <span class="string">'./MyCmp.vue'</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="undefined">  components: &#123;</span></span><br><span class="line"><span class="undefined">    MyCmp,</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  data() &#123;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">      name: <span class="string">'Hans'</span>,</span></span><br><span class="line"><span class="undefined">      age: 0,</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  created() &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">'created &gt; '</span> + <span class="keyword">this</span>.age);</span></span><br><span class="line"><span class="actionscript">    ++<span class="keyword">this</span>.age;</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  methods: &#123;</span></span><br><span class="line"><span class="undefined">    plus() &#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.age++;</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-class">.my-app</span> &#123;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">background</span>: <span class="selector-id">#eee</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Refresh the page and click the <code>+1</code> button. See whatâ€™s happening on both server and client side. Checkout <a href="https://github.com/csbun/vue2-ssr-example" target="_blank" rel="noopener">this repo</a> to see the full example.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://github.com/vuejs/vue/issues/2873&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Vue 2.0&lt;/a&gt; is now in beta6. What I am going to do is checkout how to use &lt;a href=&quot;https://www.npmjs.com/package/vue-server-renderer&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;SSR (server-side rendering)&lt;/a&gt;.&lt;/p&gt;
    
    </summary>
    
    
      <category term="Vue" scheme="http://csbun.github.io/blog/tags/Vue/"/>
    
      <category term="ssr" scheme="http://csbun.github.io/blog/tags/ssr/"/>
    
  </entry>
  
  <entry>
    <title>â€œæ°µå¿„æ›¼â€å°æ¹¾</title>
    <link href="http://csbun.github.io/blog/2016/04/culture-and-people-of-taiwan/"/>
    <id>http://csbun.github.io/blog/2016/04/culture-and-people-of-taiwan/</id>
    <published>2016-04-21T09:44:59.000Z</published>
    <updated>2020-11-03T11:52:46.314Z</updated>
    
    <content type="html"><![CDATA[<p>å—¯ï¼Œè·ç¦»åˆ›å»ºè¿™ä¸ªä¸ªåšå®¢æ–‡ä»¶å·²ç»æœ‰ 2 ä¸ªæœˆäº†ï¼Œéƒ½å¿«è¦å‡ºå‘ä¸‹ä¸€æ¬¡è¿œè¡Œäº†ï¼Œè¿˜åœ¨å†™ä¸Šä¸€ä¸ªåœ°æ–¹çš„æ¸¸è®°ã€‚ï¼ˆå½“æˆ‘å‘å¸ƒæ—¶ï¼Œæˆ‘å·²ç»ä»æ–¯é‡Œå…°å¡å›æ¥äº†â€¦â€¦ğŸ˜‚ï¼‰</p><h2><span id="æ¼«æ…¢">æ¼«æ…¢</span></h2><p>æˆ‘çš„ç†è§£ï¼Œ<strong>â€œæ¼«æ…¢â€</strong> æ˜¯å°æ¹¾äººï¼ˆç‰¹åˆ«æ˜¯å°å—äººï¼‰çš„ä¸€ç§å¤„ä¸–ä¹‹é“ï¼Œä¸€ç§ç”Ÿæ´»æ€åº¦ã€‚</p><a id="more"></a><h3><span id="æ¼«ä½†ä¸æ•£æ¼«">æ¼«ä½†ä¸æ•£æ¼«</span></h3><p>ä¸€åœºåä¸ºâ€œå—å¼â€çš„è‰åœ°éŸ³ä¹ä¼šï¼Œæ²¡æœ‰ç”µè§†å¹¿å‘Šï¼Œä¹Ÿæ²¡æœ‰å¡ç‰‡ä¼ å•ã€‚æˆ‘ä»¬ä»æ°‘å®¿æˆ¿ä¸œçš„å£ä¸­è·çŸ¥è¿™ä¸ªä¿¡æ¯ï¼Œåœ¨è§…é£Ÿå›æ¥çš„è·¯ä¸Šé¡ºé“å»æ„Ÿå—ä¸€ç•ªã€‚æ—¶å€¼ä¸‹åˆï¼Œå¬ä¼—å¤§å¤šéƒ½æ‡’ååœ¨æœ‰æ ‘è«çš„åœ°æ–¹ï¼Œä¹Ÿæœ‰é“æ†ç²‰ä¸å’Œç©¿ç€ç»Ÿä¸€çš„å¿—æ„¿è€…é¡¶ç€çƒˆæ—¥åœ¨æœ€ä½³ä½ç½®åŠ æ²¹åŠ©å¨ã€‚æˆ‘ä»¬ä¸€å¼€å§‹ä¹Ÿæ˜¯æŒ‘äº†ä¸ªé è¾¹çš„æ ‘è«ä½ç½®ï¼Œå¸­åœ°è€Œåã€‚å¬ç€æœ¬åœŸæ­Œæ‰‹å”±ç€ä¸€é¦–é¦–åŸåˆ›æ­Œæ›²ï¼Œçœ‹ç€æ„ˆæ¥æ„ˆå¤šäººåœ¨å‘¨å›´åä¸‹ï¼šæœ‰ä¸‰äº”æˆç¾¤çš„å¹´è½»äººå¸¦ç€é£Ÿç‰©é¥®æ–™ï¼Œè¾¹åƒè¾¹èŠï¼›æœ‰å¤–å›½å¤«å¦‡æŠ±ç€å©´å„¿ã€å¸¦ç€å°å­©ï¼Œå¬‰æˆç©è€ã€‚ç›´åˆ°æˆ‘ä»¬çš„è‚šå­é¥¿å¾—å’•å’•å«æ—¶ï¼Œå·²ç»æ˜¯å‚æ™šæ—¶åˆ†ï¼Œæœ‰æ›´å¤šçš„äººååˆ°äº†è‰åœ°ä¸­é—´ï¼Œæˆ‘ä»¬ä¹Ÿä¸å¾—ä¸èµ·èº«ç¦»å¼€è¿™ä»½æ¸…é—²ã€‚ä½†è¿™åœºå·²ç»è¿›è¡Œäº†å¤§åŠå¤©çš„éŸ³ä¹ä¼šè¿˜å°†ç»§ç»­ï¼Œè¿˜ä¼šæœ‰æ›´å¤šçš„äººå‰æ¥è§‚çœ‹ã€‚</p><img src="/2016/04/culture-and-people-of-taiwan/DSC04188.JPG" title="â€œå—å¼â€è‰åœ°éŸ³ä¹ä¼šå’Œç²‰ä¸"><p>å›åˆ°å°å—å¸‚åŒºï¼Œç»§ç»­å¯»è§…å„ç§ç™¾å¹´è€åº—ã€‚æ²¡é”™ï¼Œåœ¨å°å—ï¼Œä¹Ÿè®¸çŸ³ç²¾è‡¼ä¸Šä¸€å®¶ä¸èµ·çœ¼çš„å°åƒåº—ï¼Œå°±æ˜¯æœ‰è¿‘ç™¾å¹´å†å²çš„è€åº—ï¼›åœ¨ç‘èŠ³ï¼Œèµ°åˆ°ç«è½¦ç«™å¯¹é¢çš„ç¾é£Ÿè¡—ï¼Œéšä¾¿ä¸€å®¶æ¨è½¦å°è´©åŠ¨è¾„ä¹Ÿæ˜¯æœ‰å››äº”åå¹´å†å²ï¼›åœ¨å°ä¸œï¼Œç¬¬äºŒå¸‚åœºé‡Œçš„å°åƒã€é¥®æ–™ã€å¤è‚‰é¥­åº—è™½ç„¶çœ‹èµ·æ¥éƒ½æ˜¯å¹´è½»äººåœ¨æ‰“ç†ï¼Œç„¶åˆ™ä¹Ÿæœ‰å‡ åå¹´å†å²ã€‚è¿™æ ·çš„æƒ…å†µå¹¶ä¸æ˜¯ç‰¹ä¾‹ï¼Œåœ¨å…¨å°æ¹¾æ¯”æ¯”çš†æ˜¯ã€‚è¿™å¹¶ä¸å®¹æ˜“ï¼Œç™¾å¹´å†å²éœ€è¦å‡ ä»£äººå…±åŒåŠªåŠ›ï¼Œç§‰æ‰¿ç€ç›¸åŒçš„ä¿¡å¿µï¼ŒåŒå®ˆç€ä¸€ä»½åšæŒã€‚</p><img src="/2016/04/culture-and-people-of-taiwan/DSC04083.JPG" title="å…¨ç¾æˆé™¢è‡³ä»Šä»ç„¶ä½¿ç”¨æ‰‹ç»˜ç”µå½±çœ‹æ¿"><h3><span id="æ…¢ä½†ä¸ç¼“æ…¢">æ…¢ä½†ä¸ç¼“æ…¢</span></h3><p>è¿™æ¬¡åˆ°å°æ¹¾ï¼Œéå¸¸ä¸å·§ï¼Œé‡åˆ°çªç„¶åŠ å¼ºä¸ºå°é£çš„æœé¹ƒã€‚æ‰€å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬é¿å¼€äº†é‡ç¾çš„æ–°åŒ—ï¼Œå—ä¸‹åˆ°äº†èŠ±è²ã€‚å°é£å°†åœ¨æ¬¡æ—¥æ·±å¤œç™»é™†ï¼Œä½†å‰ä¸€å¤©çš„èŠ±è²å´æ˜¯ä¸€ç‰‡æ™´æœ—çƒˆæ—¥å½“ç©ºï¼ˆçƒ­å¸¦ä½å‹å°é£å¤–å›´ç›¸å¯¹é«˜å‹ï¼Œå—¯ï¼Œæˆ‘é«˜ä¸­åœ°ç†å­¦å¾—å¥½å¥½ï¼‰ã€‚å¤ªé²é˜ä¸€æ—¥æ¸¸å›æ¥å¹¶ä¸å°½å…´ï¼Œæƒ³ç€åˆ°ä¸ƒæ˜Ÿæ½­æ¡çŸ³å­çœ‹æ—¥è½ã€‚æ­¤æ—¶ç¦»å°é£ç™»é™†è¿˜æœ‰1å¤©å¤šï¼Œç„¶è€Œåœ¨ç¦»æµ·è¾¹è€è¿œçš„åœ°æ–¹æ—©æ—©å°±æ‹‰èµ·çš„è­¦æˆ’çº¿ï¼Œè¿˜æœ‰ä¸“äººæŠŠå®ˆã€‚äºæ˜¯ä¹ï¼Œæˆ‘å¹¶æ²¡æœ‰çœ‹åˆ°ä¼ è¯´ä¸­ç¾ä¸½çš„çŸ³æ»©å’Œè”šè“çš„å¤§æµ·ï¼Œä½†æ˜¯ï¼Œæˆ‘çœ‹åˆ°äº†å°æ¹¾äººæ°‘å¿«é€Ÿçš„åŠäº‹æ•ˆç‡å’Œè°¨æ…çš„å·¥ä½œæ€åº¦ã€‚ï¼ˆå…¶å®å°é£å½“å¤©æˆ‘ä»¬ä¹Ÿé¡¶ç€é›¨å‡ºå»è§…é£Ÿï¼Œè´ªå¥½ç©åˆ°äº†å¦ä¸€ä¸ªæµ·æ»¨å…¬å›­æƒ³çœ‹çœ‹ï¼Œç„¶è€Œåœ¨å…¥å£ä¸è¿œåˆçœ‹åˆ°äº†è­¦æˆ’çº¿ï¼Œä¾æ—§æœ‰äººæŠŠå®ˆï¼ç‹¬è‡ªä¸€äººï¼ï¼åœ¨è¿™å°é£å¤©é‡Œï¼ï¼ï¼ï¼‰</p><img src="/2016/04/culture-and-people-of-taiwan/DSC03543.JPG" title="æœ‰è­¦æˆ’çº¿è¿‡ä¸å»ä¸å—¨æ£®"><p>ä»ä¸ƒæ˜Ÿæ½­å›æ¥ï¼Œç»§ç»­å„ç§è§…é£Ÿã€‚æ¥åˆ°æœ‰åçš„ä¸¤å®¶åŒ…å¿ƒç²‰åœ†ï¼ˆæ­£å®—åŒ…å¿ƒç²‰åœ† &amp; äº”éœ¸ç„¦ç³–åŒ…å¿ƒç²‰åœ†ï¼‰ç‚¹é—¨å‰ã€‚é‚£æ˜¯ä¸€æ¡ä¸å®½çš„å•è¡Œçº¿ï¼Œæˆ‘ä»¬ç«™åœ¨é—¨å£çŠ¹è±«è¸Œèº‡äº†å¥½ä¹…ï¼Œçº ç»“è¦åƒå“ªä¸€å®¶ï¼ˆå·²ç»åƒå¾—å¾ˆé¥±å®åœ¨åƒä¸ä¸‹ä¸¤å®¶äº†ï¼‰ã€‚çŒ›ç„¶å›å¤´å‘ç°ä¸€è¾†çš„å£«è¢«æˆ‘ä»¬æ‹¦ä½äº†å»è·¯ï¼Œç„¶è€Œä»–å¹¶æ²¡æœ‰é—ªç¯æ›´æ²¡æœ‰é¸£å–‡å­ï¼Œè€Œæ˜¯æ…¢æ…¢åœ°è·Ÿåœ¨æˆ‘ä»¬åé¢ï¼Œç­‰æˆ‘ä»¬å‘å‰èµ°ã€‚è¿™æ‰æ„è¯†åˆ°é”™è¯¯çš„æˆ‘ä»¬èµ¶ç´§è®©å¼€äº†é“è·¯ï¼Œå¸æœºæ‰æ…¢æ…¢åŠ é€Ÿå‘å‰ç¦»å¼€ã€‚</p><h2><span id="çƒ­æƒ…">çƒ­æƒ…</span></h2><p>åˆšåˆšåˆ°èŠ±è²æ—¶æ˜¯çƒ¤(zhong)è‚‰(qiu)èŠ‚å‰ä¸€å¤©çš„æ™šä¸Šï¼ŒæŒ‰åœ°å›¾å¯»åˆ°<a href="https://zh.airbnb.com/rooms/7778696" target="_blank" rel="noopener">å°å¹¸ç¦æ°‘å®¿</a>ï¼Œä¸€å¼ å¤§æ¡Œå­å›´ç€5ã€6ä¸ªäººåœ¨åƒçƒ¤è‚‰ï¼Œç¾å¥³ä¸»äºº<a href="https://zh.airbnb.com/users/show/36513527" target="_blank" rel="noopener">å°æ¶µ</a>çƒ­æƒ…æ‹›å‘¼æˆ‘ä»¬ä¸€èµ·åƒï¼Œæˆ‘ä»¬è§‰å¾—æ€ªä¸å¥½æ„æ€çš„ï¼Œå§”å©‰æ‹’ç»ã€‚å°æ¶µæ‹›å‘¼æˆ‘ä»¬ä¸Šæ¥¼ä¹‹åï¼Œè€å¿ƒè¯¦ç»†åœ°ä»‹ç»æ°‘å®¿é‡Œé¢çš„æ¯ä¸€é¡¹è®¾æ–½ä¹‹åæ‰ç¦»å¼€ã€‚æˆ‘ä»¬ä¿©ç¨ä½œä¼‘æ•´ä¹‹åèƒŒç€å°åŒ…å‡†å¤‡å»å¤œå¸‚è§£å†³æ™šé¤ï¼Œä¸€å‡ºæˆ¿é—´å°±é‡åˆ°å°æ¶µç«¯ç€çƒ¤çš„é¸¡ç¿…ç­‰é€äº†è¿‡æ¥ï¼Œè¯´æ˜¯è¿˜æ˜¯è¦æˆ‘ä»¬å°å°ï¼Œç››æƒ…éš¾å´ï¼Œæˆ‘ä»¬ä¹Ÿä¸‹æ¥¼åŠ å…¥äº†çƒ¤è‚‰ç‹‚æ¬¢ï¼Œåƒäº†æˆ‘åœ¨å°æ¹¾æœ€éš¾å¿˜çš„ä¸€é¤ï¼šå€’ä¸åªæ˜¯å› ä¸ºå¯ä»¥åƒåˆ°å¾ˆå¤šæˆ‘çˆ±çš„è‚‰è‚‰è‚‰ğŸ–ã€å„ç§ç¾å‘³æµ·é²œğŸŸå’Œæ–°é²œæ°´æœğŸï¼Œæ›´é‡è¦çš„æ˜¯è®¤è¯†äº†ä»€ä¹ˆè›‹ç³•ğŸ°å¸ƒä¸ğŸ®éƒ½ä¼šè‡ªå·±åšçš„å·¦é‚»å³é‡Œï¼Œå»è¿‡å¾ˆå¤šåœ°æ–¹æœ‰å¾ˆå¤šæ•…äº‹çš„å°æ¶µåŠå¥¹çš„å°ä¼™ä¼´ä»¬ï¼Œè¿˜æœ‰å°æ¶µçš„å¦¹å¦¹å’Œä»–çš„æ³•å›½ç”·ç¥¨å’Œä»–çš„æ³•å›½ç™½é…’â€¦â€¦</p><img src="/2016/04/culture-and-people-of-taiwan/P50926-211814.jpg" title="æ¯ç›˜ç‹¼è—‰"><p>å› ä¸ºå°é£çš„å…³ç³»ï¼Œæ»ç•™èŠ±è²ï¼Œåé¢çš„è¡Œç¨‹å·²ç»å‹ç¼©äº†1å¤©ï¼Œå†ä¸ç¦»å¼€å¯èƒ½å°±å»ä¸äº†ç»¿å²›æ½œæ°´äº†ã€‚ä¸€æ—©ï¼Œæˆ‘éª‘ç€æä¾›çš„å…è´¹è„šè¸è½¦åˆ°ç«è½¦ç«™ç¢°è¿æ°”ï¼Œçœ‹æœ‰æ²¡æœ‰æœ€æ–°æ¶ˆæ¯ï¼›è€Œå¥³ç¥¨å°±åœ¨æ°‘å®¿è¾¹æ”¶æ‹¾ä¸œè¥¿è¾¹ç­‰æˆ‘çš„æ¶ˆæ¯ã€‚è¸Œèº‡é—´ï¼Œæˆ‘çªç„¶çœ‹åˆ°ä¸€è¾†åŠ å¼€çš„å—ä¸‹åˆ—è½¦ï¼Œä½†è·ç¦»å‘è½¦æ—¶é—´åªå‰©10minä¸åˆ°ï¼Œæˆ‘åªèƒ½æ‰“ç”µè¯ç»™å°æ¶µæ±‚åŠ©ï¼ˆå¯èƒ½æŠŠå¥¹åµé†’äº†ï¼‰ï¼ŒäºŒè¯æ²¡è¯´ï¼Œå¥¹ç”·ç¥¨å°±å¼€è½¦æŠŠæˆ‘å¥³ç¥¨é€åˆ°äº†ç«è½¦ç«™ï¼Œæˆ‘ä»¬ä¹Ÿå› æ­¤èµ¶ä¸Šäº†è¿™å¤©æ—©ä¸Šä»…æœ‰çš„ä¸€è¶Ÿåˆ—è½¦ï¼Œä¹Ÿå› æ­¤èƒ½æœ‰æ—¶é—´åœ¨ä¸­é€”çš„æ± ä¸Šéª‘å•è½¦ã€åƒä¾¿å½“ã€‚åŒ†åŒ†çš„ç¦»åˆ«ï¼Œè¿˜æœ‰é‚£ä¸ªè¢«æˆ‘éª‘å»ç«è½¦ç«™çš„å•è½¦ï¼Œè¿˜å¾—éº»çƒ¦å°æ¶µä»–ä»¬å†èµ°ä¸€è¶Ÿå»å–ï¼Œè¿™ä»¶äº‹ä¹Ÿä¸€ç›´è®©æˆ‘æ„Ÿåˆ°éå¸¸å†…ç–šã€‚</p><img src="/2016/04/culture-and-people-of-taiwan/P50929-110635.jpg" title="ä¸Šä¼ å†è¡¥ç¥¨"><p>åˆ°äº†å°å—ï¼Œ<a href="https://zh.airbnb.com/rooms/1111018" target="_blank" rel="noopener">å…­åœ“(å—)</a>çš„å¸…å“¥æˆ¿ä¸œé˜¿ç¡•å°±å’Œæˆ‘ä»¬èŠäº†èµ·æ¥ï¼Œå¾—çŸ¥æˆ‘ä»¬å¸Œæœ›åƒåƒåƒï¼Œä¾¿æ‹¿å‡ºäº†ä¸€å¼ ç®€åŒ–åœ°å›¾å’Œç¬”ï¼Œå¼€å§‹å‘æˆ‘ä»¬ä¸€é¡¹é¡¹ä»‹ç»å°å—å¸‚åŒºçš„é“åœ°ç¾é£Ÿï¼Œå¹¶åœ¨åœ°å›¾ä¸Šæ ‡è®°å¥½ã€‚æˆ‘é—®ä»–ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥é‡æ–°åšä¸€å¼ åœ°å›¾ï¼ŒæŠŠè¿™äº›ç‚¹éƒ½æ ‡è®°å¥½ï¼Œä¸ç”¨æ¯æ¬¡éƒ½ç”»å‘¢ã€‚ä»–è¯´ï¼Œè¿™æ ·èƒ½æ›´å¥½åœ°å’Œå®¢äººèŠå¤©ã€‚çš„ç¡®ï¼Œè¿™ç§æ‰‹æŠŠæ‰‹å¼çš„â€œæ•™å­¦â€äº’åŠ¨æ€§æ›´å¼ºï¼ŒåŒæ—¶ä¹Ÿèƒ½å› å®¢äººçš„å–œå¥½å®šåˆ¶å‡ºä»–ä»¬çš„ä¸“å±çš„å°å—åœ°å›¾ã€‚è€Œä¸”è¿™æ ·çš„èŠå¤©ä¸æ­¢ä¸€æ¬¡ï¼Œåœ¨æˆ‘ä»¬åœ¨å…­åœ“(å—)çš„å‡ å¤©é‡Œï¼Œæ¯å¤©éƒ½æœ‰é˜¿ç¡•å’Œæ ¼æ—ç»™æˆ‘ä»¬å°å—å»ºè®®å’Œä»–ä»¬çš„æ•…äº‹ï¼Œç”šè‡³å°ä¸­çš„æ­¥ä¼ tipsã€‚æ–‡ç« å¼€å¤´è¯´åˆ°çš„â€œå—å¼â€å°±æ˜¯ä»–ä»¬ä»‹ç»æˆ‘ä»¬å»çš„ï¼Œä»–ä»¬ä¹Ÿæ˜¯â€œå—å¼â€çš„å¿—æ„¿è€…ã€‚è‡³äºå°å—ä¹ƒè‡³å°æ¹¾ç¾é£Ÿï¼Œå°±çœ‹æˆ‘ä¹‹å‰å†™çš„è¿™ä¸ª<a href="http://csbun.github.io/blog/2015/11/eating-around-taiwan/">å°æ¹¾å¥½å¥½å‘·</a>å§ã€‚</p><div><div style="width:50%;float:left;"><img src="/2016/04/culture-and-people-of-taiwan/P51006-065713.jpg" title="åœ°å›¾æ­£é¢"></div><div style="width:50%;float:left;"><img src="/2016/04/culture-and-people-of-taiwan/P51003-234900.jpg" title="åœ°å›¾èƒŒé¢"></div><div style="clear:both;"></div></div><p>å°æ¹¾äººæ°‘çš„çƒ­æƒ…å½“ç„¶ä¸èƒ½åªç”¨æ°‘å®¿æ¥æ¦‚æ‹¬ï¼Œé‚£ä½åœ¨ç«è½¦ä¸Šå’Œæˆ‘ä»¬å¤§è°ˆå¥¹å„¿å­åœ¨å¤§é™†å·¥ä½œçš„å¥¶å¥¶ï¼Œé‚£äº›è·¯ä¸Šçƒ­å¿ƒæŒ‡è·¯çš„è·¯äººç”²ä¹™ä¸™ä¸ï¼Œä¹Ÿéƒ½è®©äººæ„Ÿåˆ°æ¸©æš–ã€‚</p><h2><span id="æ·³æœ´">æ·³æœ´</span></h2><p>åœ¨å°åŒ—çš„å¤œé‡Œï¼Œå¾’æ­¥æ¸¸èµ°ã€‚ä¸€æ¡ç©ºæ—·çš„è·¯ä¸Šå¹¶æ²¡æœ‰å¤ªå¤šè½¦ï¼Œä¸€ä½è€çˆ·çˆ·åœ¨è·¯è¾¹çœ‹ç€å¾€æ¥çš„è½¦ã€‚æˆ‘ä»¬ä»¥ä¸ºä»–åªæ˜¯æƒ³è¦è¿‡é©¬è·¯ï¼ˆè™½ç„¶ä»–ç­‰çš„ä½ç½®ç¦»æ–‘é©¬çº¿è¿˜æœ‰åæ¥ç±³çš„è·ç¦»ï¼‰ï¼Œå¹¶æ²¡æœ‰å¤ªåœ¨æ„ã€‚å½“æˆ‘ä»¬èµ°è¿‡é©¬è·¯çš„æ—¶å€™ï¼Œçœ‹åˆ°ä»–ä¹Ÿèµ°å‘é©¬è·¯ï¼Œç„¶åæŠŠä¸€ä¸ªå¼¹å¼€çš„äº•ç›–ï¼ˆåªæœ‰å¤§æ¦‚æ¯å£å¤§ï¼Œå¬å£°éŸ³åƒæ˜¯é‡‘å±ï¼Œåº”è¯¥èƒ½å«äº•ç›–å§ï¼Œæ¬¢è¿æŒ‡æ­£ï¼‰è¸¢å›åŸå¤„ï¼Œç„¶åå›åˆ°è·¯è¾¹ï¼Œç¦»å¼€ã€‚</p><h2><span id="ç»“è¯­">ç»“è¯­</span></h2><p>é€šå¸¸è¿™ä¸ªæ—¶å€™è¦å¤§å¤§å‘è¡¨æ„Ÿæ…¨ä¸€ç•ªï¼Œç„¶è€Œæˆ‘å¹¶ä¸ä¼šè¿™æ ·åšğŸ˜‹ã€‚å°æ¹¾çš„æ¸¸è®°ä¹Ÿå°±åˆ°æ­¤ä¸ºæ­¢ï¼ˆè™½ç„¶åªæœ‰2ç¯‡ï¼‰ï¼Œä¸å†™é£æ™¯çš„ä¸“é¢˜ï¼Œä¹Ÿæ˜¯å› ä¸ºè¿™æ ·çš„å†…å®¹ç½‘è·¯ä¸Šå¤ªå¤šäº†ï¼Œæˆ‘ä»¬çš„ç…§ç‰‡è™½ç„¶æ¼‚äº®ï¼Œä½†æ˜¯æˆ‘å°±æ˜¯ä¸ç»™ä½ ä»¬çœ‹ğŸ˜œã€‚</p><img src="/2016/04/culture-and-people-of-taiwan/DSC04400.JPG" title="å½©è™¹æ‘">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å—¯ï¼Œè·ç¦»åˆ›å»ºè¿™ä¸ªä¸ªåšå®¢æ–‡ä»¶å·²ç»æœ‰ 2 ä¸ªæœˆäº†ï¼Œéƒ½å¿«è¦å‡ºå‘ä¸‹ä¸€æ¬¡è¿œè¡Œäº†ï¼Œè¿˜åœ¨å†™ä¸Šä¸€ä¸ªåœ°æ–¹çš„æ¸¸è®°ã€‚ï¼ˆå½“æˆ‘å‘å¸ƒæ—¶ï¼Œæˆ‘å·²ç»ä»æ–¯é‡Œå…°å¡å›æ¥äº†â€¦â€¦ğŸ˜‚ï¼‰&lt;/p&gt;
&lt;h2 id=&quot;æ¼«æ…¢&quot;&gt;&lt;a href=&quot;#æ¼«æ…¢&quot; class=&quot;headerlink&quot; title=&quot;æ¼«æ…¢&quot;&gt;&lt;/a&gt;æ¼«æ…¢&lt;/h2&gt;&lt;p&gt;æˆ‘çš„ç†è§£ï¼Œ&lt;strong&gt;â€œæ¼«æ…¢â€&lt;/strong&gt; æ˜¯å°æ¹¾äººï¼ˆç‰¹åˆ«æ˜¯å°å—äººï¼‰çš„ä¸€ç§å¤„ä¸–ä¹‹é“ï¼Œä¸€ç§ç”Ÿæ´»æ€åº¦ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="æ—…è¡Œ" scheme="http://csbun.github.io/blog/categories/%E6%97%85%E8%A1%8C/"/>
    
    
      <category term="é£åœŸäººæƒ…" scheme="http://csbun.github.io/blog/tags/%E9%A3%8E%E5%9C%9F%E4%BA%BA%E6%83%85/"/>
    
  </entry>
  
  <entry>
    <title>Modules in CommonJS and ES2015</title>
    <link href="http://csbun.github.io/blog/2016/01/modules/"/>
    <id>http://csbun.github.io/blog/2016/01/modules/</id>
    <published>2016-01-27T08:20:18.000Z</published>
    <updated>2020-11-03T11:52:46.313Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="commonjs">CommonJS</span></h2><p>Letâ€™s see 2 examples in CommonJS:</p><a id="more"></a><ul><li>Example 1</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ----- lib.js -----</span></span><br><span class="line"><span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">exports.up = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ++count;</span><br><span class="line">&#125;</span><br><span class="line">exports.count = count;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ----- main.js -----</span></span><br><span class="line"><span class="keyword">var</span> lib = <span class="built_in">require</span>(<span class="string">'./lib'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(lib.count); <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">console</span>.log(lib.up());  <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(lib.count); <span class="comment">// 0</span></span><br></pre></td></tr></table></figure><p>In this case, <code>lib.count</code> in <em>main.js</em> would not change after function <code>lib.up</code> called. In <em>lib.js</em> we can see, <code>count</code> is a <strong>number</strong>, which is <a href="https://developer.mozilla.org/en-US/docs/Glossary/Primitive" target="_blank" rel="noopener">primitive</a>, so is <code>exports.count</code>. Thus, <code>exports.count</code> wonâ€™t change when we change <code>count</code>. We can change it to make a different:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ----- lib.change.js -----</span></span><br><span class="line"><span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">exports.up = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> exports.count = ++count;</span><br><span class="line">&#125;</span><br><span class="line">exports.count = count;</span><br></pre></td></tr></table></figure><p>The follow example may looks better.</p><ul><li>Example 2</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ----- lib.2.js -----</span></span><br><span class="line"><span class="keyword">var</span> out = &#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">    up: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++out.count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">module</span>.exports = out;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ----- main.2.js -----</span></span><br><span class="line"><span class="keyword">var</span> lib = <span class="built_in">require</span>(<span class="string">'./lib.2'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(lib.count); <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">console</span>.log(lib.up());  <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(lib.count); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><h2><span id="es2015-modules">ES2015 modules</span></h2><p>Itâ€™s simple to make <strong>Example 2</strong> works in ES2015:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ----- lib.js -----</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">up</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ++count;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">unused</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> --count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ----- main.js -----</span></span><br><span class="line"><span class="keyword">import</span> &#123; count, up &#125; <span class="keyword">from</span> <span class="string">'./lib'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(count);</span><br><span class="line"><span class="built_in">console</span>.log(up());</span><br><span class="line"><span class="built_in">console</span>.log(count);</span><br></pre></td></tr></table></figure><h3><span id="babel">Babel</span></h3><p>Using <a href="http://babeljs.io/" target="_blank" rel="noopener">Babel</a> and <a href="https://www.npmjs.com/package/babel-preset-es2015" target="_blank" rel="noopener">babel-preset-es2015</a> make it similar to our <code>lib.change.js</code>:</p><ul><li>babel lib.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(exports, <span class="string">"__esModule"</span>, &#123;</span><br><span class="line">    value: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line">exports.up = up;</span><br><span class="line"><span class="comment">// ----- lib.js -----</span></span><br><span class="line"><span class="keyword">var</span> count = exports.count = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">up</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> exports.count = count += <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>babel main.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _lib = <span class="built_in">require</span>(<span class="string">'./lib'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(_lib.count); <span class="comment">// ----- main.js -----</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log((<span class="number">0</span>, _lib.up)());</span><br><span class="line"><span class="built_in">console</span>.log(_lib.count);</span><br></pre></td></tr></table></figure><h3><span id="rollup">Rollup</span></h3><p><a href="http://rollupjs.org/" target="_blank" rel="noopener">Rollup</a> bundle up with less code:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----- lib.js -----</span></span><br><span class="line"><span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">up</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ++count;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(count);</span><br><span class="line"><span class="built_in">console</span>.log(up());</span><br><span class="line"><span class="built_in">console</span>.log(count);</span><br></pre></td></tr></table></figure><h2><span id="read-more">Read More</span></h2><ul><li><a href="http://www.2ality.com/2014/09/es6-modules-final.html" target="_blank" rel="noopener">ECMAScript 6 modules: the final syntax</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;CommonJS&quot;&gt;&lt;a href=&quot;#CommonJS&quot; class=&quot;headerlink&quot; title=&quot;CommonJS&quot;&gt;&lt;/a&gt;CommonJS&lt;/h2&gt;&lt;p&gt;Letâ€™s see 2 examples in CommonJS:&lt;/p&gt;
    
    </summary>
    
    
      <category term="CommonJS" scheme="http://csbun.github.io/blog/tags/CommonJS/"/>
    
      <category term="ES2015" scheme="http://csbun.github.io/blog/tags/ES2015/"/>
    
  </entry>
  
  <entry>
    <title>Tree-shaking ES2015</title>
    <link href="http://csbun.github.io/blog/2015/12/tree-shaking-es2015/"/>
    <id>http://csbun.github.io/blog/2015/12/tree-shaking-es2015/</id>
    <published>2015-12-25T13:27:23.000Z</published>
    <updated>2020-11-03T11:52:46.312Z</updated>
    
    <content type="html"><![CDATA[<p>ğŸŒ²ğŸ… ~~ åœ£è¯å¿«ä¹ ~~ ğŸ‰âœ¨</p><h2><span id="rollup">Rollup</span></h2><p>ä¹‹å‰çœ‹åˆ° <a href="http://rollupjs.org/" target="_blank" rel="noopener">rollup.js</a> å°±è§‰å¾—å¾ˆæœ‰è¶£ï¼Œåæ¥ç»ˆäºæœ‰ç©ºï¼ŒæŠŠæˆ‘çš„å°é¡¹ç›® <a href="https://github.com/csbun/silly-datetime" target="_blank" rel="noopener">silly-datetime</a> æ”¹æˆäº† ES2015 ç„¶åç”¨ Rollup è½¬æˆ CommonJS å’Œ UMD ä¸¤ä¸ªç‰ˆæœ¬åˆ†åˆ«ç»™ <a href="https://www.npmjs.com/" target="_blank" rel="noopener">npm</a> å’Œ <a href="http://bower.io/" target="_blank" rel="noopener">Bower</a> ä½¿ç”¨ã€‚</p><a id="more"></a><p>ç®€å•è´´ä¸€ä¸‹ä½¿ç”¨æ–¹æ³•ï¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <em><a href="https://github.com/csbun/silly-datetime/blob/master/rollup.js" target="_blank" rel="noopener">rollup.js</a></em> æ–‡ä»¶ï¼Œè°ƒç”¨ Rollup çš„ APIï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> rollup = <span class="built_in">require</span>( <span class="string">'rollup'</span> );</span><br><span class="line"><span class="keyword">var</span> babel = <span class="built_in">require</span>(<span class="string">'rollup-plugin-babel'</span>);</span><br><span class="line"></span><br><span class="line">rollup.rollup(&#123;</span><br><span class="line">  <span class="comment">// å…¥å£æ–‡ä»¶</span></span><br><span class="line">  entry: <span class="string">'src/index.js'</span>,</span><br><span class="line">  plugins: [</span><br><span class="line">    babel()</span><br><span class="line">  ]</span><br><span class="line">&#125;).then( <span class="function"><span class="keyword">function</span> (<span class="params"> bundle </span>) </span>&#123;</span><br><span class="line">  <span class="comment">// CommonJS</span></span><br><span class="line">  bundle.write(&#123;</span><br><span class="line">    format: <span class="string">'cjs'</span>,</span><br><span class="line">    dest: <span class="string">'dest/index.js'</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// UMD</span></span><br><span class="line">  bundle.write(&#123;</span><br><span class="line">    format: <span class="string">'umd'</span>,</span><br><span class="line">    moduleName: <span class="string">'SillyDatetime'</span>,</span><br><span class="line">    dest: <span class="string">'dest/index.umd.js'</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å‘½ä»¤è¡Œè¿è¡Œè¿™ä¸ªæ–‡ä»¶ <code>node rollup.js</code> å³å¯ç”Ÿæˆ <code>dest/index.js</code> å’Œ <code>dest/index.umd.js</code>ã€‚å¦‚æœå¸Œæœ›æ–¹ä¾¿æ”¹ç»„ä»¶è¢«åˆ«çš„é¡¹ç›®è°ƒç”¨ï¼Œå°±éœ€è¿›è¡Œä¸€äº›é…ç½®å£°æ˜ï¼ŒåŒ…æ‹¬ <em>package.json</em></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"dest/index.js"</span>,</span><br><span class="line">  <span class="attr">"jsnext:main"</span>: <span class="string">"src/index.js"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œ <em>bower.json</em>ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"dest/index.umd.js"</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶è€Œè¿™å¹¶ä¸æ˜¯ Rollup æœ€å¼ºå¤§åŠŸèƒ½çš„ä½“ç°ï¼Œå› ä¸ºè¿™çœ‹ä¸å‡º Tree-shakingã€‚</p><h2><span id="tree-shaking">Tree-shaking</span></h2><blockquote><p>eliminate unused library code</p></blockquote><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° <a href="https://github.com/csbun/silly-datetime" target="_blank" rel="noopener">silly-datetime</a> æä¾›äº† <code>format</code>ã€<code>fromNow</code> å’Œ <code>locate</code> 3 ä¸ªæ–¹æ³•ï¼Œç„¶è€Œå¤§éƒ¨åˆ†æ—¶é—´æˆ‘ä»¬åªéœ€è¦ç”¨åˆ°å…¶ä¸­çš„ä¸€ä¸ªï¼Œå¦‚æœå°†è¿™ä¹ˆä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶ bundle èµ·æ¥ï¼Œå°†æœ‰å¾ˆå¤šæ— ç”¨çš„ä»£ç ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°†åˆ›å»ºè¿™ä¹ˆä¸€ä¸ªç¤ºä¾‹è¯´æ˜æƒ…å†µï¼Œé¦–å…ˆæˆ‘ä»¬æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå¼•ç”¨ä¸Šè¿°çš„ <a href="https://github.com/csbun/silly-datetime" target="_blank" rel="noopener">silly-datetime</a>:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br><span class="line">npm i silly-datetime --save</span><br><span class="line">touch index.js</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬ä¿®æ”¹ <em>index.js</em> ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; format &#125; <span class="keyword">from</span> <span class="string">'silly-datetime'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> getStr = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> format(<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> formatedDate = getStr();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`now is <span class="subst">$&#123;formatedDate&#125;</span>`</span>);</span><br></pre></td></tr></table></figure><h3><span id="browserify">Browserify</span></h3><p>æˆ‘ä»¬å…ˆè¯•è¯• Browserifyï¼Œä½†åœ¨è¿™ä¹‹å‰æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸‹ babel æ’ä»¶ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i babelify babel-preset-es2015 --save-dev</span><br></pre></td></tr></table></figure><p>å¹¶é…ç½®ä¸€ä¸‹ <em>package.json</em></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"browserify"</span>: &#123;</span><br><span class="line">    <span class="attr">"transform"</span>: [</span><br><span class="line">      [ <span class="string">"babelify"</span>, &#123; <span class="attr">"presets"</span>: [ <span class="string">"es2015"</span> ] &#125; ]</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œ <code>browserify index.js &gt; dest/bundle.browserify.js</code> åæˆ‘ä»¬å¯ä»¥çœ‹åˆ° bundle æ–‡ä»¶ç”¨çš„æ˜¯ä¹‹å‰å·²ç»ç”¨ rollup ç”Ÿæˆçš„ <code>node_modules/silly-datetime/dest/index.js</code>ã€‚äºæ˜¯æˆ‘ä»¬å°†æºç å¤åˆ¶å‡ºæ¥</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp node_modules/silly-datetime/src/index.js lib/silly-datetime.es2015.js</span><br></pre></td></tr></table></figure><p>å¹¶æ”¹ä¸€ä¸‹ <em>index.js</em>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; format &#125; <span class="keyword">from</span> <span class="string">'./lib/silly-datetime.es2015.js'</span>;</span><br></pre></td></tr></table></figure><p>å†æ¥ä¸€æ¬¡å¦‚ä½•ï¼Ÿçœ‹åˆ° bundle æ–‡ä»¶å·²ç»å°† ES2015 è½¬æˆäº† CommonJS çš„ ES5:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#123;<span class="number">1</span>:[<span class="function"><span class="keyword">function</span>(<span class="params">require,module,exports</span>)</span>&#123;</span><br><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _datetimeEs = <span class="built_in">require</span>(<span class="string">'./lib/silly-datetime.es2015.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> getStr = <span class="function"><span class="keyword">function</span> <span class="title">getStr</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="number">0</span>, _datetimeEs.format)(<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> formatedDate = getStr();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'now is '</span> + formatedDate);</span><br><span class="line"></span><br><span class="line">&#125;,&#123;<span class="string">"./lib/silly-datetime.es2015.js"</span>:<span class="number">2</span>&#125;],<span class="number">2</span>:[<span class="function"><span class="keyword">function</span>(<span class="params">require,module,exports</span>)</span>&#123;</span><br><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"><span class="comment">/* æ³¨æ„è¿™é‡Œ */</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(exports, <span class="string">"__esModule"</span>, &#123;</span><br><span class="line">  value: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line">exports.format = format;</span><br><span class="line">exports.locate = locate;</span><br><span class="line">exports.fromNow = fromNow;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;]&#125;</span><br></pre></td></tr></table></figure><p>æ˜æ˜¾è¿™é‡Œçš„ <code>locate</code> å’Œ <code>fromNow</code> æ˜¯ä¸ä¼šè¢«æ¶ˆç­çš„ï¼Œå³ä½¿ä½¿ç”¨äº† <a href="https://github.com/mishoo/UglifyJS" target="_blank" rel="noopener">UglifyJS</a>ã€‚å¦å¤–ï¼Œç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°è¿™æ®µä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">0</span>, _datetimeEs.format)(<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿçœ‹ä¸€ä¸‹ <a href="http://rauschma.de/" target="_blank" rel="noopener">Dr. Axel Rauschmayer</a> çš„ <a href="http://www.2ality.com/2015/12/references.html" target="_blank" rel="noopener">Why is (0,obj.prop)() not a method call?</a>ã€‚</p><h3><span id="rollup">Rollup</span></h3><p>æˆ‘ä»¬çœ‹çœ‹ Rollup çš„è¡¨ç°ï¼Œä¸€æ ·è¦æ·»åŠ  babel æ’ä»¶ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i rollup-plugin-babel babel-preset-es2015-rollup --save-dev</span><br></pre></td></tr></table></figure><p>å¹¶é…ç½®ä¸€ä¸‹ <em>rollup.config.js</em>ï¼ˆè¯¦è§ <a href="https://github.com/rollup/rollup/wiki/Command-Line-Interface" target="_blank" rel="noopener">Command-Line-Interface</a>ï¼‰ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> babel <span class="keyword">from</span> <span class="string">'rollup-plugin-babel'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  entry: <span class="string">'index.js'</span>,</span><br><span class="line">  dest: <span class="string">'dest/bundle.rollup.js'</span>,</span><br><span class="line">  format: <span class="string">'umd'</span>,</span><br><span class="line">  plugins: [ babel() ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å’Œ <em>.babelrc</em>ï¼ˆè¯¦è§ <a href="https://github.com/rollup/rollup-plugin-babel" target="_blank" rel="noopener">rollup-plugin-babel</a>ï¼‰ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [ <span class="string">"es2015-rollup"</span> ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™æ‰§è¡Œ <code>rollup -c rollup.config.js</code> æˆ‘ä»¬èƒ½çœ‹åˆ°ç”Ÿæˆçš„ä»£ç é‡éå¸¸çš„å°‘ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">global, factory</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">typeof</span> exports === <span class="string">'object'</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">module</span> !== <span class="string">'undefined'</span> ? factory() :</span><br><span class="line">  <span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd ? define(factory) :</span><br><span class="line">  factory();</span><br><span class="line">&#125;(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="string">'use strict'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getDateObject</span>(<span class="params">datetime</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">format</span>(<span class="params">datetime, formatStr</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ... è¿™é‡Œä½¿ç”¨äº† getDateObject()</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// import &#123; format &#125; from 'silly-datetime';</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> getStr = <span class="function"><span class="keyword">function</span> <span class="title">getStr</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> format(<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> formatedDate = getStr();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'now is '</span> + formatedDate);</span><br><span class="line"></span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œå®Œå…¨æ²¡æœ‰å¤šä½™çš„ä»£ç ï¼Œè€Œä¸”ç”šè‡³æ¨¡å—éƒ½æ²¡æœ‰äº†ï¼Œçœ‹ä¸åˆ°ä»»ä½•çš„ <code>require</code> å®šä¹‰ï¼Œ<code>import</code> çš„å†…å®¹ç›´æ¥ inline åˆ°ä¸»æ–‡æ¡£ä¸­äº†ã€‚è¿™å›æˆ‘å°±å¥½å¥‡äº†ï¼Œå¦‚æœä¾èµ–å…³ç³»å†å¤æ‚ä¸€ç‚¹ï¼Œè¿˜ä¼šæ˜¯æ€æ ·å‘¢ï¼Ÿäºæ˜¯æˆ‘é€ äº†ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹çš„ <a href="https://github.com/csbun/tree-shaking-demo/tree/master/rollup" target="_blank" rel="noopener">ä¾‹å­</a>ï¼Œç»“æœè¿˜æ˜¯ <a href="https://github.com/csbun/tree-shaking-demo/blob/master/rollup/bundle.js" target="_blank" rel="noopener">inline åˆ°ä¸€èµ·äº†</a>ï¼</p><p>ä½†æ˜¯ï¼Œä¸Šé¢è¿™ä¸¤ä¸ªä¾‹å­éƒ½æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºå˜›æˆ‘éœ€è¦å°†æºç å¤åˆ¶å‡ºæ¥ï¼Ÿéš¾é“ä¸èƒ½ç›´æ¥ import ï¼Ÿ</p><blockquote><p>Yes, we can!</p></blockquote><p>æ–‡ç« æœ€ä¸Šé¢æˆ‘ä»¬çš„ç»„ä»¶å·²ç»å®šä¹‰äº† <code>&quot;jsnext:main&quot;: &quot;src/index.js&quot;</code>ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ rollup çš„è¿™ä¸ª <a href="https://github.com/rollup/rollup/wiki/jsnext:main" target="_blank" rel="noopener">è¯­æ³•ç³–</a> åï¼Œæˆ‘ä»¬å°±èƒ½ç›´æ¥å°†è¯¥ç»„ä»¶ import è¿›æ¥ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; format &#125; <span class="keyword">from</span> <span class="string">'silly-datetime'</span>;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·çš„ bundle æ–‡ä»¶ä¸ä¼šåŒ…å« npm package çš„æºç ï¼Œç´§æ€¥åªæ˜¯è½¬åŒ–æˆ <code>var format = require(&#39;silly-datetime);</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å®‰è£…ä¸€ä¸ªæ’ä»¶ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev rollup-plugin-npm</span><br></pre></td></tr></table></figure><p>åŠ åˆ°é…ç½®é‡Œ <em>rollup.config.js</em> é¢å»ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> babel <span class="keyword">from</span> <span class="string">'rollup-plugin-babel'</span>;</span><br><span class="line"><span class="keyword">import</span> npm <span class="keyword">from</span> <span class="string">'rollup-plugin-npm'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  entry: <span class="string">'index.js'</span>,</span><br><span class="line">  dest: <span class="string">'dest/bundle.rollup.js'</span>,</span><br><span class="line">  format: <span class="string">'umd'</span>,</span><br><span class="line">  plugins: [</span><br><span class="line">    babel(),</span><br><span class="line">    npm(&#123;</span><br><span class="line">      jsnext: <span class="literal">true</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å‡ºæ¥çš„ bundle æ–‡ä»¶å°±å’Œä¸Šé¢çš„æ•ˆæœä¸€æ ·äº†~</p><h3><span id="webpack-2">webpack 2</span></h3><p>ç»ˆäºåˆ°è¿™ä¸€æ­¥äº†ï¼Œå°±æ˜¯å› ä¸ºçœ‹äº† Axel çš„è¿™ç¯‡ <a href="http://www.2ality.com/2015/12/webpack-tree-shaking.html" target="_blank" rel="noopener">Tree-shaking with webpack 2 and Babel 6</a> æ‰æœ‰äº†è¿™ç¯‡æ–‡ç« ã€‚</p><p><a href="https://webpack.github.io/" target="_blank" rel="noopener">webpack</a> 2 ç›®å‰è¿˜æ˜¯ beta ç‰ˆæœ¬ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚æŒ‰ç…§åšå£«çš„è¯´æ³•ï¼Œå› ä¸º <a href="https://www.npmjs.com/package/babel-preset-es2015" target="_blank" rel="noopener">babel-preset-es2015</a> <a href="https://github.com/babel/babel/blob/7b369674163e40241ff41e63458c8d98298e942a/packages/babel-preset-es2015/package.json" target="_blank" rel="noopener">åŒ…å«</a> äº† <a href="https://www.npmjs.com/package/babel-plugin-transform-es2015-modules-commonjs" target="_blank" rel="noopener">babel-plugin-transform-es2015-modules-commonjs</a>ï¼Œè€Œ commonjs çš„æ‰“åŒ…æ–¹å¼æ³¨å®šä¸èƒ½å®ç°æˆ‘ä»¬çš„ Tree-shaking å¤§è®¡ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç›´æ¥ä½¿ç”¨ babel-preset-es2015ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ä»–æ‰€åŒ…å«çš„é™¤äº† commonjs ä»¥å¤–çš„å…¶ä»–å…¨éƒ¨ä¾èµ– pluginã€‚</p><p>è¿™å›è¦å®‰è£…çš„ä¸œè¥¿å°±å¤šäº†ï¼Œå¦‚æœæ˜¯ npm2 çš„å°±åœ¨ <em>package.json</em> é‡Œç›´æ¥æ·»åŠ  devDependences å¥½äº†ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"webpack"</span>: <span class="string">"^2.0.2-beta"</span>,</span><br><span class="line">    <span class="attr">"babel-loader"</span>: <span class="string">"^6.2.0"</span>,</span><br><span class="line">    <span class="attr">"babel-plugin-transform-es2015-template-literals"</span>: <span class="string">"^6.3.13"</span>,</span><br><span class="line">    <span class="attr">"babel-plugin-transform-es2015-literals"</span>: <span class="string">"^6.3.13"</span>,</span><br><span class="line">    <span class="attr">"babel-plugin-transform-es2015-function-name"</span>: <span class="string">"^6.3.13"</span>,</span><br><span class="line">    <span class="attr">"babel-plugin-transform-es2015-arrow-functions"</span>: <span class="string">"^6.3.13"</span>,</span><br><span class="line">    <span class="attr">"babel-plugin-transform-es2015-block-scoped-functions"</span>: <span class="string">"^6.3.13"</span>,</span><br><span class="line">    <span class="attr">"babel-plugin-transform-es2015-classes"</span>: <span class="string">"^6.3.13"</span>,</span><br><span class="line">    <span class="attr">"babel-plugin-transform-es2015-object-super"</span>: <span class="string">"^6.3.13"</span>,</span><br><span class="line">    <span class="attr">"babel-plugin-transform-es2015-shorthand-properties"</span>: <span class="string">"^6.3.13"</span>,</span><br><span class="line">    <span class="attr">"babel-plugin-transform-es2015-computed-properties"</span>: <span class="string">"^6.3.13"</span>,</span><br><span class="line">    <span class="attr">"babel-plugin-transform-es2015-for-of"</span>: <span class="string">"^6.3.13"</span>,</span><br><span class="line">    <span class="attr">"babel-plugin-transform-es2015-sticky-regex"</span>: <span class="string">"^6.3.13"</span>,</span><br><span class="line">    <span class="attr">"babel-plugin-transform-es2015-unicode-regex"</span>: <span class="string">"^6.3.13"</span>,</span><br><span class="line">    <span class="attr">"babel-plugin-check-es2015-constants"</span>: <span class="string">"^6.3.13"</span>,</span><br><span class="line">    <span class="attr">"babel-plugin-transform-es2015-spread"</span>: <span class="string">"^6.3.13"</span>,</span><br><span class="line">    <span class="attr">"babel-plugin-transform-es2015-parameters"</span>: <span class="string">"^6.3.13"</span>,</span><br><span class="line">    <span class="attr">"babel-plugin-transform-es2015-destructuring"</span>: <span class="string">"^6.3.13"</span>,</span><br><span class="line">    <span class="attr">"babel-plugin-transform-es2015-block-scoping"</span>: <span class="string">"^6.3.13"</span>,</span><br><span class="line">    <span class="attr">"babel-plugin-transform-es2015-typeof-symbol"</span>: <span class="string">"^6.3.13"</span>,</span><br><span class="line">    <span class="attr">"babel-plugin-transform-es2015-modules-commonjs"</span>: <span class="string">"^6.3.13"</span>,</span><br><span class="line">    <span class="attr">"babel-plugin-transform-regenerator"</span>: <span class="string">"^6.3.13"</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>npm i</code> æ—¶ä¼šè¯´ peer dependency å†²çªï¼Œè¯·å¿½ç•¥ä¹‹ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ç”¨ beta çš„ webpackã€‚ç„¶åå†™ä¸€ä¸‹æˆ‘æœ€ä¸å–œæ¬¢çš„ <em>webpack.config.js</em>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>); <span class="comment">// webpack 2</span></span><br><span class="line"><span class="keyword">var</span> dir = __dirname;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: path.join(dir, <span class="string">'index.js'</span>),</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.join(dir, <span class="string">'dest'</span>),</span><br><span class="line">        filename: <span class="string">'webpack.bundle.js'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        loaders: [&#123;</span><br><span class="line">            loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">            test: dir,</span><br><span class="line">            query: &#123;</span><br><span class="line">                <span class="comment">// presets: ['es2015'],</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// All of the plugins of babel-preset-es2015,</span></span><br><span class="line">                <span class="comment">// minus babel-plugin-transform-es2015-modules-commonjs</span></span><br><span class="line">                plugins: [</span><br><span class="line">                    <span class="string">'transform-es2015-template-literals'</span>,</span><br><span class="line">                    <span class="string">'transform-es2015-literals'</span>,</span><br><span class="line">                    <span class="string">'transform-es2015-function-name'</span>,</span><br><span class="line">                    <span class="string">'transform-es2015-arrow-functions'</span>,</span><br><span class="line">                    <span class="string">'transform-es2015-block-scoped-functions'</span>,</span><br><span class="line">                    <span class="string">'transform-es2015-classes'</span>,</span><br><span class="line">                    <span class="string">'transform-es2015-object-super'</span>,</span><br><span class="line">                    <span class="string">'transform-es2015-shorthand-properties'</span>,</span><br><span class="line">                    <span class="string">'transform-es2015-computed-properties'</span>,</span><br><span class="line">                    <span class="string">'transform-es2015-for-of'</span>,</span><br><span class="line">                    <span class="string">'transform-es2015-sticky-regex'</span>,</span><br><span class="line">                    <span class="string">'transform-es2015-unicode-regex'</span>,</span><br><span class="line">                    <span class="string">'check-es2015-constants'</span>,</span><br><span class="line">                    <span class="string">'transform-es2015-spread'</span>,</span><br><span class="line">                    <span class="string">'transform-es2015-parameters'</span>,</span><br><span class="line">                    <span class="string">'transform-es2015-destructuring'</span>,</span><br><span class="line">                    <span class="string">'transform-es2015-block-scoping'</span>,</span><br><span class="line">                    <span class="string">'transform-es2015-typeof-symbol'</span>,</span><br><span class="line">                    [<span class="string">'transform-regenerator'</span>, &#123; <span class="attr">async</span>: <span class="literal">false</span>, <span class="attr">asyncGenerators</span>: <span class="literal">false</span> &#125;],</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">// Avoid publishing files when compilation fails</span></span><br><span class="line">        <span class="keyword">new</span> webpack.NoErrorsPlugin()</span><br><span class="line">    ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å› ä¸º webpack ä¹Ÿä¸è®¤è¯† <code>jsnext:main</code>ï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦ç›´æ¥ import ES2015 çš„æºç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; format &#125; <span class="keyword">from</span> <span class="string">'./lib/silly-datetime.es2015.js'</span>;</span><br></pre></td></tr></table></figure><p>è¿è¡Œ <code>webpack</code> çœ‹çœ‹ <em>dest/webpack.bundle.js</em>ï¼ˆæˆ‘ç¨å¾®åˆ å‡å¹¶æ ¼å¼åŒ–äº†ä¸€ä¸‹ä»£ç ï¼‰ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/******/</span> (<span class="function"><span class="keyword">function</span>(<span class="params">modules</span>) </span>&#123; <span class="comment">// webpackBootstrap</span></span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line"><span class="comment">/******/</span> &#125;)([</span><br><span class="line"><span class="comment">/* 0 */</span></span><br><span class="line"><span class="comment">/***/</span> <span class="function"><span class="keyword">function</span>(<span class="params">module, exports, __webpack_require__</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* harmony export */</span> exports[<span class="string">"format"</span>] = format;</span><br><span class="line">  <span class="comment">/* unused harmony export locate */</span>;</span><br><span class="line">  <span class="comment">/* unused harmony export fromNow */</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getDateObject</span>(<span class="params">datetime</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">format</span>(<span class="params">datetime, formatStr</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ... è¿™é‡Œä½¿ç”¨äº† getDateObject()</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">locate</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">fromNow</span>(<span class="params">datetime</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> &#125;,</span><br><span class="line"><span class="comment">/* 1 */</span></span><br><span class="line"><span class="comment">/***/</span> <span class="function"><span class="keyword">function</span>(<span class="params">module, exports, __webpack_require__</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* harmony import */</span> <span class="keyword">var</span> __WEBPACK_IMPORTED_MODULE_0__lib_silly_datetime_es2015_js__ = __webpack_require__(<span class="number">0</span>);</span><br><span class="line"><span class="meta">  'use strict'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> getStr = <span class="function"><span class="keyword">function</span> <span class="title">getStr</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="comment">/* harmony import */</span> __WEBPACK_IMPORTED_MODULE_0__lib_silly_datetime_es2015_js__[<span class="string">"format"</span>](<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> formatedDate = getStr();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'now is '</span> + formatedDate);</span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> &#125;</span><br><span class="line"><span class="comment">/******/</span> ]);</span><br></pre></td></tr></table></figure><p>ä»ç¬¬ 7 è‡³ 9 è¡Œå¯ä»¥çœ‹åˆ°ï¼Œ <code>locate</code> å’Œ <code>fromNow</code> å¹¶æ²¡æœ‰è¢« exportï¼Œè™½ç„¶ä¸‹æ–¹è¿˜èƒ½çœ‹åˆ°è¿™ä¸¤ä¸ªæ–¹æ³•çš„å£°æ˜ï¼Œä½†æ˜¯åªè¦ç»è¿‡ UglifyJsï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•å¿…ç„¶ <a href="http://www.2ality.com/2015/12/webpack-tree-shaking.html#how_webpack_2_eliminates_unused_exports" target="_blank" rel="noopener">ä¼šè¢«æ¶ˆé™¤</a>ï¼š</p><blockquote><h5><span id="how-webpack-2-eliminates-unused-exports">How webpack 2 eliminates unused exports</span></h5><p>webpack 2, a new version that is in beta, eliminates unused exports in two steps:</p></blockquote><blockquote><ul><li>First, all ES6 module files are combined into a single bundle file. In that file, exports that were not imported anywhere are not exported, anymore.</li></ul></blockquote><blockquote><ul><li>Second, the bundle is minified, while eliminating dead code. Therefore, entities that are neither exported nor used inside their modules do not appear in the minified bundle. Without the first step, dead code elimination would never remove exports (registering an export keeps it alive).</li></ul></blockquote><p>å¯ä»¥è¿è¡Œ <code>webpack --optimize-minimize</code> çœ‹åˆ°æ‰§è¡Œæ•ˆæœï¼š</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">Hash:</span> b8357dea1720f84e6a76</span><br><span class="line"><span class="symbol">Version:</span> webpack <span class="number">2.0</span>.<span class="number">2</span>-beta</span><br><span class="line"><span class="symbol">Time:</span> <span class="number">9812</span>ms</span><br><span class="line">            Asset       Size  Chunks             Chunk Names</span><br><span class="line">webpack.bundle.js  <span class="number">935</span> bytes       <span class="number">0</span>  [emitted]  main</span><br><span class="line">    + <span class="number">2</span> hidden modules</span><br><span class="line"></span><br><span class="line">WARNING in webpack.bundle.js from UglifyJs</span><br><span class="line">Dropping unused function locate [./<span class="class"><span class="keyword">lib</span>/<span class="title">silly</span>-<span class="title">datetime</span>.<span class="title">es2015</span>.<span class="title">js</span>:84,16]</span></span><br><span class="line">Dropping unused function fromNow [./<span class="class"><span class="keyword">lib</span>/<span class="title">silly</span>-<span class="title">datetime</span>.<span class="title">es2015</span>.<span class="title">js</span>:120,16]</span></span><br><span class="line">Dropping unused variable LOCALE_EN [./<span class="class"><span class="keyword">lib</span>/<span class="title">silly</span>-<span class="title">datetime</span>.<span class="title">es2015</span>.<span class="title">js</span>:55,6]</span></span><br><span class="line">Dropping unused variable LOCALE_ZH_CN [./<span class="class"><span class="keyword">lib</span>/<span class="title">silly</span>-<span class="title">datetime</span>.<span class="title">es2015</span>.<span class="title">js</span>:66,6]</span></span><br><span class="line">Dropping unused variable _curentLocale [./<span class="class"><span class="keyword">lib</span>/<span class="title">silly</span>-<span class="title">datetime</span>.<span class="title">es2015</span>.<span class="title">js</span>:77,4]</span></span><br><span class="line">Dropping unused variable DET_STD [./<span class="class"><span class="keyword">lib</span>/<span class="title">silly</span>-<span class="title">datetime</span></span></span><br></pre></td></tr></table></figure><p>æ–‡ä»¶ä½“ç§¯ç”±åŸæ¥çš„ 5.68 kB ä¸‹é™åˆ°äº† 935 bytesï¼ˆå½“ç„¶è¿™é‡Œä¹Ÿæœ‰ UglifyJs çš„åŠŸåŠ³ï¼‰ã€‚</p><h3><span id="å†å›åˆ°-browserify">å†å›åˆ° Browserify</span></h3><p>å—ä¸Šé¢çš„å¯å‘ï¼Œåœ¨ Browserify é‡Œé¢ä¹Ÿèƒ½è¿™æ ·éº½ï¼Ÿæˆ‘æŠŠ <em>package.json</em> é…ç½®æˆè¿™æ ·ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"browserify"</span>: &#123;</span><br><span class="line">    <span class="attr">"transform"</span>: [</span><br><span class="line">      [ <span class="string">"babelify"</span>, &#123;</span><br><span class="line">        <span class="attr">"plugins"</span>: [</span><br><span class="line">          <span class="string">"transform-es2015-template-literals"</span>,</span><br><span class="line">          <span class="string">"transform-es2015-literals"</span>,</span><br><span class="line">          <span class="string">"transform-es2015-function-name"</span>,</span><br><span class="line">          <span class="string">"transform-es2015-arrow-functions"</span>,</span><br><span class="line">          <span class="string">"transform-es2015-block-scoped-functions"</span>,</span><br><span class="line">          <span class="string">"transform-es2015-classes"</span>,</span><br><span class="line">          <span class="string">"transform-es2015-object-super"</span>,</span><br><span class="line">          <span class="string">"transform-es2015-shorthand-properties"</span>,</span><br><span class="line">          <span class="string">"transform-es2015-computed-properties"</span>,</span><br><span class="line">          <span class="string">"transform-es2015-for-of"</span>,</span><br><span class="line">          <span class="string">"transform-es2015-sticky-regex"</span>,</span><br><span class="line">          <span class="string">"transform-es2015-unicode-regex"</span>,</span><br><span class="line">          <span class="string">"check-es2015-constants"</span>,</span><br><span class="line">          <span class="string">"transform-es2015-spread"</span>,</span><br><span class="line">          <span class="string">"transform-es2015-parameters"</span>,</span><br><span class="line">          <span class="string">"transform-es2015-destructuring"</span>,</span><br><span class="line">          <span class="string">"transform-es2015-block-scoping"</span>,</span><br><span class="line">          <span class="string">"transform-es2015-typeof-symbol"</span>,</span><br><span class="line">          [<span class="string">"transform-regenerator"</span>, &#123; <span class="attr">"async"</span>: <span class="literal">false</span>, <span class="attr">"asyncGenerators"</span>: <span class="literal">false</span> &#125;]</span><br><span class="line">        ]</span><br><span class="line">      &#125; ]</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†è¿è¡Œ <code>browserify index.js &gt; dest/bundle.browserify.js</code>ï¼Œç»“æœä»¥å¤±è´¥å‘Šç»ˆâ€¦<br>æ²¡æœ‰ commonjsï¼Œbrowserify åº”è¯¥è¿˜æ˜¯å¹²ä¸æ¥çš„ï¼Œå¦‚æœæœ‰æˆåŠŸçš„ç«¥é‹éº»çƒ¦å‘Šè¯‰æˆ‘æ€ä¹ˆç ´ã€‚</p><h2><span id="ç¢ç¢å¿µ">ç¢ç¢å¿µ</span></h2><p>æœ¬æ–‡ç‰¹åˆ«æ˜¯ webpack ä¸€èŠ‚ï¼Œå‚(chao)è€ƒ(xi) <a href="http://www.2ality.com/2015/12/webpack-tree-shaking.html" target="_blank" rel="noopener">Tree-shaking with webpack 2 and Babel 6</a>ã€‚ä¸Šé¢å¤§éƒ¨åˆ†æºç å¯ä»¥åœ¨æˆ‘çš„ GitHub ä¸Šé¢ <a href="https://github.com/csbun/tree-shaking-demo" target="_blank" rel="noopener">æ‰¾åˆ°</a>ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ğŸŒ²ğŸ… ~~ åœ£è¯å¿«ä¹ ~~ ğŸ‰âœ¨&lt;/p&gt;
&lt;h2 id=&quot;Rollup&quot;&gt;&lt;a href=&quot;#Rollup&quot; class=&quot;headerlink&quot; title=&quot;Rollup&quot;&gt;&lt;/a&gt;Rollup&lt;/h2&gt;&lt;p&gt;ä¹‹å‰çœ‹åˆ° &lt;a href=&quot;http://rollupjs.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;rollup.js&lt;/a&gt; å°±è§‰å¾—å¾ˆæœ‰è¶£ï¼Œåæ¥ç»ˆäºæœ‰ç©ºï¼ŒæŠŠæˆ‘çš„å°é¡¹ç›® &lt;a href=&quot;https://github.com/csbun/silly-datetime&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;silly-datetime&lt;/a&gt; æ”¹æˆäº† ES2015 ç„¶åç”¨ Rollup è½¬æˆ CommonJS å’Œ UMD ä¸¤ä¸ªç‰ˆæœ¬åˆ†åˆ«ç»™ &lt;a href=&quot;https://www.npmjs.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;npm&lt;/a&gt; å’Œ &lt;a href=&quot;http://bower.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Bower&lt;/a&gt; ä½¿ç”¨ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Browserify" scheme="http://csbun.github.io/blog/tags/Browserify/"/>
    
      <category term="webpack" scheme="http://csbun.github.io/blog/tags/webpack/"/>
    
      <category term="ES2015" scheme="http://csbun.github.io/blog/tags/ES2015/"/>
    
      <category term="Rollup" scheme="http://csbun.github.io/blog/tags/Rollup/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨ Android ä¸Šå¼€å§‹ä½¿ç”¨ React Native</title>
    <link href="http://csbun.github.io/blog/2015/12/starting-react-native-with-android/"/>
    <id>http://csbun.github.io/blog/2015/12/starting-react-native-with-android/</id>
    <published>2015-12-11T08:02:27.000Z</published>
    <updated>2020-11-03T11:52:46.312Z</updated>
    
    <content type="html"><![CDATA[<p>ä»¥ä¸‹å†…å®¹å¤§éƒ¨åˆ†éƒ½æ˜¯ <a href="http://facebook.github.io/react-native/" target="_blank" rel="noopener">React Native</a> å®˜ç½‘ä¸­ <a href="http://facebook.github.io/react-native/docs/getting-started.html" target="_blank" rel="noopener">Getting Started</a> å’Œ <a href="http://facebook.github.io/react-native/docs/android-setup.html" target="_blank" rel="noopener">Android Setup</a> çš„å†…å®¹ã€‚å½“ç„¶ä¹Ÿè®°å½•äº†æˆ‘åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚</p><a id="more"></a><h2><span id="å‡†å¤‡ç¯å¢ƒ">å‡†å¤‡ç¯å¢ƒ</span></h2><p>Mac ç”¨æˆ·åœ¨å·²ç»æœ‰ <a href="http://brew.sh/" target="_blank" rel="noopener">Homebrew</a> å’Œ <a href="https://nodejs.org/" target="_blank" rel="noopener">Node 4.x</a> çš„æƒ…å†µä¸‹ï¼Œä»¥ä¸‹éƒ½æ¯”è¾ƒç®€å•ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install -g react-native-cli</span><br><span class="line">brew install watchman</span><br><span class="line">brew install flow</span><br></pre></td></tr></table></figure><p>å¦‚æœå·²ç»å®‰è£…è¿‡ï¼Œå°±è¿è¡Œä¸‹é¢å‘½ä»¤æ›´æ–°ä¸€ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew update</span><br><span class="line">brew upgrade</span><br></pre></td></tr></table></figure><p>é™„ <a href="http://facebook.github.io/react-native/docs/linux-windows-support.html" target="_blank" rel="noopener">Linux and Windows Support</a>ã€‚</p><h2><span id="å…ˆè·‘ä¸ª-ios-çš„èµ·æ¥è¯•è¯•">å…ˆè·‘ä¸ª IOS çš„èµ·æ¥è¯•è¯•</span></h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">react-<span class="keyword">native</span> init AwesomeProject</span><br><span class="line">cd AwesomeProject</span><br></pre></td></tr></table></figure><p>åœ¨ Xcode ä¸­æ‰“å¼€ <code>ios/AwesomeProject.xcodeproj</code>ï¼ˆæˆ–ç›´æ¥è¿è¡Œè¿™ä¸ªæ–‡ä»¶ï¼‰ï¼Œç‚¹å‡»å·¦ä¸Šè§’çš„ <code>â–¶</code> å³ä¼šæ‰“å¼€ Xcode è‡ªå¸¦çš„ Simulatorï¼Œéå¸¸æ–¹ä¾¿ã€‚</p><p>åœ¨ Simulator ä¸­ä½¿ç”¨å¿«æ·é”® <code>cmd-d</code> æ‰“å¼€å¼€å‘èœå•ï¼Œé€‰æ‹© <code>Enable Live Relaod</code>ã€‚ç„¶åä¿®æ”¹ <code>index.ios.js</code>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">var</span> &#123;</span><br><span class="line">  AppRegistry,</span><br><span class="line">  StyleSheet,</span><br><span class="line">  Text,</span><br><span class="line">  View,</span><br><span class="line">  SwitchIOS, <span class="comment">// add</span></span><br><span class="line">&#125; = React;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> AwesomeProject = React.createClass(&#123;</span><br><span class="line">  render: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;View style=&#123;styles.container&#125;&gt;</span><br><span class="line">        &lt;Text style=&#123;styles.welcome&#125;&gt;</span><br><span class="line">          Welcome to React-Native!</span><br><span class="line">        &lt;<span class="regexp">/Text&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Text style=&#123;styles.instructions&#125;&gt;</span></span><br><span class="line"><span class="regexp">          To get started, edit index.ios.js</span></span><br><span class="line"><span class="regexp">        &lt;/</span>Text&gt;</span><br><span class="line">        &lt;Text style=&#123;styles.instructions&#125;&gt;</span><br><span class="line">          Press Cmd+R to reload,&#123;<span class="string">'\n'</span>&#125;</span><br><span class="line">          Cmd+D or shake <span class="keyword">for</span> dev menu</span><br><span class="line">        &lt;<span class="regexp">/Text&gt;</span></span><br><span class="line"><span class="regexp">        &#123;/</span>* add *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">        &lt;SwitchIOS /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/View&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br></pre></td></tr></table></figure><p>å°±èƒ½çœ‹åˆ° App çš„æ–‡å­—åº•éƒ¨å¢åŠ äº†ä¸€ä¸ª Switch æŒ‰é’®ã€‚æ›´å¤šçš„æ¥å£å¯ä»¥çœ‹ <a href="http://facebook.github.io/react-native/docs/switchios.html" target="_blank" rel="noopener">SwitchIOS</a>ï¼Œå½“ç„¶è¿˜æœ‰æ›´å¤šçš„ COMPONENTS å¯ä»¥ä½¿ç”¨ï¼Œè¿™é‡Œä¸å†æ·±ç©¶ã€‚</p><h2><span id="å®‰è£…-android-ç¯å¢ƒ">å®‰è£… Android ç¯å¢ƒ</span></h2><p>å®‰è£… <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener">JDK</a> çš„æ–‡ç« ä¸€å¤§å †ï¼Œå°±ä¸è¯´äº†ã€‚brew çœŸæ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œå®‰è£… <a href="https://developer.android.com/sdk/installing/index.html" target="_blank" rel="noopener">Android SDK</a> å’Œ <a href="https://docs.gradle.org/current/userguide/installation.html" target="_blank" rel="noopener">Gradle</a> ä¹Ÿå¾ˆç®€å•ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install android-sdk</span><br><span class="line">brew install gradle</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ·»åŠ ç¯å¢ƒå˜é‡è¿™ä¸ªè¿˜æ˜¯è¦åšçš„ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># brew å®‰è£…çš„ android-sdk å’Œ gradle</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">ANDROID_HOME</span>=/usr/local/opt/android-sdk</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">GRADLE_HOME</span>=/usr/local/opt/gradle</span><br></pre></td></tr></table></figure><h3><span id="ä¸‹è½½å·¥å…·">ä¸‹è½½å·¥å…·</span></h3><p>åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ <code>android</code> å³å¯æ‰“å¼€ Android SDK Managerï¼ŒæŒ‰ç…§ <a href="http://facebook.github.io/react-native/docs/android-setup.html#configure-your-sdk" target="_blank" rel="noopener">è¿™é‡Œçš„è¯´æ˜</a> å®‰è£…ï¼š</p><ul><li>Android SDK Build-tools version <strong>23.0.1</strong></li><li>Android 6.0 (API 23)</li><li>Android Support Repository</li></ul><p>æ³¨æ„ï¼ŒBuild-tools å¿…é¡»æ˜¯ <strong>23.0.1</strong>ï¼Œæˆ‘å°±æ˜¯æ²¡çœ‹æ¸…æ¥šé€‰äº† 24.x åé¢ä¸€ç›´æŠ¥é”™ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Build-tools</span> <span class="selector-tag">version</span> 23<span class="selector-class">.0</span><span class="selector-class">.1</span></span><br></pre></td></tr></table></figure><p>å½“ç„¶åç»­ react-native-cli å‡çº§å¯èƒ½ä¼šæ›´æ–° Build-toolsï¼Œåæ­£å¦‚æœçœ‹åˆ°è¿™ä¸ªé”™è¯¯ï¼Œå°±å®‰è£…å¯¹åº”çš„ Build-tools å°±å¥½å•¦ã€‚</p><h3><span id="è™šæ‹Ÿæœº">è™šæ‹Ÿæœº</span></h3><p>å› ä¸ºä¹‹å‰å¼€å‘éœ€è¦ï¼Œæˆ‘å·²ç»å®‰è£…äº† <a href="https://www.genymotion.com/" target="_blank" rel="noopener">Genymotion</a>ï¼Œå°±ç›´æ¥ä½¿ç”¨äº†ã€‚ä½†æ˜¯å®˜ç½‘ä¹Ÿæä¾›äº† <a href="http://facebook.github.io/react-native/docs/android-setup.html#alternative-create-a-stock-google-emulator" target="_blank" rel="noopener">Google emulator</a> çš„å¯åŠ¨æ–¹æ³•ï¼Œä¹Ÿä¸éº»çƒ¦ã€‚</p><h2><span id="å†è·‘ä¸ª-android-è™šæ‹Ÿæœºçš„è¯•è¯•">å†è·‘ä¸ª Android è™šæ‹Ÿæœºçš„è¯•è¯•</span></h2><h3><span id="è®¾å¤‡">è®¾å¤‡</span></h3><p>åœ¨ Genymotion åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ª deviceï¼Œåœ¨å‘½ä»¤è¡Œè¿è¡Œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb devices</span><br></pre></td></tr></table></figure><p>å°±èƒ½çœ‹åˆ°ç±»ä¼¼çš„ç»“æœï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">List</span> <span class="selector-tag">of</span> <span class="selector-tag">devices</span> <span class="selector-tag">attached</span></span><br><span class="line">192<span class="selector-class">.168</span><span class="selector-class">.56</span><span class="selector-class">.101</span><span class="selector-pseudo">:5555</span> <span class="selector-tag">device</span></span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€åˆ—è¡¨ç¤ºè®¾å¤‡ IDï¼Œç¬¬äºŒåˆ—è¡¨ç¤ºè®¾å¤‡çŠ¶æ€ï¼Œ<code>device</code> è¡¨æ˜å¯ä»¥è¿è¡Œã€‚</p><h3><span id="å¯åŠ¨">å¯åŠ¨</span></h3><p>å‘½ä»¤è¡Œè¿è¡Œ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">react-native run-android</span><br></pre></td></tr></table></figure><p>ç­‰ç­‰å°±èƒ½åœ¨è™šæ‹Ÿæœºä¸­çœ‹åˆ°å¯åŠ¨äº†å’Œåˆšåˆš IOS ä¸­ä¸€æ ·çš„åº”ç”¨ï¼Œç‚¹å‡» Genymotion player å³ä¾§çš„èœå•æŒ‰é’®ï¼ŒåŒæ ·èƒ½æ‰“å¼€å¼€å‘èœå•ã€‚</p><h2><span id="usb-è°ƒè¯•çœŸå®è®¾å¤‡">USB è°ƒè¯•çœŸå®è®¾å¤‡</span></h2><p>æ‰‹æœºå¼€å¯ <strong>USB è°ƒè¯•</strong> ä¹‹åï¼Œç”¨ USB é“¾æ¥ç”µè„‘ï¼Œå†æ¬¡è¿è¡Œ <code>adb devices</code> ä¸€èˆ¬æƒ…å†µä¸‹å°±èƒ½çœ‹åˆ°ç±»ä¼¼ï¼š</p><figure class="highlight capnproto"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">List</span> <span class="keyword">of</span> devices attached</span><br><span class="line"><span class="number">14</span>ed2fcc device</span><br></pre></td></tr></table></figure><p>è¯´æ˜ä½ çš„è®¾å¤‡å·²ç»é“¾æ¥ä¸Šäº†ï¼Œç„¶è€Œæˆ‘æ‰‹ä¸Šçš„é­…æ—å´æ€ä¹ˆä¹Ÿä¸å‡ºæ¥ã€‚æŸ¥ä¸€ä¸‹ <a href="http://bbs.flyme.cn/thread-18159-1-1.html" target="_blank" rel="noopener">èµ„æ–™</a> å¾ˆå¿«å°±æ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 0x2a45 &gt; .android/adb_usb.ini</span><br></pre></td></tr></table></figure><p>å¦å¤–å®˜ç½‘å£°æ˜ï¼š</p><blockquote><p>You must have <strong>only one device connected</strong>.</p></blockquote><p>æœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ªè®¾å¤‡é“¾æ¥ï¼Œè¿™æ—¶å€™å†è¿è¡Œ <code>react-native run-android</code> ç†è®ºä¸Šåº”è¯¥å°±èƒ½å’Œè™šæ‹Ÿæœºä¸€æ ·è·‘èµ·æ¥äº†å§ã€‚ç„¶è€ŒçœŸæ˜¯å›¾æ ·å›¾æ£®ç ´ï¼ŒBuilding åˆ° 97% åˆçˆ†ä¸€ä¸ªé—®é¢˜ï¼š</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">app:installDebug</span><br><span class="line">Installing APK <span class="string">'app-debug.apk'</span> <span class="keyword">on</span> <span class="string">'m2 - 5.1'</span></span><br><span class="line"><span class="number">03</span>:<span class="number">44</span>:<span class="number">04</span> E/<span class="number">2099056020</span>: Error <span class="keyword">while</span> uploading app-<span class="keyword">debug</span>.apk : Unknown failure</span><br><span class="line">Unable <span class="keyword">to</span> install /path/<span class="keyword">to</span>/AwesomeProject/android/app/build/outputs/apk/app-<span class="keyword">debug</span>.apk</span><br><span class="line"><span class="keyword">com</span>.android.ddmlib.InstallException: Unable <span class="keyword">to</span> upload some APKs</span><br><span class="line">  at <span class="keyword">com</span>.android.ddmlib.Device.installPackages(Device.jav<span class="variable">a:920</span>)</span><br><span class="line">  ...</span><br><span class="line">:app:installDebug FAILED</span><br><span class="line"></span><br><span class="line">FAILURE: Build failed with <span class="keyword">an</span> exception.</span><br><span class="line"></span><br><span class="line">* What went wron<span class="variable">g:</span></span><br><span class="line">Execution failed <span class="keyword">for</span> task <span class="string">':app:installDebug'</span>.</span><br><span class="line">&gt; <span class="keyword">com</span>.android.builder.testing.api.DeviceException: <span class="keyword">com</span>.android.ddmlib.InstallException: Unable <span class="keyword">to</span> upload some APKs</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><a href="https://github.com/facebook/react-native/issues/2720" target="_blank" rel="noopener">React Native çœŸæ˜¯è¢«å„è·¯å›½äº§æœºå‘åäº†</a>ï¼Œè¿˜å¥½ <a href="https://github.com/facebook/react-native/issues/2720#issuecomment-153648404" target="_blank" rel="noopener">æœ‰äººç»™å‡ºäº†è§£å†³æ–¹æ¡ˆ</a>ï¼šå°† <code>android/build.gradle</code> ç¬¬ 8 è¡Œçš„ç‰ˆæœ¬å·æ”¹æˆ <code>1.2.3</code> å³å¯</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Top-level build file where you can add configuration options common to all sub-projects/modules.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">buildscript</span> &#123;</span><br><span class="line">    <span class="keyword">repositories</span> &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">dependencies</span> &#123;</span><br><span class="line">        <span class="keyword">classpath</span> <span class="string">'com.android.tools.build:gradle:1.2.3'</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// <span class="doctag">NOTE:</span> Do not place your application dependencies here; they belong</span></span><br><span class="line">        <span class="comment">// in the individual module build.gradle files</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ¥ä¸€æ¬¡ï¼ŒApp è·³å‡ºæ¥äº†ï¼ç„¶è€Œï¼Œç„¶è€Œæ˜¯çº¢è‰²çš„é”™è¯¯ç•Œé¢å–ï¼Œæ— è®ºæ€ä¹ˆ RELOAD JS éƒ½æç¤º <code>Unable to download JS bundle</code>ã€‚è¿˜å¥½ <a href="https://github.com/facebook/react-native/issues/3130" target="_blank" rel="noopener">ä¸æ˜¯åªæœ‰æˆ‘ä¸€ä¸ªé‡åˆ°è¿™ä¸ªé—®é¢˜</a>ï¼ŒæŒ‰ç…§ <a href="https://github.com/facebook/react-native/issues/3130#issuecomment-145235797" target="_blank" rel="noopener">jinmatt çš„æ–¹æ³•</a> è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb reverse tcp:8081 tcp:8081</span><br><span class="line">react-native run-android</span><br></pre></td></tr></table></figure><p>è¿™å›çœŸçš„å¥½äº†ï¼å¤§å¹…åº¦æ‘‡ä¸€æ‘‡æ‰‹æœºï¼Œè°ƒå‡ºå¼€å‘è€…èœå•ï¼Œæˆ‘å–œæ¬¢ <code>Enable Live Relaod</code>ï¼Œç„¶åå°±æ¥æ”¹æ”¹ <code>index.android.js</code>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> &#123;</span><br><span class="line">  AppRegistry,</span><br><span class="line">  StyleSheet,</span><br><span class="line">  Text,</span><br><span class="line">  View,</span><br><span class="line">  SwitchAndroid, <span class="comment">// add</span></span><br><span class="line">&#125; = React;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> PointsMall = React.createClass(&#123;</span><br><span class="line">  render: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;View style=&#123;styles.container&#125;&gt;</span><br><span class="line">        &lt;Text style=&#123;styles.welcome&#125;&gt;</span><br><span class="line">          Welcome to React-Native!</span><br><span class="line">        &lt;<span class="regexp">/Text&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Text style=&#123;styles.instructions&#125;&gt;</span></span><br><span class="line"><span class="regexp">          To get started, edit index.android.js</span></span><br><span class="line"><span class="regexp">        &lt;/</span>Text&gt;</span><br><span class="line">        &lt;Text style=&#123;styles.instructions&#125;&gt;</span><br><span class="line">          Shake or press menu button <span class="keyword">for</span> dev menu</span><br><span class="line">        &lt;<span class="regexp">/Text&gt;</span></span><br><span class="line"><span class="regexp">        &#123;/</span>* add *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">        &lt;SwitchAndroid /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/View&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br></pre></td></tr></table></figure><p>è¿™å› App çš„æ–‡å­—åº•éƒ¨å¢åŠ äº†ä¸€ä¸ª Android çš„ Switch æŒ‰é’®ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»¥ä¸‹å†…å®¹å¤§éƒ¨åˆ†éƒ½æ˜¯ &lt;a href=&quot;http://facebook.github.io/react-native/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;React Native&lt;/a&gt; å®˜ç½‘ä¸­ &lt;a href=&quot;http://facebook.github.io/react-native/docs/getting-started.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Getting Started&lt;/a&gt; å’Œ &lt;a href=&quot;http://facebook.github.io/react-native/docs/android-setup.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Android Setup&lt;/a&gt; çš„å†…å®¹ã€‚å½“ç„¶ä¹Ÿè®°å½•äº†æˆ‘åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="React" scheme="http://csbun.github.io/blog/tags/React/"/>
    
      <category term="Android" scheme="http://csbun.github.io/blog/tags/Android/"/>
    
      <category term="Native" scheme="http://csbun.github.io/blog/tags/Native/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Karma åœ¨çœŸå®æµè§ˆå™¨ä¸Šæµ‹è¯•</title>
    <link href="http://csbun.github.io/blog/2015/11/karma/"/>
    <id>http://csbun.github.io/blog/2015/11/karma/</id>
    <published>2015-11-16T03:57:26.000Z</published>
    <updated>2020-11-03T11:52:46.312Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="å®‰è£…">å®‰è£…</span></h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g karma-cli</span><br></pre></td></tr></table></figure><h2><span id="åˆå§‹åŒ–">åˆå§‹åŒ–</span></h2><p>è¿›å…¥é¡¹ç›®è·Ÿç›®å½•ï¼Œåˆå§‹åŒ– karma é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i karma --<span class="built_in">save</span>-<span class="built_in">dev</span></span><br><span class="line">karma init</span><br></pre></td></tr></table></figure><a id="more"></a><p>é—®ä¸€<a href="https://karma-runner.github.io/0.13/intro/configuration.html" target="_blank" rel="noopener">å¤§å †é—®é¢˜</a>ï¼Œå›ç­”å°±æ˜¯äº†ã€‚<code>Tab</code> ä¸ºé€‰æ‹©ï¼Œ<code>Enter</code> ä¸ºç¡®è®¤ã€‚æœ¬æ–‡ä¸­ï¼š</p><ul><li>ä¸ä½¿ç”¨ RequireJS</li><li>frameworks é€‰å– Mocha</li><li>browsers é€‰æ‹© Chrome å’Œ PhantomJS</li></ul><h2><span id="mocha">Mocha</span></h2><p>å‡è®¾æˆ‘ä»¬çš„é¡¹ç›®å·²ç»æœ‰æºç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å’Œæµ‹è¯•ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test/index.js</span></span><br><span class="line"><span class="keyword">var</span> assert = <span class="built_in">require</span>(<span class="string">'assert'</span>);</span><br><span class="line"><span class="keyword">var</span> add = <span class="built_in">require</span>(<span class="string">'../add'</span>);</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'add'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    it(<span class="string">'add(1, 1) should be 2'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        assert.equal(<span class="number">2</span>, add(<span class="number">1</span>, <span class="number">1</span>));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿è¡Œ <code>mocha</code> æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚ä½†æ˜¯è¿è¡Œ <code>karma start</code> å°±å‚»é€¼äº†ï¼Œè¯´ä»–ä¸è®¤è¯† <code>require</code>ï¼ˆè¿™è´§é»˜è®¤æ˜¯é€‰æ‹© RequireJS çš„ï¼‰ã€‚<code>ctrl-c</code> é€€å‡ºã€‚</p><h2><span id="å®‰è£…æ’ä»¶">å®‰è£…æ’ä»¶</span></h2><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ç±»ä¼¼ webpack æˆ– Browserify ä¹‹ç±»çš„é—®é¢˜æ¥é¢„å¤„ç†æˆ‘ä»¬æºç ï¼Œè€Œè¿™äº›ï¼Œéƒ½æ˜¯èƒ½ç›´æ¥é€šè¿‡ <a href="https://www.npmjs.com/browse/keyword/karma-plugin" target="_blank" rel="noopener">æ’ä»¶</a> æå®šï¼</p><h3><span id="karma-webpack">karma-webpack</span></h3><p>é¦–å…ˆä½¿ç”¨ <a href="https://github.com/webpack/karma-webpack" target="_blank" rel="noopener">karma-webpack</a> è§£å†³ä¸Šé¢ <code>require</code> çš„é—®é¢˜ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i karma-webpack --save-dev</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ <code>karma.conf.js</code>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">  config.set(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// ä¸ºæµ‹è¯•æ–‡ä»¶æ·»åŠ  webpack preprocessors</span></span><br><span class="line">    preprocessors: &#123;</span><br><span class="line">      <span class="string">'test/*.js'</span>: [<span class="string">'webpack'</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ¬¡è¿è¡Œä¸€ä¸‹ <code>karma start</code> è¿è¡Œç»“æœå°†åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">`webpack: bundle is now VALID.`</span><br><span class="line">PhantomJS 1.9.8 (Mac OS X 0.0.0): Executed<span class="number"> 1 </span>of<span class="number"> 1 </span>SUCCESS (0.002 secs /<span class="number"> 0 </span>secs)</span><br><span class="line">Chrome 46.0.2490 (Mac OS X 10.10.5): Executed<span class="number"> 1 </span>of<span class="number"> 1 </span>SUCCESS (0.007 secs /<span class="number"> 0 </span>secs)</span><br><span class="line">TOTAL:<span class="number"> 2 </span>SUCCESS</span><br></pre></td></tr></table></figure><p>å—¯ï¼Œåœ¨ PhantomJS å’Œ Chrome ä¸‹é¢éƒ½è¿è¡ŒæˆåŠŸäº†ã€‚</p><h3><span id="karma-babel-preprocessor">karma-babel-preprocessor</span></h3><p>ä¸‹é¢æˆ‘ä»¬å†æŠŠ <code>test.js</code> æ”¹ä¸€ä¸‹ï¼Œå¼„ä¸¤ä¸ªç®€å•çš„ ES6 è¿›å»ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> assert = <span class="built_in">require</span>(<span class="string">'assert'</span>);</span><br><span class="line"><span class="keyword">const</span> add = <span class="built_in">require</span>(<span class="string">'../add'</span>);</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'add'</span>, () =&gt; &#123;</span><br><span class="line">    it(<span class="string">'add(1, 1) should be 2'</span>, () =&gt; &#123;</span><br><span class="line">        assert.equal(<span class="number">2</span>, add(<span class="number">1</span>, <span class="number">1</span>));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ç»“æœï¼ŒChrome (46.0) é€šè¿‡äº†ï¼Œä½† PhantomJS (1.9.8) æ²¡æœ‰ï¼Œäºæ˜¯å†æ¥ä¸€ä¸ªæ’ä»¶ <a href="https://github.com/babel/karma-babel-preprocessor" target="_blank" rel="noopener">karma-babel-preprocessor</a>ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i karma-babel-preprocessor babel-preset-es2015 --save-dev</span><br></pre></td></tr></table></figure><p>åŒæ ·åœ¨ <code>karma.conf.js</code> ä¸­æ·»åŠ  <code>preprocessors</code>ï¼Œä»¥åŠ babel <a href="https://github.com/babel/karma-babel-preprocessor#configuration" target="_blank" rel="noopener">é…ç½®</a>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    preprocessors: &#123;</span><br><span class="line">      <span class="string">'test/*.js'</span>: [<span class="string">'webpack'</span>, <span class="string">'babel'</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    babelPreprocessor: &#123;</span><br><span class="line">      options: &#123;</span><br><span class="line">        presets: [<span class="string">'es2015'</span>],</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>å¾ˆå¥½ï¼Œ<code>TOTAL: 2 SUCCESS</code>ï¼äºæ˜¯ï¼ŒæŠŠ <code>add.js</code> è¯¥æˆ ES6 ä¹Ÿæ²¡æœ‰é—®é¢˜äº†ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2><span id="å®æˆ˜">å®æˆ˜</span></h2><p>å†æ‹¿å‡ºä¸Šæ¬¡çš„ <a href="https://github.com/csbun/resize-image" target="_blank" rel="noopener">resize-image</a> æ¥æŠ˜è…¾ï¼Œä¾ç…§ä¸Šé¢çš„æ–¹æ³•å¤„ç†ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜éœ€è¦åŠ è½½ä¸€ä¸ªå›¾ç‰‡è¿›æ¥æ‰€ä»¥ç”¨åˆ°äº† <a href="https://github.com/webpack/url-loader" target="_blank" rel="noopener">url-loader</a>ï¼Œç›´æ¥é€šè¿‡ npm å®‰è£…å³å¯ä½¿ç”¨ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i url-loader --save-dev</span><br></pre></td></tr></table></figure><p>ç„¶åç¼–å†™æˆ‘ä»¬çš„æµ‹è¯•è„šæœ¬ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> resizeImage = <span class="built_in">require</span>(<span class="string">'../index'</span>);</span><br><span class="line"><span class="keyword">const</span> assert = <span class="built_in">require</span>(<span class="string">'assert'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ASSERT_SIZE = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'resize-image'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    it(<span class="string">'.resize: Resize any image to '</span> + ASSERT_SIZE, <span class="function"><span class="keyword">function</span> (<span class="params">done</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">        <span class="comment">// use [url-loader](https://github.com/webpack/url-loader)</span></span><br><span class="line">        img.src = <span class="built_in">require</span>(<span class="string">'url!../example/google.png'</span>);</span><br><span class="line">        img.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">let</span> base64 = resizeImage.resize(img, ASSERT_SIZE, ASSERT_SIZE, resizeImage.PNG);</span><br><span class="line">            <span class="keyword">let</span> resizedImg = <span class="keyword">new</span> Image();</span><br><span class="line">            resizedImg.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">let</span> minWH = <span class="built_in">Math</span>.min(resizedImg.width, resizedImg.height);</span><br><span class="line">                assert.equal(minWH, ASSERT_SIZE);</span><br><span class="line">                done();</span><br><span class="line">            &#125;;</span><br><span class="line">            resizedImg.src = base64;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>browsers é…ç½®äº†é™¤äº† IE ä»¥å¤–çš„å…¨éƒ¨æµè§ˆå™¨ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">browsers: [</span><br><span class="line">  <span class="string">'Chrome'</span>,</span><br><span class="line">  <span class="string">'ChromeCanary'</span>,</span><br><span class="line">  <span class="string">'Firefox'</span>,</span><br><span class="line">  <span class="string">'Safari'</span>,</span><br><span class="line">  <span class="string">'PhantomJS'</span>,</span><br><span class="line">  <span class="string">'Opera'</span></span><br><span class="line">],</span><br></pre></td></tr></table></figure><p>è¿è¡Œ <code>karma start --single-run</code> å…¨éƒ¨é€šè¿‡ã€‚</p><h3><span id="coverage">coverage</span></h3><p>ä¹‹å‰çš„ <a href="/2015/07/js-unit-test-coverage-ci/" title="åšå®¢">åšå®¢</a> ä¸­æåˆ°äº†ä½¿ç”¨ <a href="https://github.com/gotwarlost/istanbul" target="_blank" rel="noopener">istanbul</a> åšä»£ç è¦†ç›–ç‡ï¼Œè¿™é‡ŒåŒæ ·æœ‰è¿™æ ·çš„æ’ä»¶å®ç° <a href="https://github.com/karma-runner/karma-coverage" target="_blank" rel="noopener">karma-coverage</a>ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i karma karma-coverage --save-dev</span><br></pre></td></tr></table></figure><p>åœ¨ <code>karma.conf.js</code> ä¸­é…ç½®ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">preprocessors: &#123;</span><br><span class="line">  <span class="string">'test/index.js'</span>: [<span class="string">'webpack'</span>, <span class="string">'babel'</span>, <span class="string">'coverage'</span>]</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">reporters: [<span class="string">'progress'</span>, <span class="string">'coverage'</span>],</span><br><span class="line">coverageReporter: &#123;</span><br><span class="line">  type : <span class="string">'html'</span>,</span><br><span class="line">  dir : <span class="string">'coverage/'</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>å†æ¬¡è¿è¡Œ <code>karma start --single-run</code> å³å¯åœ¨ <code>coverage</code> æ–‡ä»¶å¤¹ä¸­çœ‹åˆ°è¦†ç›–ç‡æŠ¥å‘Šã€‚ä½†æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æŠ¥å‘Šé‡Œçš„è¦†ç›–ç‡å¾ˆä½ï¼Œå› ä¸º webpack æ‰“åŒ…å¥½åçš„æ–‡ä»¶åŒ…å«äº†å¾ˆå¤šæˆ‘ä»¬ä¸éœ€è¦æ£€æŸ¥çš„å†…å®¹ï¼ˆwebpackï¼Œtest ç­‰ï¼‰ï¼Œäºæ˜¯æˆ‘ä»¬éœ€è¦ <a href="https://www.npmjs.com/package/istanbul-instrumenter-loader" target="_blank" rel="noopener">istanbul-instrumenter-loader</a>ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i istanbul-instrumenter-loader --save-dev</span><br></pre></td></tr></table></figure><p>å†ä¿®æ”¹ä¸€ä¸‹ <code>karma.conf.js</code>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">preprocessors: &#123;</span><br><span class="line">  <span class="string">'test/index.js'</span>: [<span class="string">'webpack'</span>, <span class="string">'babel'</span>] <span class="comment">// è¿™é‡Œä¸éœ€è¦è¯´æ˜ coverage</span></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">reporters: [<span class="string">'progress'</span>, <span class="string">'coverage'</span>],</span><br><span class="line">coverageReporter: &#123;</span><br><span class="line">  type : <span class="string">'html'</span>,</span><br><span class="line">  dir : <span class="string">'coverage/'</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// æ·»åŠ ä»¥ä¸‹éƒ¨åˆ†</span></span><br><span class="line">webpack: &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    postLoaders: [&#123;</span><br><span class="line">      test: <span class="regexp">/index\.js$/</span>, <span class="comment">// æºæ–‡ä»¶</span></span><br><span class="line">      exclude: <span class="regexp">/(test|node_modules|bower_components)\//</span>, <span class="comment">// æ’é™¤çš„æ–‡ä»¶</span></span><br><span class="line">      loader: <span class="string">'istanbul-instrumenter'</span></span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>å†æ¬¡è¿è¡Œ <code>karma start --single-run</code> å°±èƒ½çœ‹åˆ°æŠ¥å‘Šé‡Œåªå‰©ä¸‹æˆ‘ä»¬çš„ <code>index.js</code> äº†ã€‚</p><h3><span id="travis-ci-amp-coveralls">Travis CI &amp; COVERALLS</span></h3><p><a href="https://travis-ci.org/" target="_blank" rel="noopener">Travis CI</a> æä¾›äº†ä¸€ä¸ª <a href="http://docs.travis-ci.com/user/firefox/" target="_blank" rel="noopener">Firefox çš„è¿è¡Œç¯å¢ƒ</a>ï¼Œäºæ˜¯æˆ‘ä»¬è¦é…ç½®ä¸€ä¸‹ <code>.travis.yml</code>ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">language:</span> <span class="string">node_js</span></span><br><span class="line"><span class="attr">node_js:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">"4.2"</span></span><br><span class="line"><span class="attr">before_script:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">export</span> <span class="string">DISPLAY=:99.0</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">sh</span> <span class="bullet">-e</span> <span class="string">/etc/init.d/xvfb</span> <span class="string">start</span></span><br></pre></td></tr></table></figure><p>åŒæ—¶æˆ‘ä»¬å°† coverage æŠ¥å‘Šç±»å‹æ”¹ä¸º lcovï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">coverageReporter: &#123;</span><br><span class="line">  type : <span class="string">'lcov'</span>,</span><br><span class="line">  dir : <span class="string">'coverage/'</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>æ–¹ä¾¿æˆ‘ä»¬ä¸Šä¼ åˆ° <a href="https://coveralls.io/" target="_blank" rel="noopener">COVERALLS</a>ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i coveralls --save-dev</span><br></pre></td></tr></table></figure><p><code>package.json</code> ä¹Ÿè¦åŠ å…¥ test è„šæœ¬</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"resize-image"</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"./node_modules/karma/bin/karma start --browsers Firefox --single-run &amp;&amp; find coverage -name lcov.info -print0 | xargs -0 cat | ./node_modules/coveralls/bin/coveralls.js &amp;&amp; rm -rf ./coverage"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æäº¤ä»£ç ï¼Œè™½ç„¶ <a href="https://travis-ci.org/" target="_blank" rel="noopener">Travis CI</a> ä¸Šçš„è¾“å‡ºæç¤ºæ˜¯ï¼š</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Firefox <span class="number">31.0</span><span class="number">.0</span> (Linux <span class="number">0.0</span><span class="number">.0</span>): Executed <span class="number">0</span> <span class="keyword">of</span> <span class="number">1</span> SUCCESS (<span class="number">0</span> <span class="built_in">secs</span> / <span class="number">0</span> <span class="built_in">secs</span>)</span><br><span class="line"> SUCCESS (<span class="number">0</span> <span class="built_in">secs</span> / <span class="number">0.026</span> <span class="built_in">secs</span>)</span><br><span class="line"> SUCCESS (<span class="number">0.052</span> <span class="built_in">secs</span> / <span class="number">0.026</span> <span class="built_in">secs</span>)</span><br></pre></td></tr></table></figure><p>ä½†å®é™…ä¸Šå·²ç»æˆåŠŸäº†ï¼Œ<a href="https://coveralls.io/" target="_blank" rel="noopener">COVERALLS</a> ä¸Šå·²ç»èƒ½çœ‹åˆ°è¦†ç›–ç‡æŠ¥å‘Šï¼</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å®‰è£…&quot;&gt;&lt;a href=&quot;#å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…&quot;&gt;&lt;/a&gt;å®‰è£…&lt;/h2&gt;&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;npm i -g karma-cli&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;åˆå§‹åŒ–&quot;&gt;&lt;a href=&quot;#åˆå§‹åŒ–&quot; class=&quot;headerlink&quot; title=&quot;åˆå§‹åŒ–&quot;&gt;&lt;/a&gt;åˆå§‹åŒ–&lt;/h2&gt;&lt;p&gt;è¿›å…¥é¡¹ç›®è·Ÿç›®å½•ï¼Œåˆå§‹åŒ– karma é…ç½®æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight q&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;npm i karma --&lt;span class=&quot;built_in&quot;&gt;save&lt;/span&gt;-&lt;span class=&quot;built_in&quot;&gt;dev&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;karma init&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="test" scheme="http://csbun.github.io/blog/tags/test/"/>
    
      <category term="ci" scheme="http://csbun.github.io/blog/tags/ci/"/>
    
      <category term="Karma" scheme="http://csbun.github.io/blog/tags/Karma/"/>
    
      <category term="webpack" scheme="http://csbun.github.io/blog/tags/webpack/"/>
    
  </entry>
  
  <entry>
    <title>å°æ¹¾å¥½å¥½å‘·</title>
    <link href="http://csbun.github.io/blog/2015/11/eating-around-taiwan/"/>
    <id>http://csbun.github.io/blog/2015/11/eating-around-taiwan/</id>
    <published>2015-11-14T12:20:10.000Z</published>
    <updated>2020-11-03T11:52:46.280Z</updated>
    
    <content type="html"><![CDATA[<p>è§‰å¾—å†ä¸åŠ¨æ‰‹å†™ï¼Œè¿™ä¸ªæ¸¸è®°å°±çœŸçš„æ— æ³•é¢ä¸–äº†ã€‚è¦ä¸æ˜¯æœ€è¿‘æŠŠåšå®¢ä» <a href="http://jekyllrb.com/" target="_blank" rel="noopener">jekyll</a> è¿ç§»åˆ° <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>ï¼Œéƒ½å¯èƒ½æ²¡æœ‰æƒ³ç€è¦å†™ã€‚æ‹–å»¶ç—‡ç»ç—‡æ‚£è€…å¿«æ²¡å¾—æ•‘äº†ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªç³»åˆ—æ–‡ç« ï¼Œè€Œè¿™å½“å‰ä¸€ç¯‡ï¼ˆå¸Œæœ›ä¸æ˜¯æœ€åä¸€ç¯‡ï¼‰ï¼Œåº”è¯¥æ˜¯æˆ‘è§‰å¾—æœ€é‡è¦çš„ â€œ<strong>åƒ</strong>â€ã€‚æœ¬æ–‡å›¾å¤šå­—å°‘ï¼Œè™½ç„¶æˆ‘å·²ç»å‹ç¼©è¿‡ï¼Œä½†è¿˜è¯·è‡ªå¤‡æµé‡ã€‚</p><a id="more"></a><h2><span id="å°æ¹¾é­¯è‚‰é¥­">å°æ¹¾é­¯è‚‰é¥­</span></h2><p>æ²¡é”™ï¼Œå°±æ˜¯è¿™ä¸ªé­¯ï¼Œä¸æ˜¯é‚£ä¸ªå¤ã€‚ä¸ºä»€ä¹ˆä¸Šæ¥å°±è¯´è¿™ä¸ªï¼Œå› ä¸ºè²Œä¼¼å¤§é™†ä¹Ÿç»å¸¸çœ‹åˆ°å–ï¼</p><p>å°æ¹¾æœ‰å„ç§å„æ ·çš„é­¯è‚‰é¥­ï¼Œè‚‰ç‡¥é¥­ï¼ŒçŒªæ²¹æé¥­ï¼ˆè¯·å…è®¸æˆ‘å·æ‡’ç»Ÿç§°ä¸ºé­¯è‚‰é¥­ï¼‰ã€‚å’Œå¤§é™†è§åˆ°çš„åŒåä½œå“ä¸åŒï¼Œå®å²›çš„é­¯è‚‰é¥­é€šå¸¸éƒ½åªæ˜¯æ™®é€šå®¶ç”¨é¥­ç¢—å¤§å°ï¼Œç”šè‡³æ›´å°ï¼Œè€Œä¸”ï¼Œæ²¡æœ‰é‚£åŠä¸ªå¤é¸¡è›‹ï¼è§‰å¾—æ¯”è¾ƒå¥½åƒçš„æ˜¯å°åŒ—çš„ <strong>é‡‘å³°é­¯è‚‰é¥­</strong>ï¼š</p><img src="/2015/11/eating-around-taiwan/DSC04479.jpg" title="å°åŒ— é‡‘å³°é­¯è‚‰é¥­"><p>å’Œ <strong>å¤§éšé…’é£Ÿ</strong> çš„çŒªæ²¹æé¥­ï¼š</p><img src="/2015/11/eating-around-taiwan/DSC03203.jpg" title="å°åŒ— å¤§éšé…’é£Ÿ çŒªæ²¹æé¥­"><p>ç„¶è€Œï¼Œä½œä¸ºä¸€ä¸ªæ½®æ±•äººï¼Œåƒäº†å‡ åå¹´çš„çŒªè„šé¥­å’Œå„ç§å¤å‘³ï¼Œè¿˜æ˜¯è§‰å¾—è€å¦ˆåšçš„ç•¥èƒœä¸€ç­¹ã€‚</p><h2><span id="ç‰›è‚‰é¢ç‰›è‚‰æ±¤">ç‰›è‚‰é¢ç‰›è‚‰æ±¤</span></h2><p>çœŸæ­£æƒŠè‰³çš„ç¾å‘³ï¼Œå½“å±å°å—çš„ <strong>ä¸Šå¥½åƒç‰›è‚‰é¢</strong> ï¼ˆç°åœ¨æ”¹åå« é¸¿æºé‡‘å¥½åƒç‰›è‚‰é¢ï¼‰ï¼Œå½“æ—¶åªç‚¹äº†ä¸€ä¸ªè¯è†³ç‰›è‚‰é¢ï¼Œåªè¦å–ä¸€å£é‚£ä¸ªæ±¤ï¼Œå°±èƒ½è®©ä½ æ¬²ç½¢ä¸èƒ½ã€‚å¦‚æœä¸æ˜¯ç¦»ä½çš„åœ°æ–¹æœ‰ç‚¹è¿œï¼Œä¸€å®šä¼šå†å»åƒä¸€ä¸ªåŸå‘³ç‰›è‚‰é¢ï¼</p><img src="/2015/11/eating-around-taiwan/DSC04220.jpg" title="å°å— ä¸Šå¥½åƒç‰›è‚‰é¢"><p>è¯´åˆ°å°å—ç‰›è‚‰ï¼Œè¿˜æœ‰ä¸€ä¸ªä¸èƒ½ä¸æçš„æ˜¯ â€œå°å—äººçš„æ—©é¤â€ï¼Œç‰›è‚‰æ±¤ã€‚<strong>è¥¿ç½—æ®¿ç‰›è‚‰æ±¤</strong> è¿™æ˜¯ä»…æœ‰çš„ä¸¤å®¶æˆ‘ä»¬å»åƒäº†ä¸¤æ¬¡çš„åº—ä¹‹ä¸€ï¼Œç‰›è‚‰éå¸¸æ–°é²œç»†å«©ï¼Œé…ä¸Šç§˜åˆ¶è¾£æ¤’é…±ï¼ˆè¦è‡ªå·±é—®è€æ¿æ‹¿ï¼Œè€æ¿è§æˆ‘ä»¬ç¬¬ä¸€æ¬¡æ¥åƒï¼Œè¿˜æ…¢æ…¢ç»™æˆ‘ä»¬è®²è§£åƒæ³•ï¼Œéå¸¸å‹å¥½ï¼‰ï¼Œå®Œç¾ï¼æ¯å¤©é™é‡ä¾›åº”ï¼Œè¿˜é€ä¸€æ™šè‚‰ç‡¥é¥­å“¦~</p><img src="/2015/11/eating-around-taiwan/DSC04032.jpg" title="å°å— è¥¿ç½—æ®¿ç‰›è‚‰æ±¤"><p>å½“ç„¶è¿˜æœ‰å°åŒ—çš„ <strong>è€å¼ ç‰›è‚‰é¢</strong>ï¼Œæ¯å—ç‰›è‚‰éƒ½å¤Ÿåšä¸”å¸¦ç­‹ï¼Œç®¡é¥±ï¼</p><img src="/2015/11/eating-around-taiwan/DSC04486.jpg" title="å°åŒ— è€å¼ ç‰›è‚‰é¢"><p>è¯´åˆ°æˆ‘éƒ½é¥¿äº†ï¼Œå®¹æˆ‘åƒæ¡é¦™è•‰å‹å‹æƒŠâ€¦</p><h2><span id="ä¾¿å½“é¥­åŒ…">ä¾¿å½“é¥­åŒ…</span></h2><p>åœ¨å¤§é™†ï¼Œæˆ‘æ¯å¤©åƒå¿«é¤å¤–å–ä¼šå…½æ•é¸Ÿã€‚ä½†è¦æ˜¯æˆ‘ä½å°æ¹¾ï¼Œä¼°è®¡æˆ‘å¯ä»¥å¤©å¤©åƒä¾¿å½“ï¼çœŸå®ä¾¿å®œåˆå¥½åƒï¼å…ˆæ˜¯èŠ±è²çš„ <strong>çƒ­æµ·æ’éª¨ä¾¿å½“</strong> </p><img src="/2015/11/eating-around-taiwan/DSC03604.jpg" title="èŠ±è² çƒ­æµ·æ’éª¨ä¾¿å½“"><p>å†æ˜¯æ± ä¸Šï¼Œè¿™ä¸ªç››äº§å¤§ç±³çš„åœ°æ–¹ï¼Œæ‰“åŒ…ä¸¤ä¸ª <strong>æ± ä¸Šé¥­åŒ…åšç‰©é¦†</strong> çš„ä¾¿å½“åˆ°ä¼¯æœ—å¤§é“ä¸Šè¾¹çœ‹é£æ™¯è¾¹åƒï¼Œä¹Ÿæ˜¯ç›¸å½“äº«å—</p><img src="/2015/11/eating-around-taiwan/DSC03651.jpg" title="å°ä¸œ æ± ä¸Šé¥­åŒ…åšç‰©é¦†"><p>åœ¨ç«è½¦ä¸Šï¼Œæˆ–è€…å» 7 ä»”ã€å…¨å®¶ä¹°ä¸€ä¸ªä¹Ÿå¾ˆå¥½åƒå–</p><img src="/2015/11/eating-around-taiwan/P51001-140312.jpg" title="å°é“ä¾¿å½“"><h2><span id="æœæ±å†°å“">æœæ±å†°å“</span></h2><p>å®å²›ç››äº§æ°´æœï¼Œè¿™æ˜¯å¤§å®¶éƒ½çŸ¥é“çš„ï¼Œè€Œæ­¤è¡Œæœ€å¯æƒœçš„å°±æ˜¯æ²¡æœ‰æŠŠæ°´æœåƒä¸ªå¤Ÿã€‚æœæ±å€’æ˜¯å–äº†ä¸å°‘ï¼Œ<strong>æ´¥èŠ³å†°åŸ</strong>ï¼Œè¿™æ˜¯å°ä¸œè¿™åº§çŸ­æš‚åœç•™çš„åŸå¸‚ç»™æˆ‘ç•™ä¸‹çš„æœ€å¥½å°è±¡ï¼Œæœ¨ç“œç‰›å¥¶å’Œç¥å¥‡çš„å’¸å†°æ£’ï¼š</p><img src="/2015/11/eating-around-taiwan/DSC03785.jpg" title="å°ä¸œ æ´¥èŠ³å†°åŸ æœ¨ç“œç‰›å¥¶å’Œå’¸å†°æ£’"><p>èŠ±è²æœ‰ä¸¤å®¶æŒ¨åœ¨ä¸€èµ·çš„åŒ…å¿ƒç²‰åœ†åº—ï¼Œ<strong>æ­£å®—åŒ…å¿ƒç²‰åœ†</strong> å’Œ <strong>äº”éœ¸ç„¦ç³–åŒ…å¿ƒç²‰åœ†</strong>ã€‚æ²¡é”™ï¼Œè¿™è´§æ˜¯å†°å“ï¼éƒ½æœ‰ä¸€å¤§ç¢—å†°åŠ ç‚¼å¥¶ï¼Œå‰è€…ç²‰åœ†æ˜¯å•ç‹¬å°ç¢Ÿæ”¾ï¼Œèˆ€ä¸€å‹ºå†°ä¸€èµ·åƒï¼›åè€…åˆ™ç›´æ¥å°†å†°ç›–åœ¨ç²‰åœ†ç»¿è±†æ²™ä¸Šï¼ŒæŒ–ç€åƒï¼ˆé¢±é£å¤©å»æ‰“åŒ…ä¸€ä¸ªè·¯ä¸Šåƒäº†ï¼Œæ²¡æœ‰æ‹ç…§ï¼‰ã€‚</p><img src="/2015/11/eating-around-taiwan/DSC03553.jpg" title="èŠ±è² æ­£å®—åŒ…å¿ƒç²‰åœ†"><p>å½“ç„¶ä¹Ÿå°‘ä¸äº†å°å—è€å­—å·ï¼Œ<strong>æ³°æˆæ°´æœåº—</strong>ï¼Œ<strong>è‰è‰æ°´æœåº—</strong> éƒ½æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚ï¼ˆè™½ç„¶æ°‘å®¿è€æ¿è¯´ä»–ä»¬å»é‚£é‡Œéƒ½æ˜¯åƒå†°ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯å–œæ¬¢æ–°é²œæ°´æœå’Œé²œæ¦¨æœæ±å–ï¼‰</p><img src="/2015/11/eating-around-taiwan/DSC04027.jpg" title="å°å— æ³°æˆæ°´æœåº— æœ¨ç“œç‰›å¥¶"><p>é¡ºå¸¦æä¸€ä¸‹ï¼Œå°å—çš„ <strong>çŸ³ç²¾è‡¼</strong>ï¼ŒåŠ¨ä¸åŠ¨å°±æ˜¯è¿‘ç™¾å¹´çš„è€åº—ã€‚<strong>å…«å®å†°</strong> å°±æ˜¯è¿™å…¶ä¸­çš„ä¸€å®¶ï¼Œå“ç§ç¹å¤šï¼Œåˆ†é‡åè¶³ï¼Œ2 ä¸ªäººåƒä¸€ä»½ç»å¯¹æ²¡é—®é¢˜ï¼Œè¿˜èƒ½å…è´¹åŠ å†°å“¦ï¼</p><img src="/2015/11/eating-around-taiwan/DSC04026.jpg" title="å°å— çŸ³ç²¾è‡¼å…«å®å†°"><h2><span id="çº¢èŒ¶">çº¢èŒ¶</span></h2><p>ä¸å’Œæœæ±ä»¬æ”¾åœ¨ä¸€èµ·ï¼Œæ˜¯å› ä¸ºå°æ¹¾çš„çº¢èŒ¶å®åœ¨å¤ªå¥½å–äº†ã€‚è¿™é‡Œæœ‰ä¸‰å®¶ç‰¹åˆ«æ¨èï¼š</p><p><strong>èŠ±è²åº™å£çº¢èŒ¶</strong>ï¼Œ24å°æ—¶è¥ä¸šçš„50å¹´è€åº—ï¼Œçœ‹è¿™çš„é’¢ç®¡å¥³éƒçš„æ¶åŠ¿ï¼Œç®¡é‡Œé¢æ˜¯æ»¡æ»¡çš„çº¢èŒ¶ï¼Œç»æ— ä»…æœ‰ï¼</p><img src="/2015/11/eating-around-taiwan/miaokouredtea.jpg" title="èŠ±è² åº™å£çº¢èŒ¶"><p>èŠ±è²è¿˜æœ‰ä¸€å®¶å–é¾™å‡¤è…¿çš„ï¼Œåº—å <strong>è‚‰ç¾¹å¼ </strong>ã€‚é‚£é‡Œçš„è‡ªåˆ¶çº¢èŒ¶ä¹Ÿå¾ˆå¥½å–ï¼</p><img src="/2015/11/eating-around-taiwan/DSC03613.jpg" title="èŠ±è² è‚‰ç¾¹å¼  è‡ªåˆ¶çº¢èŒ¶"><p>æœ€åï¼Œå°ä¸­å”¯ä¸€æ¨èï¼Œç¬¬äºŒå¸‚åœºçš„ è€ Like <strong>è€èµ–çº¢èŒ¶</strong>ã€‚æ²¡æœ‰ç‹¬ç…§ï¼Œç»™åªæœ‰ä¸€å¼ ä»–å’Œ <strong>å±±æ²³å¤è‚‰é¥­</strong> çš„åˆç…§ï¼š</p><img src="/2015/11/eating-around-taiwan/DSC04235.jpg" title="å°ä¸­ è€èµ–çº¢èŒ¶"><h2><span id="è¿˜æœ‰å¾ˆå¤šå¥½åƒçš„">è¿˜æœ‰å¾ˆå¤šå¥½åƒçš„</span></h2><p>ä¸Šé¢æåˆ°ä»…æœ‰çš„ä¸¤å®¶åº—æ˜¯æˆ‘ä»¬å»åƒäº†ä¸¤æ¬¡çš„ï¼Œå¦å¤–ä¸€å®¶ä¾æ—§æ˜¯åœ¨å°å—ï¼š<strong>ä¿å“¥é»‘è¼ª</strong>ï¼Œé»‘è½®å°±æ˜¯éº»è¾£çƒ«ï¼Œç„¶è€Œè¿™é‡Œæœ€å¥½åƒçš„ä¸æ˜¯é»‘è½®ï¼Œè€Œæ˜¯ç¥å¥‡çš„ <strong>ç‚’æ³¡é¢</strong>ï¼Œæˆ‘è¿˜æ˜¯ç¬¬ä¸€æ¬¡é‚£ä¹ˆå–œæ¬¢åƒæ³¡é¢ï¼</p><img src="/2015/11/eating-around-taiwan/DSC04093.jpg" title="å°å— ä¿å“¥é»‘è¼ªçš„ç‚’æ³¡é¢"><p>å°å—ä¸å¯èƒ½åªæœ‰è¿™ä¹ˆå°‘åƒçš„ï¼Œ<strong>ä¸è€åº„</strong> çš„è¯è†³é¦™è‚ ï¼Œç»å¯¹åˆæ˜¯ä¸€ä¸ªç¥å¥‡ä¹‹ä½œã€‚ä¸è¦çœ‹å¤–è¡¨é‚£ä¹ˆä¸‘ï¼Œä½†æ¯ä¸€å£éƒ½æ˜¯æ‰å®çš„é»‘çŒªè‚‰å’Œä¸°æ»¡çš„è¯è†³å‘³ï¼Œå–œæ¬¢é—»ä¸­è¯å‘³çš„æˆ‘è¡¨ç¤ºå¹²å¾—æ¼‚äº®ï¼</p><img src="/2015/11/eating-around-taiwan/DSC04194.jpg" title="å°å— ä¸è€åº„ è¯è†³é¦™è‚ "><p>ç‘èŠ³ç«è½¦ç«™æ­£é—¨å‡ºå»ä¸€ç›´å‘å‰èµ°ï¼Œæœ‰ä¸ªç¾é£Ÿè¡—ï¼Œè¿›é—¨å°±æœ‰ä¸€å®¶ <strong>æè®°èšµä»”ç…</strong>ï¼Œæ˜¯æˆ‘å†å°æ¹¾åƒè¿‡çš„æœ€å¥½åƒçš„èšµä»”ç…ï¼Œæ²¡æœ‰ä¹‹ä¸€ã€‚åˆæ˜¯è¯è†³é…±æ±ï¼Œèšµä»”æ˜¯åšæŒæ¯å¤©ä»å˜‰ä¹‰ä¸œçŸ³æ–°é²œè¿è¿‡æ¥ã€‚</p><img src="/2015/11/eating-around-taiwan/DSC03496.jpg" title="ç‘èŠ³ æè®°èšµä»”ç…"><p><strong>å®œå…°é¦™è‘±ç‰›è‚‰å·</strong>ï¼Œè¿™ä¸ªæ˜¯å†èŠ±è²è‡ªå¼ºå¤œå¸‚çš„ä¸€ä¸ªè§’è½çœ‹åˆ°çš„ä¸€ä¸ªæµåŠ¨æ‘Šä½ï¼Œç„¶è€Œæ’é˜Ÿçš„äººç‚’é¸¡å¤šï¼Œå¥½å¥‡å¿ƒæˆ˜èƒœäº†æ‡’æƒ°ç—‡ã€‚å®œå…°è‘±ï¼Œå®Œå…¨ä¸å‘›ï¼Œå˜å˜£è„†ï¼Œåªæœ‰é¦™å‘³ï¼</p><img src="/2015/11/eating-around-taiwan/DSC03588.jpg" title="èŠ±è² è‡ªå¼ºå¤œå¸‚ å®œå…°é¦™è‘±ç‰›è‚‰å·"><p>å—¯ï¼Œæˆ‘ç»ˆäºæåˆ°å¤œå¸‚äº†ã€‚å¯¹äºå¤œå¸‚ï¼Œæˆ‘åªèƒ½è¯´ä¸€ä¸ªæ¯”ä¸€ä¸ªå°è±¡ä¸å¥½ï¼Œä¹Ÿå¯èƒ½æ˜¯å› ä¸ºå¥½å¥‡å¿ƒè¿‡äº†å§ã€‚èŠ±è²çš„ <strong>è‡ªå¼ºå¤œå¸‚</strong> è™½ç„¶ä¸å¤§ï¼Œç§©åºäº•ç„¶ï¼Œéå¸¸å¹²å‡€ï¼Œåœ°é¢å®Œå…¨ä¸è§åƒåœ¾æˆ–ç§¯æ°´ã€‚è€Œå°å—çš„ <strong>èŠ±å›­å¤œå¸‚</strong> å°±çœŸçš„æ˜¯è„ä¹±å·®äº†ï¼Œæ²¡è®°ä½æœ‰ä»€ä¹ˆå¥½åƒçš„ã€‚å°ä¸­çš„ <strong>é€¢ç”²å¤œå¸‚</strong>ï¼Œå°±æ˜¯å¾ˆå¤šå°åƒçš„å•†ä¸šè¡—ï¼Œæˆ‘åªè®°å¾— <strong>å®˜èŠéœ–å¤§è‚ åŒ…å°è‚ </strong>ã€‚</p><img src="/2015/11/eating-around-taiwan/DSC04318.jpg" title="å°ä¸­ é€¢ç”²å¤œå¸‚ å®˜èŠéœ– å¤§è‚ åŒ…å°è‚ "><p>ä»¥ä¸Šç¾é£Ÿï¼Œä¸è¦é—®æˆ‘ä»·æ ¼ï¼Œæœ€å¤šä¸åˆ° 150 TNDã€‚åœ¨å°æ¹¾å°±æ˜¯éšä¾¿åƒï¼Œç‚’é¸¡ä¾¿å®œï¼ä¹Ÿä¸è¦é—®æˆ‘æ‹ç…§æŠ€æœ¯ä»€ä¹ˆæ—¶å€™å˜è¿™ä¹ˆå¥½äº†ï¼Œæˆ‘ä¸ä¼šå‘Šè¯‰ä½ è¿™äº›éƒ½æ˜¯æˆ‘å¥³ç¥¨æ‹çš„ï¼Œæˆ‘åªè´Ÿè´£åƒã€‚æ²¡ä»€ä¹ˆè´¡çŒ®çš„æˆ‘å›æ¥æœ¬æ¥æƒ³ç”»ä¸€å¼ å°å—ç¾é£Ÿåœ°å›¾çš„ï¼Œå¯æƒœæŠ€æœ¯ä¸åˆ°å®¶ï¼Œå­—ä¹Ÿä¸‘ï¼Œæœ€ç»ˆæ”¾å¼ƒã€‚ä¸ç”˜å¿ƒçš„æˆ‘è¿˜æ˜¯ä» Google Map å¯¼å‡ºäº†éƒ¨åˆ†æˆ‘ä»¬åœ¨å°æ¹¾åƒè¿‡çš„ä¸œè¥¿å’Œå°‘æ™¯ç‚¹çš„æ•°æ®ï¼ˆåˆ°å°å—æ‰å¼€å§‹è®°å½•ï¼Œæ‰€ä»¥ä¸œå²¸çš„å‡ ä¹æ²¡æœ‰ï¼‰ï¼Œè½¬æ¢æˆç™¾åº¦åœ°å›¾å¦‚ä¸‹ã€‚</p><script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=j5D7AFvOU6flFPs1XVv9RcoR"></script><div style="width:100%;height:550px;border:#ccc solid 1px;font-size:12px" id="map"></div><script type="text/javascript">  //åˆ›å»ºå’Œåˆå§‹åŒ–åœ°å›¾å‡½æ•°ï¼š  function initMap(){    createMap();//åˆ›å»ºåœ°å›¾    setMapEvent();//è®¾ç½®åœ°å›¾äº‹ä»¶    addMapControl();//å‘åœ°å›¾æ·»åŠ æ§ä»¶    addMapOverlay();//å‘åœ°å›¾æ·»åŠ è¦†ç›–ç‰©  }  function createMap(){     map = new BMap.Map("map");     map.centerAndZoom(new BMap.Point(120.194652,22.994535),14);  }  function setMapEvent(){    map.enableScrollWheelZoom();    map.enableKeyboard();    map.enableDragging();    map.enableDoubleClickZoom()  }  function addClickHandler(target,window){    target.addEventListener("click",function(){      target.openInfoWindow(window);    });  }  function addMapOverlay(){    var markers = [      {        "t": "æˆéƒ½æ¥Šæ¡ƒå†°",        "p": {          "lng": 121.5185096,          "lat": 25.0460545        }      },      {        "t": "é˜¿æ³‰éºµç·š",        "p": {          "lng": 121.5269114,          "lat": 25.0488728        }      },      {        "t": "è¬è¬é­·é­šç¾¹",        "p": {          "lng": 121.51817179999999,          "lat": 25.048498300000002        }      },      {        "t": "è€å¼µç‰›è‚‰éºµ",        "p": {          "lng": 121.5327466,          "lat": 25.0342448        }      },      {        "t": "é‡‘å³°é­¯è‚‰é£¯",        "p": {          "lng": 121.52912979999999,          "lat": 25.0354515        }      },      {        "t": "æ—æ±èŠ³ç‰›è‚‰éºµ",        "p": {          "lng": 121.55194589999999,          "lat": 25.050224500000002        }      },      {        "t": "è¾‰æ¾é£Ÿå“ (åŸé»‘æ¾ç‰›è½§ç³–)",        "p": {          "lng": 121.5225155,          "lat": 25.0476005        }      },      {        "t": "ä¸‡å¸ˆçˆ¶ç‰›è‚‰å·é¥¼",        "p": {          "lng": 121.5248438,          "lat": 25.049327        }      },      {        "t": "é«˜ç¾æ¹¿åœ°",        "p": {          "lng": 120.5612392,          "lat": 24.3149298        }      },      {        "t": "æ±æµ·è“®å¿ƒå†°é›çˆªå‡",        "p": {          "lng": 120.6033175,          "lat": 24.1845936        }      },      {        "t": "çˆ†æ¼¿ç‚­çƒ¤æŒ‰æ‘©é›æ’",        "p": {          "lng": 120.65719229999999,          "lat": 24.1793206        }      },      {        "t": "å®˜èŠéœ–å¤§è…¸åŒ…å°è…¸",        "p": {          "lng": 120.65669249999999,          "lat": 24.1828986        }      },      {        "t": "ç‹è¨˜èœé ­ç²¿ç³¯ç±³è…¸",        "p": {          "lng": 120.68972889999999,          "lat": 24.1455342        }      },      {        "t": "ææµ·é­¯è‚‰é£¯",        "p": {          "lng": 120.689324,          "lat": 24.145697300000002        }      },      {        "t": "åœ‹ç«‹è‡ªç„¶ç§‘å­¸åšç‰©é¤¨",        "p": {          "lng": 120.6771955,          "lat": 24.1606566        }      },      {        "t": "é€¢ç”²å¤œå¸‚",        "p": {          "lng": 120.6570625,          "lat": 24.1822406        }      },      {        "t": "é€¢ç”²å¤œå¸‚",        "p": {          "lng": 120.6570625,          "lat": 24.1822406        }      },      {        "t": "å±±æ²³é­¯è‚‰é£¯",        "p": {          "lng": 120.6897843,          "lat": 24.146047        }      },      {        "t": "å®®åŸçœ¼ç§‘",        "p": {          "lng": 120.6941215,          "lat": 24.1412346        }      },      {        "t": "Tä¸œæµ·å¤§å­¦",        "p": {          "lng": 120.6212622,          "lat": 24.1869967        }      },      {        "t": "å½©è™¹çœ·æ‘",        "p": {          "lng": 120.6204879,          "lat": 24.1371451        }      },      {        "t": "å°è¥¿è…³é’è‰èŒ¶",        "p": {          "lng": 120.2080553,          "lat": 22.9932935        }      },      {        "t": "è€è³´èŒ¶æ£§",        "p": {          "lng": 120.6894854,          "lat": 24.145543500000002        }      },      {        "t": "é˜¿æ†¨é¹¹ç²¥",        "p": {          "lng": 120.216929,          "lat": 23.004922        }      },      {        "t": "å¤æ—©å‘³é­šä¸¸æ¹¯",        "p": {          "lng": 120.2157981,          "lat": 23.0025662        }      },      {        "t": "é´»æºé‡‘å¥½åƒç‰›è‚‰éºµ(åŸä¸Šå¥½åƒ)",        "p": {          "lng": 120.2225148,          "lat": 23.016866        }      },      {        "t": "è—æ™’åœ–æ–‡å‰µåœ’å€",        "p": {          "lng": 120.2078965,          "lat": 22.990581600000002        }      },      {        "t": "è‰è‰æ°´æœåº—",        "p": {          "lng": 120.2146721,          "lat": 22.9925263        }      },      {        "t": "å…‹æ—å°åŒ…",        "p": {          "lng": 120.215471,          "lat": 22.9925503        }      },      {        "t": "å°ç£é»‘è¼ª",        "p": {          "lng": 120.2170793,          "lat": 22.9936557        }      },      {        "t": "è‰ç¥­äºŒæ‰‹æ›¸åº—",        "p": {          "lng": 120.21544349999999,          "lat": 22.9929706        }      },      {        "t": "ä¸è€åº„è¯è†³é£Ÿå“",        "p": {          "lng": 120.2154393,          "lat": 22.993318600000002        }      },      {        "t": "æ „èˆˆæ°´æœåº—",        "p": {          "lng": 120.2175347,          "lat": 23.001591        }      },      {        "t": "ç‚¸è›‹è‘±æ²¹é¤…",        "p": {          "lng": 120.2081505,          "lat": 22.9977417        }      },      {        "t": "ä¿å“¥é»‘è¼ª",        "p": {          "lng": 120.21596439999999,          "lat": 22.9929637        }      },      {        "t": "æ‡·èˆŠå°æ£§",        "p": {          "lng": 120.2158104,          "lat": 22.9860592        }      },      {        "t": "EVAä¼Šå¨ƒæ—¥å¼æ³¡èŠ™å°ˆè³£åº—",        "p": {          "lng": 120.2162991,          "lat": 22.9879105        }      },      {        "t": "åŒè¨˜å®‰å¹³è±†èŠ±",        "p": {          "lng": 120.1639686,          "lat": 23.0033477        }      },      {        "t": "èŒ‚è¨˜é»‘è±†èŠ±å¤§ç‹",        "p": {          "lng": 120.1638272,          "lat": 23.0032144        }      },      {        "t": "å°å—èŠ±å›­å¤œå¸‚",        "p": {          "lng": 120.2102286,          "lat": 23.01408        }      },      {        "t": "æ³°æˆæ°´æœåº—",        "p": {          "lng": 120.2077524,          "lat": 22.9978647        }      },      {        "t": "å…«å®å†°ã€èŠ±ç”Ÿä»æ±¤",        "p": {          "lng": 120.2121181,          "lat": 23.0006898        }      },      {        "t": "é˜¿å¿ é­šç²¥",        "p": {          "lng": 120.2115692,          "lat": 23.000816        }      },      {        "t": "é€£å¾—å ‚é¤…å®¶",        "p": {          "lng": 120.2172727,          "lat": 23.0038089        }      },      {        "t": "ç¾©è±é˜¿ç¦å†¬ç“œèŒ¶",        "p": {          "lng": 120.1845055,          "lat": 23.0015502        }      },      {        "t": "è¥¿ç¾…æ®¿ç‰›è‚‰æ¹¯",        "p": {          "lng": 120.2180324,          "lat": 23.0049167        }      },      {        "t": "é™³å®¶èšµæ²",        "p": {          "lng": 120.1722877,          "lat": 23.0037172        }      },      {        "t": "ç‹æ°é­šçš®åº—",        "p": {          "lng": 120.17950119999999,          "lat": 23.002387600000002        }      }    ];    var allPoints = [];    for(var index = 0; index < markers.length; index++ ){      var icon = new BMap.Icon(        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAMAAAAGyf7hAAABDlBMVEUAAADtLS3MzMzcJC/////+/f3Q0NDTHzDjKC756OrHHDTrKy38/PzffozvR0fKLEP++/z5+fnn5+f22t7vvcTssrrihpP1hYXWYXHyX1/SSl3xV1fJIzruNzfYIzDWIjDgJy/99vbz8/P68vP67O7t7e324OT33uHY2Njxxszttr7rrrfmmaTLjZbggo/1jY3XXW7JXGvNRVjPPVHwT0/NNUriLzbMHTH39/f84eHd3d3i29z71dXS0tLRy837y8v6ycngxMjwwcjLxcbLvL75urrKqq73nJzahpL1kJD1i4vbdIL0f3/Jc3/zcHDyaGjVVmjUU2XHQFPrSk3nQETpQEPHLUPvQUHjMzrGIjnzNEA/AAAAAXRSTlMAQObYZgAAARVJREFUKM9Vzdd6gkAQBeChLk1BEJGi2DWWxGjU9N57L+//ItldQOBczffv7BygMTrW0C732pBJvzJfIYRW3lhOyBgtuC/fLdYYqe5txDhWPp3nH4amoUdaDj7udqhQnfexdV6XW0UmDVcw8KLikr3aY/ykBriswrnE9ni+6VNFI4Dpkmzc8zhX8X+A6i+ZbgieRriJsUEmX8DorHEq0fHl5NBJ6kkRkw+yAc5R3lRdBpDfpBxyD00NYBioGZP0M7MLAIXsVWUiiiJG2Uu1vn3BsizgWLqUHHy/ZGMEW1Gjg9/XxESKwm1ITP2bEBqYQNOukrPhEyse7Xd3tQiF3ozDJccDs1USYB1rEc4OWiUtJbqspPIPOm8ZiopMvjYAAAAASUVORK5CYII=",        new BMap.Size(20,25),        { offset: new BMap.Size(10, 25) }      );      var point = new BMap.Point(markers[index].p.lng,markers[index].p.lat);      allPoints.push(point);      var marker = new BMap.Marker(point, { icon: icon });      var label = new BMap.Label(markers[index].t,{offset: new BMap.Size(22,5)});      marker.setLabel(label);      map.addOverlay(marker);    };    setTimeout(function() {      new BMap.Convertor().translate(allPoints, 1, allPoints.length, function(data) {        console.log(data)      });    }, 5000);  }  //å‘åœ°å›¾æ·»åŠ æ§ä»¶  function addMapControl(){    var scaleControl = new BMap.ScaleControl({anchor:BMAP_ANCHOR_BOTTOM_LEFT});    scaleControl.setUnit(BMAP_UNIT_IMPERIAL);    map.addControl(scaleControl);    var navControl = new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_LEFT,type:BMAP_NAVIGATION_CONTROL_LARGE});    map.addControl(navControl);    var overviewControl = new BMap.OverviewMapControl({anchor:BMAP_ANCHOR_BOTTOM_RIGHT,isOpen:true});    map.addControl(overviewControl);  }  var map;    initMap();</script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è§‰å¾—å†ä¸åŠ¨æ‰‹å†™ï¼Œè¿™ä¸ªæ¸¸è®°å°±çœŸçš„æ— æ³•é¢ä¸–äº†ã€‚è¦ä¸æ˜¯æœ€è¿‘æŠŠåšå®¢ä» &lt;a href=&quot;http://jekyllrb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;jekyll&lt;/a&gt; è¿ç§»åˆ° &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;ï¼Œéƒ½å¯èƒ½æ²¡æœ‰æƒ³ç€è¦å†™ã€‚æ‹–å»¶ç—‡ç»ç—‡æ‚£è€…å¿«æ²¡å¾—æ•‘äº†ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªç³»åˆ—æ–‡ç« ï¼Œè€Œè¿™å½“å‰ä¸€ç¯‡ï¼ˆå¸Œæœ›ä¸æ˜¯æœ€åä¸€ç¯‡ï¼‰ï¼Œåº”è¯¥æ˜¯æˆ‘è§‰å¾—æœ€é‡è¦çš„ â€œ&lt;strong&gt;åƒ&lt;/strong&gt;â€ã€‚æœ¬æ–‡å›¾å¤šå­—å°‘ï¼Œè™½ç„¶æˆ‘å·²ç»å‹ç¼©è¿‡ï¼Œä½†è¿˜è¯·è‡ªå¤‡æµé‡ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="æ—…è¡Œ" scheme="http://csbun.github.io/blog/categories/%E6%97%85%E8%A1%8C/"/>
    
    
      <category term="ç¾é£Ÿ" scheme="http://csbun.github.io/blog/tags/%E7%BE%8E%E9%A3%9F/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Nightmare è¿›è¡Œæµè§ˆå™¨è‡ªåŠ¨åŒ–æµ‹è¯•</title>
    <link href="http://csbun.github.io/blog/2015/11/using-nightmare/"/>
    <id>http://csbun.github.io/blog/2015/11/using-nightmare/</id>
    <published>2015-11-09T10:09:32.000Z</published>
    <updated>2020-11-03T11:52:46.278Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://nightmarejs.org" target="_blank" rel="noopener">Nightmare</a> is a high-level browser automation library. å’Œä¹‹å‰çš„ <a href="http://phantomjs.org/" target="_blank" rel="noopener">PhantomJS</a> å¾ˆåƒï¼Œä½†æ˜¯ <a href="http://nightmarejs.org" target="_blank" rel="noopener">Nightmare</a> æ˜¯åŸºäº <a href="http://electron.atom.io/" target="_blank" rel="noopener">Electron</a> çš„ï¼Œä¹Ÿå°±æ˜¯è¿˜æ˜¯åŸºäº Chromium å’Œ Node.jsã€‚ä½†æ˜¯æ„Ÿè§‰å…¶å†™æ³•æ¯” <a href="http://phantomjs.org/" target="_blank" rel="noopener">PhantomJS</a> ç®€å•ä¸€äº›ï¼š</p><a id="more"></a><h2><span id="å®‰è£…">å®‰è£…</span></h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i nightmare</span><br></pre></td></tr></table></figure><h2><span id="ä½¿ç”¨">ä½¿ç”¨</span></h2><h3><span id="åˆ›å»ºå®ä¾‹">åˆ›å»ºå®ä¾‹</span></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Nightmare = <span class="built_in">require</span>(<span class="string">'nightmare'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> nightmare = Nightmare(&#123; <span class="attr">show</span>: <span class="literal">true</span> &#125;); <span class="comment">// options</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>options.show = true</code> å¯ä»¥åœ¨è¿è¡Œæ—¶æ‰“å¼€ <a href="http://electron.atom.io/" target="_blank" rel="noopener">Electron</a> çª—å£ï¼Œæ–¹ä¾¿ <a href="https://github.com/segmentio/nightmare#debugging" target="_blank" rel="noopener">debug</a>ï¼Œæ›´å¤šçš„ options è¯·çœ‹ <a href="https://github.com/atom/electron/blob/master/docs/api/browser-window.md#new-browserwindowoptions" target="_blank" rel="noopener">new BrowserWindow(options)</a>ã€‚</p><h3><span id="æ“ä½œé¡µé¢">æ“ä½œé¡µé¢</span></h3><p>å› ä¸ºéœ€è¦ä½¿ç”¨äº† ES6 çš„ generatorï¼Œæ‰€ä»¥è¿™é‡Œè¿˜è¦åŠ å…¥ <a href="https://github.com/tj/co" target="_blank" rel="noopener">co</a>ï¼Œå®˜ç½‘çš„ <a href="https://github.com/segmentio/nightmare#examples" target="_blank" rel="noopener">Examples</a> ä½¿ç”¨çš„æ˜¯ <a href="https://github.com/lapwinglabs/vo" target="_blank" rel="noopener">vo</a>ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> co = <span class="built_in">require</span>(<span class="string">'co'</span>);</span><br><span class="line"><span class="keyword">var</span> RES_CLS = <span class="string">'r'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Node è¿è¡Œç¯å¢ƒ</span></span><br><span class="line"><span class="keyword">var</span> googleUrl = <span class="string">'https://www.google.com/'</span>;</span><br><span class="line">co(<span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> url = <span class="keyword">yield</span> nightmare</span><br><span class="line">        <span class="comment">// æ‰“å¼€ Google</span></span><br><span class="line">        .goto(googleUrl)</span><br><span class="line">        <span class="comment">// åœ¨è¾“å…¥æ¡†ä¸­å¡«å†™å†…å®¹ 'csbun npm'</span></span><br><span class="line">        .type(<span class="string">'input[name="q"]'</span>, <span class="string">'csbun npm'</span>)</span><br><span class="line">        <span class="comment">// ç‚¹å‡»æœç´¢</span></span><br><span class="line">        .click(<span class="string">'input[type="submit"]'</span>)</span><br><span class="line">        <span class="comment">// ç­‰å¾…é¡µé¢è¿”å›</span></span><br><span class="line">        .wait(<span class="string">'.'</span> + RES_CLS)</span><br><span class="line">        <span class="comment">// é¡µé¢æ“ä½œ</span></span><br><span class="line">        .evaluate(<span class="function"><span class="keyword">function</span> (<span class="params">RES_CLS</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// è¿™é‡Œæ˜¯æµè§ˆå™¨çš„è¿è¡Œç¯å¢ƒ</span></span><br><span class="line">            <span class="keyword">var</span> resHref = <span class="string">''</span>;</span><br><span class="line">            <span class="keyword">var</span> resH3 = <span class="built_in">document</span>.getElementsByClassName(RES_CLS)[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">if</span> (resH3) &#123;</span><br><span class="line">              <span class="built_in">console</span>.log(resH3);</span><br><span class="line">                <span class="keyword">var</span> resA = resH3.getElementsByTagName(<span class="string">'A'</span>)[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">if</span> (resA) &#123;</span><br><span class="line">                    resHref = resA.href;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// è¿”å›ç»™ Node</span></span><br><span class="line">            <span class="keyword">return</span> resHref;</span><br><span class="line">        &#125;, RES_CLS); <span class="comment">// ä¼ å‚</span></span><br><span class="line">    <span class="comment">// å…³é—­</span></span><br><span class="line">    <span class="keyword">yield</span> nightmare.end();</span><br><span class="line">    <span class="keyword">return</span> url;</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'res: '</span> + res);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸Šè¿°ä»£ç ï¼Œå°†è·å¾— Google æœç´¢ <code>csbun npm</code> çš„ç¬¬ä¸€ä¸ªé“¾æ¥ï¼š <a href="https://www.npmjs.com/~csbun" target="_blank" rel="noopener">https://www.npmjs.com/~csbun</a>ã€‚</p><h3><span id="å…¶ä»–-api">å…¶ä»– </span></h3><h4><span id="evaluate">evaluate</span></h4><p>åœ¨ä¸Šé¢çš„ä¾‹å­é‡Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>.evaluate(fn, arg1)</code> ä¸­çš„ <code>fn</code> æ˜¯æµè§ˆå™¨çš„è¿è¡Œç¯å¢ƒï¼Œæ˜¯ä¸èƒ½ç›´æ¥ä½¿ç”¨é—­åŒ…ä¸­çš„å…¶ä»–å˜é‡çš„ï¼Œå¿…é¡»é€šè¿‡ <code>evaluate</code> çš„å‚æ•° <code>arg1</code> ä¼ å…¥ã€‚è¯¦æƒ…è¯·çœ‹ <a href="https://github.com/segmentio/nightmare#evaluatefn-arg1-arg2" target="_blank" rel="noopener">å®˜æ–¹è§£é‡Š</a>ã€‚</p><h4><span id="wait">wait</span></h4><p><code>wait(ms)</code>ï¼Œ<code>.wait(selector)</code>ï¼Œ<code>.wait(fn)</code> è¿™ä¸‰ä¸ªæ–¹æ³•åœ¨é¡µé¢è¿›è¡Œå¼‚æ­¥æ“ä½œçš„æ—¶å€™æ¯”è¾ƒå¥½ç”¨ã€‚<a href="https://github.com/segmentio/nightmare#waitms" target="_blank" rel="noopener">æ¥å£æ–‡æ¡£</a>ã€‚</p><p>ä¾‹å¦‚å‘é€è¯·æ±‚ï¼Œç­‰å¾…å›¾ç‰‡ä¸‹è½½ç­‰ï¼Œéƒ½å¯ä»¥é€šè¿‡ä¸Šé¢çš„æ–¹å¼å®ç°ã€‚</p><h2><span id="æµ‹è¯•">æµ‹è¯•</span></h2><p>æœ‰äº† <a href="http://nightmarejs.org" target="_blank" rel="noopener">Nightmare</a>ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»“åˆ <a href="http://mochajs.org/" target="_blank" rel="noopener">Mocha</a>ï¼Œç»™æˆ‘ä»¬çš„é¡¹ç›®ç¼–å†™æµ‹è¯•ä¾‹ï¼Œä¸‹é¢å°†ä»¥æˆ‘çš„ä¸€ä¸ªå°é¡¹ç›® <a href="https://github.com/csbun/resize-image" target="_blank" rel="noopener">resize-image</a> ä¸ºä¾‹ï¼š</p><p>åŒæ ·çš„ï¼Œå› ä¸ºä½¿ç”¨äº† generatorï¼Œæˆ‘ä»¬åŠ å…¥ <a href="https://www.npmjs.com/package/mocha-generators" target="_blank" rel="noopener">mocha-generators</a>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* test.js */</span></span><br><span class="line"><span class="comment">// enable generator `it('', function * () &#123;&#125;)`</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'mocha-generators'</span>).install();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Nightmare = <span class="built_in">require</span>(<span class="string">'nightmare'</span>);</span><br><span class="line"><span class="keyword">var</span> assert = <span class="built_in">require</span>(<span class="string">'assert'</span>);</span><br></pre></td></tr></table></figure><h3><span id="æœ¬åœ°æœåŠ¡å™¨">æœ¬åœ°æœåŠ¡å™¨</span></h3><p>ç„¶åæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæœ¬åœ°æœåŠ¡å™¨ï¼ŒåŸºäº Nodeï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆç®€å•å†™å°±å†™ä¸€ä¸ªå‡ºæ¥ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* server.js */</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> html = fs.readFileSync(path.join(__dirname, <span class="string">'test.html'</span>), <span class="string">'utf8'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pngFile = path.join(__dirname, <span class="string">'../example/google.png'</span>);</span><br><span class="line"><span class="keyword">var</span> pngStat = fs.statSync(pngFile);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> jsFile = path.join(__dirname, <span class="string">'../index.js'</span>);</span><br><span class="line"><span class="keyword">var</span> jsStat = fs.statSync(jsFile);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (req.url === <span class="string">'/index.js'</span>) &#123;</span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'text/javascript'</span>,</span><br><span class="line">        <span class="string">'Content-Length'</span>: jsStat.size</span><br><span class="line">    &#125;);</span><br><span class="line">    fs.createReadStream(jsFile).pipe(res);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.url === <span class="string">'/google.png'</span>) &#123;</span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'image/png'</span>,</span><br><span class="line">        <span class="string">'Content-Length'</span>: pngStat.size</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">var</span> readStream = fs.createReadStream(pngFile);</span><br><span class="line">    readStream.pipe(res);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html'</span>&#125;);</span><br><span class="line">    res.end(html);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>google.png</code> åªæ˜¯ä¸€å¼ æ™®é€šçš„å›¾ç‰‡ï¼Œ<code>index.js</code> åˆ™ä¸º <a href="https://github.com/csbun/resize-image" target="_blank" rel="noopener">resize-image</a> çš„æºç ï¼Œ<code>test.html</code> åˆ™ä¸ºä¸€ä¸ªç®€å•çš„æµ‹è¯•é¡µé¢ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Resize Image<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"index.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"img"</span> <span class="attr">src</span>=<span class="string">"./google.png"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3><span id="æµ‹è¯•ä»£ç ">æµ‹è¯•ä»£ç </span></h3><p>ä¸‹é¢æˆ‘ä»¬å°±èƒ½å¼€å§‹æµ‹è¯•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* test.js */</span></span><br><span class="line"><span class="keyword">var</span> PORT = <span class="number">7500</span>;</span><br><span class="line"><span class="keyword">var</span> ASSERT_SIZE = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'resize-image'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// start server</span></span><br><span class="line">  before(<span class="function"><span class="keyword">function</span> (<span class="params">done</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'./server'</span>).listen(PORT, done);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// test `.resize`</span></span><br><span class="line">  it(<span class="string">'.resize: Resize any image to '</span> + ASSERT_SIZE, <span class="function"><span class="keyword">function</span> * (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> nightmare = Nightmare(); <span class="comment">// ä¸è¦ show äº†</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> min = <span class="keyword">yield</span> nightmare</span><br><span class="line">      .goto(<span class="string">'http://0.0.0.0:'</span> + PORT + <span class="string">'/'</span>)</span><br><span class="line">      .evaluate(<span class="function"><span class="keyword">function</span> (<span class="params">ASSERT_SIZE</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> img = <span class="built_in">document</span>.getElementById(<span class="string">'img'</span>);</span><br><span class="line">        <span class="comment">// resize</span></span><br><span class="line">        <span class="keyword">var</span> base64 = <span class="built_in">window</span>.ResizeImage.resize(img, ASSERT_SIZE, ASSERT_SIZE, ResizeImage.PNG);</span><br><span class="line">        <span class="comment">// get resized image size</span></span><br><span class="line">        <span class="keyword">var</span> resizedImg = <span class="keyword">new</span> Image();</span><br><span class="line">        resizedImg.src = base64;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Math</span>.min(resizedImg.width, resizedImg.height);</span><br><span class="line">      &#125;, ASSERT_SIZE)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">yield</span> nightmare.end();</span><br><span class="line">    assert.equal(min, ASSERT_SIZE);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿è¡Œ <code>mocha</code>ï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">resize</span>-<span class="built_in">image</span></span><br><span class="line">  âœ“ .<span class="built_in">resize</span>: <span class="built_in">Resize</span> any <span class="built_in">image</span> <span class="keyword">to</span> <span class="number">200</span> (<span class="number">582</span>ms)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">1</span> passing (<span class="number">595</span>ms)</span><br></pre></td></tr></table></figure><p>å®Œæˆï¼æ²¡é—®é¢˜ï¼å®Œæ•´çš„ä¾‹å­è¯·çœ‹ <a href="https://github.com/csbun/resize-image/tree/master/test" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;http://nightmarejs.org&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Nightmare&lt;/a&gt; is a high-level browser automation library. å’Œä¹‹å‰çš„ &lt;a href=&quot;http://phantomjs.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;PhantomJS&lt;/a&gt; å¾ˆåƒï¼Œä½†æ˜¯ &lt;a href=&quot;http://nightmarejs.org&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Nightmare&lt;/a&gt; æ˜¯åŸºäº &lt;a href=&quot;http://electron.atom.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Electron&lt;/a&gt; çš„ï¼Œä¹Ÿå°±æ˜¯è¿˜æ˜¯åŸºäº Chromium å’Œ Node.jsã€‚ä½†æ˜¯æ„Ÿè§‰å…¶å†™æ³•æ¯” &lt;a href=&quot;http://phantomjs.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;PhantomJS&lt;/a&gt; ç®€å•ä¸€äº›ï¼š&lt;/p&gt;
    
    </summary>
    
    
      <category term="test" scheme="http://csbun.github.io/blog/tags/test/"/>
    
      <category term="nightmare" scheme="http://csbun.github.io/blog/tags/nightmare/"/>
    
  </entry>
  
  <entry>
    <title>Using Contenteditable</title>
    <link href="http://csbun.github.io/blog/2015/09/using-contenteditable/"/>
    <id>http://csbun.github.io/blog/2015/09/using-contenteditable/</id>
    <published>2015-09-21T07:14:03.000Z</published>
    <updated>2020-11-03T11:52:46.278Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æ‰å‘ç°çš„è¿™ä¸ªä¸œè¥¿å•Šï¼Œä½†æ˜¯æŸ¥äº†ä¸€ä¸‹ <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/contentEditable" target="_blank" rel="noopener">MDN</a>ï¼Œè²Œä¼¼å·²ç»å¾ˆæ™®åŠäº†ï¼Œè¿ IE6 éƒ½æ”¯æŒï¼ˆè™½ç„¶æœ‰ä¸€å¤§å †çš„ bugï¼‰ã€‚</p><a id="more"></a><h2><span id="ç”¨æ³•">ç”¨æ³•</span></h2><h3><span id="javascript">JavaScript</span></h3><p>å¾ˆç®€å•çš„ï¼Œå°±æ˜¯éšä¾¿åœ¨é¡µé¢ä¸Šæä¸ªå…ƒç´ ï¼Œç„¶åè®¾ç½®ä¸ºå¯ç¼–è¾‘ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"editable"</span>&gt;</span>I'm editable!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> el = <span class="built_in">document</span>.getElementById(<span class="string">'editable'</span>);</span></span><br><span class="line"><span class="actionscript">el.contentEditable = <span class="string">'true'</span>;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>contentEditable</code> çš„å€¼æ˜¯å­—ç¬¦ä¸²ï¼Œæœ‰ä¸‰ç§é€‰æ‹©ï¼š</p><ul><li><code>&#39;true&#39;</code> å¯ç¼–è¾‘çš„</li><li><code>&#39;false&#39;</code> ä¸å¯ç¼–è¾‘çš„</li><li><code>&#39;inherit&#39;</code> ç»§æ‰¿çˆ¶å…ƒç´ çš„çŠ¶æ€</li></ul><h3><span id="attribute">Attribute</span></h3><p>è¿™ä¸ªæ˜¯ HTML5 ä¸­ä¸€ä¸ªæ–°çš„å…¨å±€å±æ€§ï¼Œ<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/contenteditable" target="_blank" rel="noopener">MDN</a>ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">contenteditable</span>=<span class="string">"true"</span>&gt;</span>I'm editable!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2><span id="ç”¨é€”">ç”¨é€”</span></h2><p>å½“æˆ‘çœ‹åˆ°è¿™è´§ï¼Œæˆ‘ç¬¬ä¸€ååº”å°±æ˜¯æ‹¿æ¥åšâ€œè‡ªå®šä¹‰é¡µé¢â€ï¼Œè¿è¥äººå‘˜åº”è¯¥ä¼šè§‰å¾—å¾ˆå®åœ¨ï¼Œå¤§è‡´åŸç†å¦‚ä¸‹ï¼š</p><ul><li>è¿è¥ç«¯ä»æ•°æ®å­˜å‚¨æœåŠ¡è¾“å‡ºé¡µé¢</li><li>é¡µé¢ä¸­å¯è‡ªå®šä¹‰çš„éƒ¨åˆ†æ ‡è¯†ä¸º contenteditable</li><li>è¿è¥äººå‘˜ä¿®æ”¹è¯¥éƒ¨åˆ†å†…å®¹åç‚¹å‡»ä¿å­˜</li><li>è·å– contenteditable å…ƒç´ çš„ innerHTMLï¼Œå›ä¼ è‡³æ•°æ®å­˜å‚¨æœåŠ¡</li><li>ç»ˆç«¯ç”¨æˆ·ä½¿ç”¨æ›´æ–°åçš„æ•°æ®å­˜å‚¨æœåŠ¡çš„æ•°æ®æ¸²æŸ“é¡µé¢</li></ul><p>è¿™é‡Œæœ‰ä¸€ä¸ªæˆ‘ç”¨ localStorage ç”¨ä½œè™šæ‹Ÿçš„æ•°æ®å­˜å‚¨æœåŠ¡ï¼š</p><p></p><p data-height="750" data-theme-id="18973" data-slug-hash="avNpZw" data-default-tab="result" data-user="csbun" class="codepen">See the Pen <a href="http://codepen.io/csbun/pen/avNpZw/" target="_blank" rel="noopener">avNpZw</a> by csbun (<a href="http://codepen.io/csbun" target="_blank" rel="noopener">@csbun</a>) on <a href="http://codepen.io" target="_blank" rel="noopener">CodePen</a>.</p><p></p><script async src="//assets.codepen.io/assets/embed/ei.js"></script><h2><span id="å®ä¾‹">å®ä¾‹</span></h2><p>è¿™é‡Œæœ‰æ›´å¤šæœ‰è¶£çš„å®ä¾‹ï¼š</p><ul><li><a href="http://substance.io/" target="_blank" rel="noopener">substance</a></li><li><a href="http://getcontenttools.com/demo" target="_blank" rel="noopener">ContentTools</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘æ‰å‘ç°çš„è¿™ä¸ªä¸œè¥¿å•Šï¼Œä½†æ˜¯æŸ¥äº†ä¸€ä¸‹ &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/contentEditable&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;MDN&lt;/a&gt;ï¼Œè²Œä¼¼å·²ç»å¾ˆæ™®åŠäº†ï¼Œè¿ IE6 éƒ½æ”¯æŒï¼ˆè™½ç„¶æœ‰ä¸€å¤§å †çš„ bugï¼‰ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="contentEditable" scheme="http://csbun.github.io/blog/tags/contentEditable/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ iron-node è¿›è¡Œ Node Debug</title>
    <link href="http://csbun.github.io/blog/2015/09/using-iron-node/"/>
    <id>http://csbun.github.io/blog/2015/09/using-iron-node/</id>
    <published>2015-09-15T07:05:33.000Z</published>
    <updated>2020-11-03T11:52:46.277Z</updated>
    
    <content type="html"><![CDATA[<p>ç®€å•æŠ˜è…¾äº†ä¸€ä¸‹ <a href="http://s-a.github.io/iron-node/" target="_blank" rel="noopener">iron-node</a>ï¼Œè°ƒè¯• Node å†ä¹Ÿä¸ç”¨è‹¦é€¼åœ° console.log äº†ã€‚</p><a id="more"></a><h2><span id="å®‰è£…">å®‰è£…</span></h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g iron-<span class="keyword">node</span><span class="title"></span></span><br></pre></td></tr></table></figure><h2><span id="å¯åŠ¨">å¯åŠ¨</span></h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iron-<span class="keyword">node</span> <span class="title">path</span>/to/file.js</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸Šè¿°å‘½ä»¤å¯åŠ¨ï¼Œä¼šè‡ªåŠ¨æ‰“å¼€ä¸€ä¸ª Chrome Developer Tools ç•Œé¢ï¼Œè¿è¡Œ <code>node path/to/file.js</code> çš„è¾“å‡ºä¼šåœ¨ Console æ ‡ç­¾é¡µä¸­è¾“å‡ºã€‚</p><h2><span id="æ–­ç‚¹">æ–­ç‚¹</span></h2><p>æœ€ç®€å•çš„æ–­ç‚¹æ–¹å¼å½“ç„¶æ˜¯åœ¨æºç ä¸­æ·»åŠ  <code>debugger;</code>ï¼Œå¦‚è¿™æ®µï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> inc = <span class="function"><span class="keyword">function</span> (<span class="params">num</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">debugger</span>; <span class="comment">// break point here</span></span><br><span class="line">    <span class="keyword">return</span> ++num;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'inc(3) = '</span> + inc(<span class="number">3</span>));</span><br></pre></td></tr></table></figure><p>åŒæ—¶ï¼Œä¹Ÿåœ¨ Sources æ ‡ç­¾é¡µ çš„ (no domain) åˆ†ç±»ä¸­å¯ä»¥çœ‹åˆ°è¿è¡Œçš„æºç ã€‚è¿™æ ·å°±å¯ä»¥åƒå¹³æ—¶è°ƒè¯•é¡µé¢ä¸€æ ·ç‚¹å‡»è¡Œå·æ·»åŠ åˆ é™¤æ–­ç‚¹ã€‚</p><blockquote><p>å°è¯•äº†ä¸€ä¸‹ä½¿ç”¨ Map Workspace æ— æ•ˆï¼Œæ²¡æœ‰æ–‡ä»¶ç›®å½•ç»“æœï¼Œè¿™ä¸€ç‚¹æ¯”è¾ƒç—›è‹¦ã€‚</p></blockquote><h2><span id="æ–‡ä»¶æ›´æ–°">æ–‡ä»¶æ›´æ–°</span></h2><p>å½“æ–‡ä»¶æ›´æ–°æ—¶ï¼Œåªè¦åœ¨ Chrome Developer Tools ç•Œé¢æŒ‰å¿«æ·é”® <code>Command+R</code> åˆ·æ–°å³å¯ï¼Œè€Œä¸”åˆ·æ–°åçŸ­ç‚¹ä»ç„¶å­˜åœ¨ã€‚</p><blockquote><p>ç„¦ç‚¹å¿…é¡»åœ¨ DevTool ä¸Šï¼Œè€Œä¸æ˜¯é¢„è§ˆç•Œé¢ï¼ˆæ˜¾ç¤º DEBUG.md æˆ– README.md çš„ index.htmlï¼‰</p></blockquote><h2><span id="ä½¿ç”¨-es6">ä½¿ç”¨ ES6</span></h2><p>è™½ç„¶ Node å·²ç»å‡çº§çš„åˆ° v4.0.0ï¼Œæ”¯æŒ ES6 äº†ï¼Œä½†æ˜¯ iron-node å¥½åƒè¿˜æ²¡å®Œå…¨è·Ÿä¸Šï¼Œæ‰€ä»¥è¦å¼€å¯ä¸€äº› <a href="https://github.com/thlorenz/v8-flags/blob/master/flags-0.11.md" target="_blank" rel="noopener">v8 flags</a>ã€‚å…¥å£æ–‡ä»¶æ‰€åœ¨ç›®å½•åˆ›å»ºæ–‡ä»¶ <code>.iron-node.js.</code>ï¼Œå¦‚åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œæ˜¯å¼€å¯ç®­å¤´å‡½æ•°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    v8: &#123;</span><br><span class="line">        flags : [</span><br><span class="line">            <span class="string">'--harmony-arrow-functions'</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    app: &#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¯¦æƒ…å¯ä»¥ç›´æ¥å‚è€ƒ <a href="https://github.com/s-a/iron-node/blob/master/.iron-node.js" target="_blank" rel="noopener">å®˜æ–¹ä¾‹å­</a>ã€‚å¦‚æœæƒ³è®¾ç½®ä¸ºå…¨å±€é…ç½®ï¼Œå°±çœ‹ <a href="https://github.com/s-a/iron-node/blob/master/docs/CONFIGURATION.md" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç®€å•æŠ˜è…¾äº†ä¸€ä¸‹ &lt;a href=&quot;http://s-a.github.io/iron-node/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;iron-node&lt;/a&gt;ï¼Œè°ƒè¯• Node å†ä¹Ÿä¸ç”¨è‹¦é€¼åœ° console.log äº†ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Node" scheme="http://csbun.github.io/blog/tags/Node/"/>
    
      <category term="debug" scheme="http://csbun.github.io/blog/tags/debug/"/>
    
  </entry>
  
</feed>
